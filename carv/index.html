<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente Dona Antonia</title>
    <style>
        /* Reset e Base Estilo ChatGPT */
        * { box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, system-ui, sans-serif; background-color: #ffffff; margin: 0; display: flex; flex-direction: column; height: 100vh; color: #333; }
        
        /* Top Bar Minimalista */
        .top-bar { background-color: #ffffff; border-bottom: 1px solid #eee; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; }
        .brand { display: flex; align-items: center; gap: 12px; }
        .brand img { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .brand span { font-weight: 600; font-size: 16px; color: #111; }

        /* √Årea de Chat */
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 24px; max-width: 800px; margin: 0 auto; width: 100%; scroll-behavior: smooth; }
        
        /* Estrutura de Mensagem */
        .msg-container { display: flex; gap: 15px; width: 100%; }
        .msg-container.user { flex-direction: row-reverse; }

        .avatar { width: 36px; height: 36px; border-radius: 50%; flex-shrink: 0; background: #f0f0f0; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }

        .bubble { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 17px; line-height: 1.6; }
        .bot-bubble { background-color: #f7f7f8; color: #374151; border: 1px solid #e5e7eb; }
        .user-bubble { background-color: #212121; color: #ffffff; }

        /* Digitando */
        #typing { font-size: 13px; color: #888; margin-left: 55px; margin-bottom: 10px; display: none; }

        /* √Årea de Input Moderna */
        .input-wrapper { padding: 20px; max-width: 800px; margin: 0 auto; width: 100%; }
        .input-area { position: relative; display: flex; align-items: center; border: 1px solid #ddd; border-radius: 12px; padding: 5px 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .input-area input { flex: 1; border: none; padding: 12px; outline: none; font-size: 16px; background: transparent; }
        .btn-send { background: #212121; color: white; border: none; border-radius: 8px; width: 35px; height: 35px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .btn-send:hover { background: #444; }

        /* Elementos Especiais */
        .btn-action { background: #ffffff; border: 1px solid #cbcbcb; padding: 12px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; margin-top: 10px; transition: 0.3s; width: 100%; text-align: left; display: flex; justify-content: space-between; align-items: center; }
        .btn-action:hover { background: #f9f9f9; border-color: #000; }
        .sticker { width: 120px; margin-top: 5px; border-radius: 10px; }

        /* Player √Åudio Clean */
        .audio-box { background: #f7f7f8; border: 1px solid #ddd; border-radius: 12px; padding: 15px; display: flex; align-items: center; gap: 15px; width: 100%; max-width: 300px; }
        .play-btn { font-size: 24px; cursor: pointer; }

        /* Modal Slide */
        #modal-slide { display: none; position: fixed; inset: 0; background: #ffffff; z-index: 3000; flex-direction: column; align-items: center; justify-content: center; }
        .slide-img { max-width: 90%; max-height: 70vh; border-radius: 12px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }
        .slide-nav { margin-top: 30px; display: flex; gap: 40px; }
        .nav-btn { background: #f0f0f0; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .close-x { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; border: none; background: none; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="brand">
            <img src="logo.webp" alt="Logo">
            <span>Dona Antonia</span>
        </div>
        <div style="font-size: 12px; color: #888;">Osvaldo Assistente</div>
    </div>

    <div id="chat-window"></div>
    <div id="typing">Osvaldo est√° processando...</div>

    <div class="input-wrapper" id="input-container">
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Digite seu nome para come√ßar...">
            <button class="btn-send" onclick="handleUserInput()">‚Üë</button>
        </div>
    </div>

    <div id="modal-slide">
        <button class="close-x" onclick="toggleSlide(false)">‚úï</button>
        <img id="current-slide-img" class="slide-img" src="cesta1.webp">
        <div class="slide-nav">
            <button class="nav-btn" onclick="changeSlide(-1)">Anterior</button>
            <button class="nav-btn" onclick="changeSlide(1)">Pr√≥xima</button>
        </div>
    </div>

    <script>
        const chatWindow = document.getElementById('chat-window');
        const typingIndicator = document.getElementById('typing');
        let userName = "";
        let currentCesta = 1;

        async function speak(content, isSticker = false, delay = 1200) {
            typingIndicator.style.display = "block";
            scrollChat();
            await new Promise(res => setTimeout(res, delay));
            typingIndicator.style.display = "none";
            
            const container = document.createElement('div');
            container.className = "msg-container";
            
            // L√≥gica de negrito para o nome
            let text = content;
            if(userName) {
                const regex = new RegExp(userName, "gi");
                text = text.replace(regex, `<b>${userName}</b>`);
            }

            container.innerHTML = `
                <div class="avatar"><img src="logo.webp"></div>
                <div class="bubble bot-bubble">
                    ${isSticker ? `<img src="${content}" class="sticker">` : text}
                </div>
            `;
            
            chatWindow.appendChild(container);
            scrollChat();
        }

        function scrollChat() {
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        window.onload = async () => {
            const h = new Date().getHours();
            const saudacao = h < 12 ? "Bom dia" : h < 18 ? "Boa tarde" : "Boa noite";
            await speak("ola.webp", true, 600);
            await speak(`${saudacao}! Me chamo Osvaldo. Como posso te chamar?`);
        };

        async function handleUserInput() {
            const input = document.getElementById('user-input');
            if (!input.value.trim()) return;

            userName = input.value.trim();
            document.getElementById('input-container').style.display = "none";

            const container = document.createElement('div');
            container.className = "msg-container user";
            container.innerHTML = `<div class="bubble user-bubble"><b>${userName}</b></div>`;
            chatWindow.appendChild(container);
            scrollChat();

            await speak(`Prazer em te conhecer, ${userName}! ok.webp`, true, 800);
            await speak(`${userName}, vou te mandar as fotos e as listas de produtos das nossas cestas. Pode ser?`);
            await speak(`<button class="btn-action" onclick="toggleSlide(true)">üì¶ Ver Cestas B√°sicas <span>‚Üí</span></button>`, false, 500);

            setTimeout(askForAudio, 10000);
        }

        function toggleSlide(show) {
            document.getElementById('modal-slide').style.display = show ? "flex" : "none";
        }

        function changeSlide(dir) {
            currentCesta += dir;
            if (currentCesta < 1) currentCesta = 3;
            if (currentCesta > 3) currentCesta = 1;
            document.getElementById('current-slide-img').src = `cesta${currentCesta}.webp`;
        }

        async function askForAudio() {
            await speak(`${userName}, posso te enviar um √°udio explicando como funciona a compra das cestas?`, false, 1500);
            
            setTimeout(async () => {
                const audioHTML = `
                    <div class="audio-box">
                        <span class="play-btn" onclick="playAudio(this)">‚ñ∂</span>
                        <div style="flex:1">
                            <span style="font-size:14px; font-weight:600;">Explica√ß√£o Dona Antonia</span>
                            <span style="font-size:12px; color:#666; display:block;">0:30</span>
                        </div>
                        <audio id="audio-file" src="audio.mp3"></audio>
                    </div>
                `;
                await speak(audioHTML, false, 500);
                setTimeout(finalStep, 10000);
            }, 2000);
        }

        function playAudio(btn) {
            const audio = document.getElementById('audio-file');
            if (audio.paused) {
                audio.play();
                btn.innerText = "‚è∏";
            } else {
                audio.pause();
                btn.innerText = "‚ñ∂";
            }
        }

        async function finalStep() {
            await speak("obrigado.webp", true, 800);
            await speak(`${userName}, me mande um oi no WhatsApp para salvar nosso contato.`);
            await speak(`Na sua pr√≥xima compra vou te mandar um caf√© de brinde! ‚òï`);
            await speak(`<button class="btn-action" style="background:#25d366; color:white; border:none;" onclick="window.open('https://wa.me/5511999999999')">üü¢ Chamar no WhatsApp <span>‚Üí</span></button>`, false, 500);
        }
    </script>
</body>
</html>
