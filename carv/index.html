<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Dona Antonia</title>
    <style>
        /* Estilização Geral - Estilo Bubble Chat */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #e5ddd5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Top Bar */
        .top-bar { background-color: #075e54; color: white; padding: 10px; display: flex; align-items: center; position: fixed; width: 100%; top: 0; z-index: 1000; }
        .top-bar img { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; border: 1px solid #fff; }
        .top-bar span { font-weight: bold; font-size: 18px; }

        /* Área do Chat */
        #chat-container { flex: 1; padding: 70px 15px 20px 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        
        /* Balões de Mensagem */
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 15px; line-height: 1.4; position: relative; margin-bottom: 5px; }
        .bot { background-color: white; align-self: flex-start; border-top-left-radius: 0; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .user-input-area { padding: 10px; background: white; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        .input-text { flex: 1; border: 1px solid #ccc; border-radius: 20px; padding: 10px 15px; outline: none; }
        .btn-send { background: #25d366; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; }

        /* Imagens e Figurinas */
        .sticker { width: 100px; display: block; margin-bottom: 5px; }
        .btn-action { background-color: #34b7f1; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px; font-weight: bold; }

        /* Modal do Slide de Imagens */
        #modal-slide { display: none; position: fixed; z-index: 2000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); text-align: center; }
        .slide-img { max-width: 90%; max-height: 70%; margin-top: 50px; }
        .controls { margin-top: 20px; }
        .btn-ctrl { background: white; border: none; padding: 15px; margin: 0 10px; font-size: 20px; cursor: pointer; border-radius: 5px; }
        .btn-close { position: absolute; top: 20px; right: 20px; background: red; color: white; border: none; padding: 10px; cursor: pointer; }

        /* Reprodutor de Áudio Estilo WhatsApp */
        .audio-player { display: flex; align-items: center; background: #dcf8c6; padding: 10px; border-radius: 10px; min-width: 200px; }
        .play-btn { font-size: 24px; cursor: pointer; margin-right: 10px; }
    </style>
</head>
<body>

    <div class="top-bar">
        <img src="logo.webp" alt="Logo">
        <span>Dona Antonia Cestas Básicas</span>
    </div>

    <div id="chat-container">
        </div>

    <div class="user-input-area" id="input-zone">
        <input type="text" id="user-name" class="input-text" placeholder="Digite seu nome...">
        <button class="btn-send" onclick="startConversation()">➤</button>
    </div>

    <div id="modal-slide">
        <button class="btn-close" onclick="closeSlide()">FECHAR X</button>
        <img id="img-display" class="slide-img" src="" alt="Cesta">
        <div class="controls">
            <button class="btn-ctrl" onclick="changeImg(-1)">◀ Anterior</button>
            <button class="btn-ctrl" onclick="changeImg(1)">Próxima ▶</button>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const inputZone = document.getElementById('input-zone');
        let clienteNome = "";
        
        // Lista de imagens das cestas
        const imagensCestas = ["cesta1.webp", "cesta2.webp", "cesta3.webp"];
        let currentImgIndex = 0;

        // Função para adicionar mensagem ao chat
        function addMessage(text, type = 'bot', isSticker = false) {
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            if (isSticker) {
                div.innerHTML = `<img src="${text}" class="sticker">`;
            } else {
                div.innerHTML = text;
            }
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Saudação Inicial
        window.onload = () => {
            const hour = new Date().getHours();
            let saudacao = hour < 12 ? "Bom dia" : hour < 18 ? "Boa tarde" : "Boa noite";
            
            setTimeout(() => {
                addMessage("ola.webp", 'bot', true);
                addMessage(`${saudacao}! Me chamo Osvaldo. Qual é o seu nome?`);
            }, 500);
        };

        // Lógica após digitar o nome
        function startConversation() {
            clienteNome = document.getElementById('user-name').value;
            if (clienteNome.trim() === "") return;

            inputZone.style.display = 'none'; // Esconde o input após receber o nome
            addMessage(clienteNome, 'user');

            setTimeout(() => {
                addMessage(`${clienteNome}, vou te mandar as fotos e as listas de produtos das nossas cestas agora. Pode ser?`);
                addMessage(`<button class="btn-action" onclick="openSlide()">VER CESTAS BÁSICAS</button>`);
                
                // Aguarda 10 segundos para perguntar do áudio
                setTimeout(askForAudio, 10000);
            }, 1000);
        }

        // Slide de Imagens
        function openSlide() {
            document.getElementById('modal-slide').style.display = 'block';
            updateSlide();
        }

        function closeSlide() {
            document.getElementById('modal-slide').style.display = 'none';
        }

        function updateSlide() {
            document.getElementById('img-display').src = imagensCestas[currentImgIndex];
        }

        function changeImg(dir) {
            currentImgIndex += dir;
            if (currentImgIndex < 0) currentImgIndex = imagensCestas.length - 1;
            if (currentImgIndex >= imagensCestas.length) currentImgIndex = 0;
            updateSlide();
        }

        // Parte do Áudio
        function askForAudio() {
            addMessage(`${clienteNome}, posso te enviar um áudio rapidinho explicando como funciona a compra?`);
            
            setTimeout(() => {
                // Simula o envio do áudio
                const audioHTML = `
                    <div class="audio-player">
                        <span class="play-btn" onclick="playAudio(this)">▶️</span>
                        <span>Mensagem de voz (0:30)</span>
                        <audio id="main-audio" src="audio.mp3"></audio>
                    </div>
                `;
                addMessage(audioHTML);
                
                // Aguarda o tempo do áudio + delay para mensagem final
                setTimeout(finalStep, 10000);
            }, 2000);
        }

        function playAudio(btn) {
            const audio = document.getElementById('main-audio');
            if (audio.paused) {
                audio.play();
                btn.innerText = "⏸️";
            } else {
                audio.pause();
                btn.innerText = "▶️";
            }
        }

        function finalStep() {
            addMessage("obrigado.webp", 'bot', true);
            addMessage(`${clienteNome}, me mande um oi no WhatsApp para salvar nosso contato.`);
            addMessage(`Na sua próxima compra vou te mandar **1 café de brinde**! ☕`);
            addMessage(`<button class="btn-action" style="background:#25d366" onclick="window.open('https://wa.me/SEUNUMERO')">CHAMAR NO WHATSAPP</button>`);
        }
    </script>
</body>
</html>
