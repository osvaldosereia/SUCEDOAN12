<!DOCTYPE html> 
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <meta name="description" content="Personalize sua cesta básica online. Entrega rápida em Cuiabá e Várzea Grande.">
    <meta name="theme-color" content="#ffffff">
    
    <title>Dona Antônia | Cestas Personalizáveis</title>

    <style>
        /* * ⚡ ULTRA-PERFORMANCE CSS RESET & VARIABLES 
         * Mobile-First | System Fonts | GPU Accelerated
         */
        :root {
            --primary: #dc2626;
            --primary-dark: #b91c1c;
            --text: #1e293b;
            --text-light: #64748b;
            --bg: #f8fafc;
            --surface: #ffffff;
            --border: #e2e8f0;
            --success: #16a34a;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            --font-main: system-ui, -apple-system, sans-serif;
            --nav-height: 64px;
        }

        /* RESET MÍNIMO */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.5;
            text-rendering: optimizeLegibility;
            padding-top: var(--nav-height);
            padding-bottom: 100px; /* Espaço para footer fixo mobile */
        }

        /* IMAGENS COM ASPECT RATIO PARA EVITAR CLS */
        img { display: block; max-width: 100%; height: auto; object-fit: cover; background-color: #f1f5f9; }
        
        /* LAYOUT UTILS */
        .container { width: 100%; max-width: 1100px; margin: 0 auto; padding: 0 16px; }
        .grid { display: grid; gap: 20px; }
        .flex { display: flex; align-items: center; }
        .flex-col { display: flex; flex-direction: column; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .hidden { display: none !important; }

        /* HEADER FIXO OTIMIZADO */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--nav-height);
            background: rgba(255,255,255,0.95); backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border); z-index: 100;
            display: flex; align-items: center;
            will-change: transform; transition: transform 0.3s;
        }
        body.scroll-down header { transform: translateY(-100%); }

        .logo { font-weight: 800; font-size: 1.25rem; color: var(--text); text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .badge { background: #f1f5f9; font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; font-weight: 600; }

        /* UI ELEMENTS */
        button {
            cursor: pointer; border: none; font: inherit; font-weight: 600;
            display: inline-flex; justify-content: center; align-items: center; gap: 8px;
            padding: 0 20px; height: 48px; border-radius: 50px;
            transition: opacity 0.2s, transform 0.1s;
        }
        button:active { transform: scale(0.98); }
        
        button.primary { background: var(--text); color: white; width: 100%; }
        button.outline { background: white; border: 2px solid var(--border); color: var(--text); width: 100%; }
        button.icon { width: 44px; height: 44px; padding: 0; border-radius: 50%; background: white; border: 1px solid var(--border); }
        button.add-sm { height: 36px; padding: 0 16px; font-size: 0.85rem; border: 1px solid var(--border); background: white; }

        input[type="search"] {
            width: 100%; height: 48px; padding: 0 16px 0 44px;
            border: 1px solid var(--border); border-radius: 50px;
            font-size: 1rem; background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'%3E%3C/path%3E%3C/svg%3E") no-repeat 14px center/20px;
        }

        /* CARDS (HOME) */
        .card-basket {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: var(--radius); overflow: hidden;
            box-shadow: var(--shadow);
            display: flex; flex-direction: column;
        }
        .img-wrapper { aspect-ratio: 4/3; width: 100%; position: relative; overflow: hidden; }
        .card-content { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .price-tag { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin: 8px 0 16px; letter-spacing: -0.5px; }

        /* LISTA COMPACTA (CUSTOMIZER) */
        .list-item {
            display: grid; grid-template-columns: 70px 1fr auto; gap: 16px;
            padding: 16px; background: white; border-bottom: 1px solid var(--border);
            align-items: center;
        }
        .list-item:first-child { border-top-left-radius: var(--radius); border-top-right-radius: var(--radius); }
        .list-item:last-child { border-bottom: none; border-bottom-left-radius: var(--radius); border-bottom-right-radius: var(--radius); }
        
        .thumb { width: 70px; height: 70px; border-radius: 8px; border: 1px solid var(--border); object-fit: contain; padding: 4px; }
        
        .item-info h3 { font-size: 0.95rem; font-weight: 600; line-height: 1.3; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .item-meta { font-size: 0.8rem; color: var(--text-light); }
        
        .qty-ctrl {
            display: flex; align-items: center; background: white;
            border: 1px solid var(--border); border-radius: 50px; height: 36px;
        }
        .qty-ctrl button { width: 32px; height: 100%; padding: 0; background: none; color: var(--text); font-size: 1.2rem; }
        .qty-ctrl span { min-width: 24px; text-align: center; font-weight: 600; font-size: 0.9rem; }

        /* FOOTER FLUTUANTE DE CHECKOUT */
        .float-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255,255,255,0.98); border-top: 1px solid var(--border);
            padding: 12px 16px; backdrop-filter: blur(10px); z-index: 90;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
            display: flex; align-items: center; justify-content: space-between; gap: 16px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
        }
        .total-box small { display: block; font-size: 0.7rem; text-transform: uppercase; color: var(--text-light); font-weight: 700; }
        .total-box div { font-size: 1.4rem; font-weight: 800; color: var(--primary); line-height: 1; }
        .btn-checkout { background: var(--success); color: white; flex: 1; max-width: 200px; }

        /* MODAL NATIVO */
        dialog {
            margin: auto; padding: 0; border: none; border-radius: 16px;
            width: 90%; max-width: 450px; box-shadow: 0 20px 50px rgba(0,0,0,0.25);
            background: white; overflow: hidden;
        }
        dialog::backdrop { background: rgba(0,0,0,0.6); backdrop-filter: blur(2px); }
        .modal-head { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-weight: 700; }
        .modal-body { padding: 20px; max-height: 60vh; overflow-y: auto; }

        /* TOAST */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: #1e293b; color: white; padding: 10px 24px; border-radius: 50px;
            z-index: 200; font-weight: 600; font-size: 0.9rem; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .toast.show { transform: translateX(-50%) translateY(0); }

        /* DESKTOP MEDIA QUERY */
        @media (min-width: 768px) {
            .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
            .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
            
            /* Customizer layout desktop */
            .customizer-layout { display: grid; grid-template-columns: 1fr 350px; gap: 40px; align-items: start; }
            .float-bar {
                position: sticky; top: 100px; bottom: auto; border: 1px solid var(--border);
                border-radius: var(--radius); flex-direction: column; align-items: stretch;
                padding: 24px; gap: 20px; z-index: 10;
            }
            .btn-checkout { max-width: 100%; height: 56px; font-size: 1.1rem; }
            body { padding-bottom: 40px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="container flex justify-between">
            <a href="#" onclick="App.route('home')" class="logo">
                <!-- SVG Logo Placeholder -->
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--primary)"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                Dona Antônia
            </a>
            <span class="badge">Cuiabá & VG</span>
        </div>
    </header>

    <!-- NOTIFICAÇÃO -->
    <div id="toast" class="toast">Mensagem aqui</div>

    <!-- VIEW: HOME -->
    <main id="view-home" class="container" style="padding-top: 20px;">
        <div style="text-align: center; margin-bottom: 30px;">
            <h1 style="font-size: 1.8rem; font-weight: 800; color: var(--text); margin-bottom: 8px;">Escolha sua Cesta</h1>
            <p style="color: var(--text-light);">Produtos de qualidade com o melhor preço.</p>
        </div>
        
        <div id="basket-grid" class="grid grid-cols-3">
            <!-- Renderizado via JS -->
            <div style="grid-column: 1/-1; text-align: center; padding: 40px;">Carregando catálogo...</div>
        </div>
    </main>

    <!-- VIEW: CUSTOMIZER -->
    <main id="view-customizer" class="container hidden" style="padding-top: 20px;">
        <div class="flex gap-2" style="margin-bottom: 20px;">
            <button class="icon" onclick="App.route('home')" aria-label="Voltar">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <div>
                <h2 id="customizer-title" style="font-size: 1.2rem; font-weight: 700; line-height: 1.2;">Nome da Cesta</h2>
                <span id="customizer-subtitle" style="font-size: 0.85rem; color: var(--text-light);">Personalize os itens</span>
            </div>
        </div>

        <div class="customizer-layout">
            <!-- Coluna Esquerda: Listas -->
            <div>
                <div style="position: sticky; top: var(--nav-height); background: var(--bg); padding: 10px 0; z-index: 50;">
                    <input type="search" id="search-input" placeholder="Buscar produto extra..." aria-label="Buscar produto">
                </div>

                <div style="margin-top: 20px;">
                    <h3 style="font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-light); margin-bottom: 12px;">Itens da Cesta</h3>
                    <div id="list-included" style="background: white; border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden;"></div>
                </div>

                <div style="margin-top: 40px;">
                    <h3 style="font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-light); margin-bottom: 12px;">Adicionar Extras</h3>
                    <div id="list-extras" class="grid" style="gap: 0; background: white; border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden;"></div>
                </div>
            </div>

            <!-- Coluna Direita / Footer Mobile: Checkout -->
            <aside class="float-bar">
                <div class="total-box">
                    <small>Total Estimado</small>
                    <div id="total-display">R$ 0,00</div>
                </div>
                <button class="btn-checkout" onclick="App.checkout()">
                    Finalizar Pedido
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </button>
            </aside>
        </div>
    </main>

    <!-- MODAL CHECKOUT -->
    <dialog id="modal-checkout">
        <div class="modal-head">
            <span>Resumo do Pedido</span>
            <button class="icon" onclick="this.closest('dialog').close()" style="width:32px; height:32px; border:none;">✕</button>
        </div>
        <div class="modal-body">
            <div id="checkout-list" style="margin-bottom: 20px; font-size: 0.9rem;"></div>
            
            <div style="border-top: 1px dashed var(--border); padding-top: 15px; margin-top: 15px;">
                <p style="font-weight: 600; margin-bottom: 10px;">Forma de Pagamento:</p>
                <div class="flex flex-col gap-2">
                    <label class="flex gap-2"><input type="radio" name="payment" value="Pix" checked> Pix</label>
                    <label class="flex gap-2"><input type="radio" name="payment" value="Dinheiro"> Dinheiro</label>
                    <label class="flex gap-2"><input type="radio" name="payment" value="Cartão"> Cartão</label>
                </div>
            </div>

            <button class="primary" onclick="App.sendWhatsapp()" style="margin-top: 24px; background: #25D366;">
                Confirmar no WhatsApp
            </button>
        </div>
    </dialog>

    <script>
        /**
         * SISTEMA "SINGLE-OBJECT"
         * Lógica centralizada para performance e facilidade de manutenção.
         */
        const App = {
            data: [],
            cart: {},
            currentBasket: null,
            basePrice: 0,
            
            // Dados de Fallback (Caso o JSON não carregue, para demonstração)
            fallbackData: [
                {id: "c1", nome: "Cesta Econômica", categoria: "CESTA BÁSICA", valor: 150.00, imagem: "img/cesta1.jpg", items: [{id:"p1", qtd:1}, {id:"p2", qtd:2}]},
                {id: "c2", nome: "Cesta Família", categoria: "CESTA BÁSICA", valor: 280.00, imagem: "img/cesta2.jpg", items: [{id:"p1", qtd:2}, {id:"p3", qtd:1}]},
                {id: "p1", nome: "Arroz Agulhinha 5kg", categoria: "ALIMENTOS", valor: 22.90, imagem: "img/arroz.jpg"},
                {id: "p2", nome: "Feijão Carioca 1kg", categoria: "ALIMENTOS", valor: 8.50, imagem: "img/feijao.jpg"},
                {id: "p3", nome: "Óleo de Soja 900ml", categoria: "ALIMENTOS", valor: 6.90, imagem: "img/oleo.jpg"},
                {id: "p4", nome: "Café Torrado 500g", categoria: "BEBIDAS", valor: 14.90, imagem: "img/cafe.jpg"},
                {id: "p5", nome: "Açúcar Cristal 2kg", categoria: "ALIMENTOS", valor: 9.90, imagem: "img/acucar.jpg"}
            ],

            async init() {
                try {
                    // Tenta carregar do JSON original, se falhar, usa fallback
                    const res = await fetch('./produtos/produtos.json');
                    if (!res.ok) throw new Error("JSON not found");
                    this.data = await res.json();
                } catch (e) {
                    console.warn("Usando dados de demonstração (JSON ausente).");
                    this.data = this.fallbackData;
                }
                
                // Normalização de dados para evitar erros de renderização
                this.data = this.data.map(p => ({
                    ...p,
                    valor: parseFloat(p.valor || 0),
                    items: p.items || []
                }));

                this.renderHome();
                
                // Setup Scroll Header
                let lastScroll = 0;
                window.addEventListener('scroll', () => {
                    const current = window.scrollY;
                    if (current > 50 && current > lastScroll) document.body.classList.add('scroll-down');
                    else document.body.classList.remove('scroll-down');
                    lastScroll = current;
                }, {passive: true});

                // Setup Search
                document.getElementById('search-input').addEventListener('input', (e) => {
                    this.renderExtras(e.target.value.toLowerCase());
                });
            },

            route(viewName) {
                if (viewName === 'home') {
                    document.getElementById('view-customizer').classList.add('hidden');
                    document.getElementById('view-home').classList.remove('hidden');
                    window.scrollTo(0,0);
                } else {
                    document.getElementById('view-home').classList.add('hidden');
                    document.getElementById('view-customizer').classList.remove('hidden');
                }
            },

            // --- RENDERIZADORES OTIMIZADOS ---

            renderHome() {
                const cestas = this.data.filter(p => p.categoria === 'CESTA BÁSICA' || p.categoria === 'CESTA BASICA');
                const grid = document.getElementById('basket-grid');
                
                // Remove classe de colunas se houver poucas cestas para ficar bonito
                if (window.innerWidth >= 768 && cestas.length < 3) {
                    grid.className = 'grid grid-cols-2';
                }

                grid.innerHTML = cestas.map((c, index) => {
                    // Performance: Primeira imagem Eager, resto Lazy
                    const loadingAttr = index === 0 ? 'eager' : 'lazy';
                    const fetchPriority = index === 0 ? 'fetchpriority="high"' : '';
                    
                    return `
                    <article class="card-basket">
                        <div class="img-wrapper">
                            <img src="${c.imagem}" alt="${c.nome}" width="400" height="300" 
                                 loading="${loadingAttr}" ${fetchPriority}
                                 onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 400 300\' fill=\'%23e2e8f0\'%3E%3Crect width=\'400\' height=\'300\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' dy=\'.3em\' text-anchor=\'middle\' font-family=\'sans-serif\' fill=\'%2394a3b8\'%3ESem Imagem%3C/text%3E%3C/svg%3E'">
                        </div>
                        <div class="card-content">
                            <h3 style="font-size:1.25rem; font-weight:700; line-height:1.2">${c.nome}</h3>
                            <div class="price-tag">R$ ${c.valor.toFixed(2).replace('.', ',')}</div>
                            <button class="primary" onclick="App.openCustomizer('${c.id}')">
                                Personalizar
                            </button>
                        </div>
                    </article>
                    `;
                }).join('');
            },

            openCustomizer(id) {
                const cesta = this.data.find(c => c.id == id);
                if (!cesta) return;

                this.currentBasket = cesta;
                this.cart = {};
                
                // Popula carrinho inicial
                let itemsValue = 0;
                cesta.items.forEach(item => {
                    // Lógica para encontrar o produto real baseado no ID ou Nome do item da cesta
                    let prod = this.data.find(p => p.id == item.id);
                    // Fallback se não achar por ID (caso o JSON seja inconsistente)
                    if (!prod) prod = this.data.find(p => p.nome === item.nome && p.categoria !== 'CESTA BÁSICA');
                    
                    if (prod) {
                        this.cart[prod.id] = (this.cart[prod.id] || 0) + (item.qtd || 1);
                        itemsValue += prod.valor * (item.qtd || 1);
                    }
                });

                // Calcula taxa base (diferença entre preço da cesta e soma dos itens soltos)
                this.basePrice = Math.max(0, cesta.valor - itemsValue);

                document.getElementById('customizer-title').innerText = cesta.nome;
                document.getElementById('search-input').value = '';
                
                this.renderIncluded();
                this.renderExtras();
                this.updateTotal();
                this.route('customizer');
            },

            renderIncluded() {
                const container = document.getElementById('list-included');
                const ids = Object.keys(this.cart);
                
                if (ids.length === 0) {
                    container.innerHTML = '<div style="padding:20px; text-align:center; color:var(--text-light)">Nenhum item.</div>';
                    return;
                }

                container.innerHTML = ids.map(id => {
                    const p = this.data.find(x => x.id == id);
                    if (!p) return '';
                    return this.createRowHTML(p, this.cart[id], true);
                }).join('');
            },

            renderExtras(term = '') {
                const container = document.getElementById('list-extras');
                // Filtra produtos que NÃO são cestas e correspondem à busca
                const extras = this.data.filter(p => 
                    p.categoria !== 'CESTA BÁSICA' && 
                    p.categoria !== 'CESTA BASICA' &&
                    (!term || p.nome.toLowerCase().includes(term))
                ).slice(0, 50); // Limita renderização para performance se a lista for gigante

                if (extras.length === 0) {
                    container.innerHTML = '<div style="padding:20px; text-align:center; color:var(--text-light)">Nenhum produto encontrado.</div>';
                    return;
                }

                // Agrupa por categoria para UX melhor
                const grouped = {};
                extras.forEach(p => {
                    const cat = p.categoria || 'OUTROS';
                    if(!grouped[cat]) grouped[cat] = [];
                    grouped[cat].push(p);
                });

                let html = '';
                for (const [cat, products] of Object.entries(grouped)) {
                    html += `<div style="background:#f1f5f9; padding:8px 16px; font-weight:700; font-size:0.8rem; color:var(--text-light); border-bottom:1px solid var(--border);">${cat}</div>`;
                    html += products.map(p => this.createRowHTML(p, this.cart[p.id] || 0, false)).join('');
                }
                container.innerHTML = html;
            },

            createRowHTML(p, qtd, isIncludedSection) {
                // Se estiver na seção "Inclusos" e qtd for 0, não renderiza
                if (isIncludedSection && qtd === 0) return '';
                
                return `
                <div class="list-item">
                    <img src="${p.imagem}" class="thumb" width="70" height="70" loading="lazy" alt="${p.nome}"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 1 1\' fill=\'%23f1f5f9\'%3E%3C/svg%3E'">
                    
                    <div class="item-info">
                        <h3>${p.nome}</h3>
                        <div class="item-meta">R$ ${p.valor.toFixed(2).replace('.', ',')}</div>
                    </div>

                    ${qtd === 0 && !isIncludedSection 
                        ? `<button class="add-sm" onclick="App.changeQty('${p.id}', 1)">Adicionar</button>`
                        : `<div class="qty-ctrl">
                               <button onclick="App.changeQty('${p.id}', -1)">-</button>
                               <span>${qtd}</span>
                               <button onclick="App.changeQty('${p.id}', 1)">+</button>
                           </div>`
                    }
                </div>`;
            },

            changeQty(id, delta) {
                if (!this.cart[id]) this.cart[id] = 0;
                this.cart[id] += delta;
                if (this.cart[id] <= 0) delete this.cart[id];

                // Atualiza UI de forma inteligente (Re-renderiza apenas o necessário seria ideal, mas aqui re-renderizamos as listas por simplicidade do código)
                this.renderIncluded();
                // Para extras, apenas atualizamos se estiverem visíveis, mas para garantir consistência vamos re-renderizar
                const term = document.getElementById('search-input').value.toLowerCase();
                this.renderExtras(term);
                this.updateTotal();
            },

            updateTotal() {
                let totalItems = 0;
                for (const [id, qtd] of Object.entries(this.cart)) {
                    const p = this.data.find(x => x.id == id);
                    if (p) totalItems += p.valor * qtd;
                }
                
                // O preço nunca pode ser menor que o da cesta original (regra de negócio comum)
                // Se a soma dos produtos + taxa base for menor que o valor original da cesta, mantemos o original.
                const calcTotal = totalItems + this.basePrice;
                const finalTotal = Math.max(calcTotal, this.currentBasket.valor);

                document.getElementById('total-display').innerText = `R$ ${finalTotal.toFixed(2).replace('.', ',')}`;
            },

            checkout() {
                if (Object.keys(this.cart).length === 0) {
                    this.showToast("Sua cesta está vazia!");
                    return;
                }
                
                const listEl = document.getElementById('checkout-list');
                let html = '<ul style="list-style:none;">';
                let total = 0;

                for (const [id, qtd] of Object.entries(this.cart)) {
                    const p = this.data.find(x => x.id == id);
                    if (p) {
                        const sub = p.valor * qtd;
                        total += sub;
                        html += `<li class="flex justify-between" style="margin-bottom:8px; border-bottom:1px solid #f1f5f9; padding-bottom:8px;">
                            <span>${qtd}x ${p.nome}</span>
                            <b>R$ ${sub.toFixed(2).replace('.', ',')}</b>
                        </li>`;
                    }
                }
                
                const finalTotal = Math.max(total + this.basePrice, this.currentBasket.valor);
                
                html += `</ul>
                <div class="flex justify-between" style="margin-top:15px; font-size:1.1rem; color:var(--primary); font-weight:800;">
                    <span>TOTAL</span>
                    <span>R$ ${finalTotal.toFixed(2).replace('.', ',')}</span>
                </div>`;

                listEl.innerHTML = html;
                document.getElementById('modal-checkout').showModal();
            },

            sendWhatsapp() {
                const payment = document.querySelector('input[name="payment"]:checked').value;
                let msg = `*PEDIDO: ${this.currentBasket.nome}*\n------------------\n`;
                
                let total = 0;
                for (const [id, qtd] of Object.entries(this.cart)) {
                    const p = this.data.find(x => x.id == id);
                    if (p) {
                        total += p.valor * qtd;
                        msg += `${qtd}x ${p.nome}\n`;
                    }
                }
                
                const finalTotal = Math.max(total + this.basePrice, this.currentBasket.valor);
                
                msg += `------------------\n*TOTAL: R$ ${finalTotal.toFixed(2).replace('.', ',')}*\n`;
                msg += `Pagamento: ${payment}`;

                const phone = "5565998150975"; // Número do código original
                window.open(`https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(msg)}`, '_blank');
            },

            showToast(msg) {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 3000);
            }
        };

        // Inicializa
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
