<!DOCTYPE html>
<html lang="pt-BR" dir="ltr">
<head>
    <!-- 
        ================================================================
        SEO CONFIGURATION: OPTIMIZED
        - Fix: Carregamento exato de produtos por ID
        - Fix: Limpeza automática de caminhos de imagem
        ================================================================
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO Meta Tags Importados -->
    <title>Cestas Básicas em Cuiabá e Várzea Grande | Dona Antônia | Entrega Grátis</title>
    <meta name="description" content="A melhor Cesta Básica de Cuiabá e VG. Arroz Tio Alvino, Feijão Novo. Entrega Grátis no CPA, Coxipó, Cristo Rei e região. Pague no recebimento. A partir de R$ 85,00.">
    <meta name="keywords" content="cesta básica cuiabá, cesta básica várzea grande, doação de alimentos cpa, cesta básica cristo rei, atacado alimentos mt, arroz tio alvino">
    <meta name="author" content="Dona Antônia Alimentos">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://www.donaantonia.com.br">
    <meta name="theme-color" content="#ffffff">
    <meta name="format-detection" content="telephone=no">

    <!-- Geo Tags -->
    <meta name="geo.region" content="BR-MT" />
    <meta name="geo.placename" content="Cuiabá" />
    <meta name="geo.position" content="-15.6025;-56.0968" />
    <meta name="ICBM" content="-15.6025, -56.0968" />

    <!-- Open Graph -->
    <meta property="og:locale" content="pt_BR" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Promoção: Cestas Básicas com Entrega Grátis em Cuiabá e VG" />
    <meta property="og:description" content="Cestas completas a partir de R$ 85,00. Atendemos CPA, Coxipó, Pedra 90, Cristo Rei e toda baixada. Peça no WhatsApp!" />
    <meta property="og:url" content="https://www.donaantonia.com.br" />
    <meta property="og:site_name" content="Dona Antônia Alimentos" />
    <meta property="og:image" content="https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="500" />
    <meta property="og:image:alt" content="Logo Dona Antônia - Cestas Básicas" />
    
    <link rel="icon" href="img/favicon.ico" sizes="any">

    <!-- SCHEMA.ORG JSON-LD (Google Local Business) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "GroceryStore",
          "@id": "https://www.donaantonia.com.br/#store",
          "name": "Dona Antônia - Super Cestas Básicas",
          "image": "https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif",
          "telephone": "+5565998150975",
          "url": "https://www.donaantonia.com.br",
          "priceRange": "$$",
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "R. Trinta, 105 - Jardim Nossa Sra. Aparecida",
            "addressLocality": "Cuiabá",
            "addressRegion": "MT",
            "postalCode": "78090-660",
            "addressCountry": "BR"
          },
          "geo": { "@type": "GeoCoordinates", "latitude": -15.6025, "longitude": -56.0968 },
          "openingHoursSpecification": [
            { "@type": "OpeningHoursSpecification", "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"], "opens": "07:30", "closes": "18:00" }
          ],
          "areaServed": [ 
            { "@type": "City", "name": "Cuiabá" }, 
            { "@type": "City", "name": "Várzea Grande" }
          ],
          "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Catálogo de Cestas Básicas",
            "itemListElement": [
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Product",
                        "name": "Cesta Básica Econômica",
                        "offers": { "@type": "Offer", "price": "85.00", "priceCurrency": "BRL" }
                    }
                }
            ]
          }
        },
        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "Quais são as formas de pagamento?",
              "acceptedAnswer": { "@type": "Answer", "text": "Dinheiro, Pix, Cartão de Débito, Cartão de Crédito (parcelado em até 3x sem juros), Cartões Alimentação e Refeição Pluxee, Alelo, Flash, Caju, Ifood." }
            }
          ]
        }
      ]
    }
    </script>
    
    <style>
        /* --- 1. CORE & RESET --- */
        :root { 
            --primary: #dc2626; 
            --primary-dark: #b91c1c; 
            --secondary: #0f172a; 
            --bg: #f8fafc; 
            --surface: #ffffff; 
            --text-main: #334155; 
            --text-muted: #475569; 
            --border: #e2e8f0; 
            --header-h: 64px; 
            --radius: 12px; 
            --offer-color: #b45309;
            --focus-ring: #dc2626;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background-color: var(--bg); 
            color: var(--text-main); 
            line-height: 1.5; 
            padding-bottom: 0; 
            font-weight: 400;
            font-size: 16px; 
            -webkit-font-smoothing: antialiased; 
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 0 16px; width: 100%; }
        .hidden { display: none !important; }
        button { cursor: pointer; border: none; font-family: inherit; background: none; }
        button:focus-visible, a:focus-visible, input:focus-visible { outline: 2px solid var(--focus-ring); outline-offset: 2px; }
        img { display: block; max-width: 100%; height: auto; }

        /* --- 2. HEADER --- */
        header { 
            position: fixed; top: 0; left: 0; width: 100%; height: var(--header-h); 
            background: rgba(255,255,255,0.98); border-bottom: 1px solid var(--border); z-index: 100; 
            display: flex; align-items: center; backdrop-filter: blur(12px);
            transition: transform 0.3s ease;
        }
        body.header-hidden header { transform: translateY(-100%); }

        .header-inner { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        
        .logo { display: flex; align-items: center; gap: 10px; font-weight: 800; font-size: 1.15rem; color: var(--secondary); text-decoration: none; letter-spacing: -0.02em; }
        .logo-div { width: 38px; height: 38px; background: #e2e8f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--secondary); font-weight: 900; font-size: 0.9rem; border: 1px solid #cbd5e1; }
        
        .location-badge { 
            font-size: 0.8rem; font-weight: 700; color: var(--secondary); 
            background: #f1f5f9; padding: 6px 12px; border-radius: 50px; border: 1px solid var(--border);
        }

        /* --- 3. HOME VIEW --- */
        #home-view { padding-top: var(--header-h); min-height: 100vh; display: flex; flex-direction: column; background: var(--bg); }
        .hero { padding: 40px 0 30px; text-align: center; }
        .hero h1 { font-size: 2rem; font-weight: 800; color: var(--secondary); margin-bottom: 12px; letter-spacing: -0.03em; line-height: 1.1; }
        .hero p { color: var(--text-muted); font-size: 1.05rem; max-width: 600px; margin: 0 auto; }

        .baskets-grid { display: grid; grid-template-columns: 1fr; gap: 24px; padding-bottom: 60px; }
        @media (min-width: 640px) { .baskets-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { .baskets-grid { grid-template-columns: repeat(3, 1fr); } }
        
        .big-card { 
            background: var(--surface); border-radius: 16px; overflow: hidden; 
            display: flex; flex-direction: column; transition: transform 0.3s ease; height: 100%;
            border: 1px solid var(--border);
        }
        .big-card:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }

        .bc-image-box { width: 100%; aspect-ratio: 1/1; background: #fff; position: relative; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; justify-content: center; padding: 20px; cursor: zoom-in; }
        .bc-image { width: 100%; height: 100%; object-fit: contain; transition: transform 0.5s ease; mix-blend-mode: multiply; }
        .big-card:hover .bc-image { transform: scale(1.05); }
        
        .bc-content { padding: 20px; display: flex; flex-direction: column; flex: 1; text-align: center; }
        .bc-title { font-size: 1.5rem; font-weight: 700; color: var(--secondary); margin-bottom: 6px; }
        .bc-price { font-size: 1.4rem; font-weight: 700; color: var(--primary); margin-bottom: 20px; font-feature-settings: "tnum"; }
        
        .bc-actions { display: grid; gap: 10px; }
        .btn-full { 
            width: 100%; min-height: 48px; padding: 0 20px; border-radius: 50px; 
            font-weight: 600; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.2s;
        }
        .btn-customize { background: var(--secondary); color: white; }
        .btn-customize:hover { background: #000; transform: translateY(-1px); }
        .btn-whatsapp-outline { background: white; color: var(--secondary); border: 2px solid var(--border); }
        .btn-whatsapp-outline:hover { border-color: var(--secondary); background: #f8fafc; }

        /* --- 4. CUSTOMIZER VIEW --- */
        #customizer-view { padding-top: var(--header-h); background: var(--bg); min-height: 100vh; }
        
        .customizer-header { 
            background: rgba(255,255,255,0.98); padding: 8px 0; border-bottom: 1px solid var(--border); 
            position: sticky; top: var(--header-h); z-index: 90; backdrop-filter: blur(10px); transition: top 0.3s ease;
        }
        body.header-hidden .customizer-header { top: 0; }

        .ch-inner { display: flex; flex-wrap: wrap; align-items: center; gap: 12px; }
        
        .btn-back { 
            width: 44px; height: 44px; border-radius: 50%; background: white; border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center; font-size: 1.1rem; color: var(--secondary); flex-shrink: 0;
            transition: background 0.2s;
        }
        .btn-back:hover { background: #f1f5f9; border-color: var(--text-muted); }
        
        .cust-basket-info { flex: 1; min-width: 140px; }
        .cust-basket-info h2 { font-size: 1.1rem; font-weight: 700; line-height: 1.2; margin: 0; color: var(--secondary); }
        .cust-basket-info span { font-size: 0.85rem; color: var(--text-muted); }
        
        .search-container { width: 100%; margin-top: 5px; position: relative; }
        .search-input {
            width: 100%; height: 44px; padding: 0 40px 0 16px;
            border-radius: 50px; border: 1px solid var(--border); background: white;
            font-size: 1rem; color: var(--text-main); transition: border-color 0.2s;
        }
        .search-input:focus { outline: none; border-color: var(--secondary); }
        .search-icon { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; color: var(--text-muted); pointer-events: none; }

        .changes-counter { 
            font-size: 0.8rem; font-weight: 700; color: #b45309; 
            background: #fffbeb; padding: 4px 12px; border-radius: 50px; 
            border: 1px solid #fde68a; white-space: nowrap;
        }
        .changes-counter.limit-reached { color: #b91c1c; background: #fee2e2; border-color: #fca5a5; }

        .customizer-grid { display: block; margin-top: 24px; }
        .products-col { padding-bottom: 120px; } 
        
        .section-header { 
            width: 100%; padding: 0 0 12px; font-size: 1.1rem; font-weight: 800; color: var(--secondary); 
            text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; gap: 12px; 
            border-bottom: 2px solid var(--border); margin-bottom: 24px;
        }
        
        .basket-grid {
            display: grid; grid-template-columns: 1fr; gap: 16px; margin-bottom: 40px;
        }
        @media(min-width: 600px) { .basket-grid { grid-template-columns: repeat(2, 1fr); } }
        @media(min-width: 1024px) { .basket-grid { grid-template-columns: repeat(3, 1fr); gap: 24px; } }

        .extras-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
        @media(min-width: 600px) { .extras-grid { grid-template-columns: repeat(2, 1fr); } }
        @media(min-width: 1024px) { .extras-grid { grid-template-columns: repeat(3, 1fr); gap: 24px; } }

        .cat-separator {
            grid-column: 1 / -1;
            padding: 40px 0 20px;
            font-size: 1.25rem; font-weight: 800; color: var(--secondary);
            text-transform: uppercase; letter-spacing: 1px;
            display: flex; align-items: center; gap: 16px;
            scroll-margin-top: 140px;
        }
        .cat-separator::after { content: ""; height: 2px; background: var(--border); flex: 1; }

        .product-card {
            background: white; border-radius: 12px; padding: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04); border: 1px solid transparent;
            display: flex; flex-direction: row; gap: 16px; align-items: center;
            transition: all 0.2s; position: relative;
        }
        .product-card:hover { border-color: #cbd5e1; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.08); }

        .pc-img-box { 
            width: 90px; height: 90px; flex-shrink: 0; 
            display: flex; align-items: center; justify-content: center;
            cursor: zoom-in; background: #fff;
        }
        .pc-img { width: 100%; height: 100%; object-fit: contain; mix-blend-mode: multiply; }
        
        .pc-info { flex: 1; display: flex; flex-direction: column; justify-content: center; min-width: 0; }
        .pc-name { 
            font-size: 0.95rem; font-weight: 600; line-height: 1.35; color: var(--secondary); margin-bottom: 6px;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; 
        }
        .pc-price { font-size: 1.1rem; font-weight: 700; color: var(--primary); font-feature-settings: "tnum"; }
        .pc-meta { font-size: 0.8rem; color: var(--text-muted); font-weight: 500; }
        
        .pc-bottom { display: flex; align-items: center; justify-content: space-between; width: 100%; }
        .pc-actions { width: auto; flex-shrink: 0; }
        
        .btn-add-sm {
            height: 36px; padding: 0 16px; border-radius: 50px; border: 1px solid var(--border);
            font-size: 0.8rem; font-weight: 700; text-transform: uppercase;
            background: white; color: var(--secondary); margin-left: auto; cursor: pointer;
            transition: all 0.2s;
        }
        .btn-add-sm:hover { border-color: var(--secondary); background: #f8fafc; }
        
        .qty-control { 
            display: flex; align-items: center; justify-content: space-between;
            background: white; border: 1px solid var(--border); border-radius: 50px; 
            height: 36px; width: 100px;
        }
        .qty-btn { width: 32px; height: 100%; font-size: 1.2rem; color: var(--secondary); display:flex; align-items:center; justify-content:center; }
        .qty-val { font-weight: 700; font-size: 0.95rem; color: var(--secondary); }

        /* --- DESKTOP CARDS (Vertical Layout) --- */
        @media(min-width: 1024px) {
            .product-card { flex-direction: column; align-items: stretch; padding: 20px; text-align: center; gap: 16px; height: 100%; }
            .pc-img-box { width: 100%; height: 160px; margin: 0 auto; }
            .pc-info { justify-content: flex-start; height: 100%; }
            .pc-name { font-size: 1.05rem; -webkit-line-clamp: 2; height: 2.7em; margin-bottom: 12px; }
            .pc-bottom { margin-top: auto; flex-direction: column; gap: 12px; align-items: center; }
            .btn-add-sm, .qty-control { width: 100%; height: 42px; font-size: 0.9rem; }
            .qty-control { width: 100%; }
            .pc-actions { width: 100%; }
        }

        .order-summary-card {
            background: rgba(255,255,255,0.98); border-top: 1px solid var(--border); 
            height: 80px; padding: 0 20px; backdrop-filter: blur(12px);
            position: fixed; bottom: 0; left: 0; width: 100%; z-index: 100;
            display: flex; align-items: center; justify-content: space-between; gap: 16px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
        }
        .ff-value { font-size: 1.4rem; font-weight: 800; color: var(--primary); }
        .btn-finish { 
            background: #16a34a; color: white; padding: 0 24px; height: 48px;
            border-radius: 50px; font-weight: 700; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 15px rgba(22, 163, 74, 0.3); transition: transform 0.2s;
        }
        .btn-finish:hover { background: #15803d; }

        .credit-toast {
            position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: var(--secondary); color: white; padding: 12px 24px; border-radius: 50px;
            font-size: 0.95rem; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0; pointer-events: none; transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); z-index: 95;
            display: flex; align-items: center; gap: 10px; white-space: nowrap;
        }
        .credit-toast.visible { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }

        /* MODAL DIALOG */
        dialog {
            border: none; border-radius: 16px; padding: 0; 
            background: white; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            max-width: 500px; width: 95%; margin: auto;
        }
        dialog::backdrop { background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        
        .modal-header { padding: 16px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 1.25rem; font-weight: 700; color: var(--secondary); }
        .modal-close { width: 36px; height: 36px; border-radius: 50%; background: #f1f5f9; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; color: var(--secondary); transition: background 0.2s; }
        .modal-close:hover { background: #e2e8f0; }
        
        .modal-body { padding: 24px; max-height: 60vh; overflow-y: auto; }
        .checkout-list { list-style: none; margin-bottom: 24px; }
        .checkout-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed var(--border); font-size: 0.95rem; color: var(--text-main); }
        
        .payment-section h4 { font-size: 1rem; font-weight: 700; margin-bottom: 12px; color: var(--secondary); }
        .payment-options { display: grid; gap: 10px; }
        .payment-opt { 
            display: flex; align-items: center; gap: 12px; padding: 14px; 
            border: 1px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.2s;
        }
        .payment-opt:hover { background: #f8fafc; border-color: #cbd5e1; }
        .payment-opt:has(input:checked) { border-color: var(--primary); background: #fef2f2; }
        .payment-opt input { accent-color: var(--primary); width: 20px; height: 20px; }

        .modal-footer { padding: 20px 24px; background: #f8fafc; border-top: 1px solid var(--border); }
        .btn-confirm { width: 100%; height: 50px; background: #16a34a; color: white; border-radius: 8px; font-weight: 700; font-size: 1.1rem; }
        .btn-confirm:hover { background: #15803d; }

        /* FLOATING ACTIONS */
        .floating-actions { position: fixed; bottom: 100px; right: 20px; z-index: 90; display: flex; flex-direction: column; gap: 12px; align-items: flex-end; }
        .fab-btn {
            width: 50px; height: 50px; border-radius: 50%; background: white; 
            border: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center; color: var(--secondary); font-size: 1.3rem;
            transition: transform 0.2s, opacity 0.2s; opacity: 0; pointer-events: none;
        }
        .fab-btn.visible { opacity: 1; pointer-events: auto; }
        .fab-btn.primary { background: var(--secondary); color: white; border: none; }
        .fab-btn:active { transform: scale(0.95); }
        
        /* CATEGORY SHEET (Mobile) */
        .cat-sheet {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 200;
            display: flex; flex-direction: column; justify-content: flex-end;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .cat-sheet.open { opacity: 1; pointer-events: auto; }
        .cat-sheet-content {
            background: white; border-radius: 20px 20px 0 0; padding: 24px; max-height: 80vh; overflow-y: auto;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .cat-sheet.open .cat-sheet-content { transform: translateY(0); }
        .cat-link { display: block; padding: 14px 0; border-bottom: 1px solid #f1f5f9; font-weight: 600; color: var(--text-main); font-size: 1.05rem; }

        /* GALERIA/ZOOM */
        .gallery-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 300;
            display: flex; flex-direction: column; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .gallery-overlay.open { opacity: 1; pointer-events: auto; }
        .gallery-stage { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative; }
        .gallery-img { max-width: 100%; max-height: 100%; object-fit: contain; transform: scale(0.95); transition: transform 0.3s; }
        .gallery-overlay.open .gallery-img { transform: scale(1); }
        .gallery-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 2rem; padding: 20px; cursor: pointer; z-index: 310; }
        .gallery-thumbs { height: 100px; display: flex; justify-content: center; gap: 10px; padding: 20px; overflow-x: auto; }
        .g-thumb { width: 60px; height: 60px; border-radius: 6px; border: 2px solid transparent; opacity: 0.5; object-fit: cover; cursor: pointer; }
        .g-thumb.active { border-color: white; opacity: 1; }

        /* --- STYLES FOR FAQ & INFO (NEW) --- */
        details.faq-item { background: white; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 12px; overflow: hidden; }
        details.faq-item summary { padding: 16px; cursor: pointer; font-weight: 600; display: flex; justify-content: space-between; list-style: none; align-items: center; color: var(--secondary); }
        details.faq-item summary::after { content: "+"; font-size: 1.5rem; color: var(--primary); line-height: 0.5; font-weight: 700; }
        details.faq-item[open] summary::after { content: "-"; }
        .faq-answer { padding: 16px; color: var(--text-muted); line-height: 1.6; border-top: 1px solid #f3f4f6; }
        .hood-list { display: flex; flex-wrap: wrap; gap: 8px; padding: 0; list-style: none; margin-top: 10px; }
        .hood-tag { background: #fee2e2; color: #991b1b; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; }

        /* DESKTOP LAYOUT */
        @media(min-width: 1024px) {
            .container { padding: 0 40px; }
            .hero h1 { font-size: 3rem; }
            .search-container { width: 320px; margin-top: 0; margin-left: auto; }
            
            .customizer-grid { display: grid; grid-template-columns: 1fr 340px; gap: 40px; align-items: start; }
            .products-col { padding-bottom: 60px; }
            
            .sidebar-col { 
                position: sticky; top: 90px; height: fit-content; 
                display: flex; flex-direction: column; gap: 24px; align-self: start;
            }
            
            .order-summary-card { position: static; height: auto; border: 1px solid var(--border); border-radius: 16px; flex-direction: column; padding: 24px; gap: 20px; box-shadow: none; }
            .floating-actions { display: none; }
            
            .desktop-cat-nav { display: block; background: white; padding: 24px; border-radius: 16px; border: 1px solid var(--border); }
            .desktop-cat-link { display: block; padding: 10px 0; color: var(--text-muted); transition: 0.2s; cursor: pointer; border-bottom: 1px solid #f8fafc; font-weight: 500; }
            .desktop-cat-link:last-child { border-bottom: none; }
            .desktop-cat-link:hover { color: var(--primary); padding-left: 5px; }
        }
        .desktop-cat-nav { display: none; }

    </style>
</head>
<body>

    <header>
        <div class="container header-inner">
            <a href="#" class="logo" onclick="location.reload()" aria-label="Voltar ao início">
                <div class="logo-div" aria-hidden="true">DA</div>
                <span>Dona Antônia</span>
            </a>
            <span class="location-badge">Cuiabá & VG</span>
        </div>
    </header>

    <!-- FLOATING ACTIONS (MOBILE) -->
    <div class="floating-actions">
        <button id="btn-cat-fab" class="fab-btn primary" onclick="App.toggleCategorySheet()" aria-label="Ver Categorias">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h7"></path></svg>
        </button>
        <button id="btn-scroll-top" class="fab-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" aria-label="Voltar ao topo">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
        </button>
    </div>

    <!-- CATEGORY SHEET (MOBILE) -->
    <div id="cat-sheet" class="cat-sheet" onclick="if(event.target === this) App.toggleCategorySheet()">
        <div class="cat-sheet-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="font-weight:700; color:var(--secondary); margin:0;">Categorias</h3>
                <button onclick="App.toggleCategorySheet()" style="font-size:1.5rem; padding:10px; border:none; background:none;">✕</button>
            </div>
            <div id="mobile-cat-list"></div>
        </div>
    </div>

    <!-- CREDIT TOAST -->
    <div id="credit-toast" class="credit-toast">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <span id="credit-text">Crédito disponível: R$ 0,00</span>
    </div>

    <!-- HOME VIEW -->
    <main id="home-view">
        <section class="hero">
            <div class="container">
                <h1>Cestas Básicas Premium</h1>
                <p>Qualidade selecionada e economia real para sua família.</p>
            </div>
        </section>

        <section class="container">
            <div id="baskets-list" class="baskets-grid">
                <div style="padding:40px; text-align:center;">Carregando coleções...</div>
            </div>
        </section>

        <!-- FAQ SECTION (INTEGRADO DA PÁGINA SEO) -->
        <section class="container" style="padding-top: 60px; padding-bottom: 20px;">
            <h2 style="font-size: 1.4rem; margin-bottom: 20px; color: var(--secondary); font-weight: 800;">Dúvidas Frequentes & Atendimento</h2>
            
            <details class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">Quais são as formas de pagamento?</summary>
                <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer" class="faq-answer">
                    <span itemprop="text">Dinheiro, Pix, Cartão de Débito, Cartão de Crédito (parcelado em até 3x sem juros), Cartões Alimentação e Refeição Pluxee, Alelo, Flash, Caju, Ifood.</span>
                </div>
            </details>

            <details class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">Eu pago só na entrega do pedido?</summary>
                <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer" class="faq-answer">
                    <span itemprop="text">Sim, aqui você faz o pagamento somente na entrega do pedido na sua casa.</span>
                </div>
            </details>

            <details class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">A entrega é grátis?</summary>
                <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer" class="faq-answer">
                    <span itemprop="text">Sim, mas apenas em vendas acima de R$ 85. Compras de valores menor possuem taxa de entrega de R$ 15</span>
                </div>
            </details>
            
            <details class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">Eu posso trocar algum produto da cesta básica por outro?</summary>
                <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer" class="faq-answer">
                    <span itemprop="text">Sim. Peço ao atendente pelo whatsapp para fazer a substituição.</span>
                </div>
            </details>

             <details class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">De qual cidade vocês são?</summary>
                <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer" class="faq-answer">
                    <span itemprop="text">Somos de Cuiabá, estamos localizados no bairro Nossa Senhora Aparecida em Cuiabá.</span>
                </div>
            </details>

            <details class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">Quanto tempo para entregar meu pedido?</summary>
                <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer" class="faq-answer">
                    <span itemprop="text">Todas as entregas são feitas no dia seguinte de segunda a sábado.</span>
                </div>
            </details>

            <!-- Bairros Atendidos -->
            <details class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <summary itemprop="name">Veja os Bairros Atendidos (Cuiabá e VG)</summary>
                <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer" class="faq-answer">
                    <p>A Dona Antônia é referência na distribuição de cestas básicas na baixada cuiabana. Realizamos entrega rápida em domicílio com frota própria.</p>
            
                    <div style="margin-top: 15px;">
                        <p style="font-size: 0.9rem; color: var(--secondary); margin-bottom: 5px; font-weight: 700;">Cuiabá (Zona Oeste)</p>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px;">
                            Alvorada, Araés, Barra do Pari, Centro Norte, Centro Sul, Cidade Alta, Cidade Verde, Coophamil, Consil, Despraiado, Duque de Caxias, Goiabeiras, Jardim Beira Rio, Jardim Cuiabá, Jardim Mariana, Jardim Santa Isabel, Jardim Ubirajara, Jardim Monte Líbano, Jardim Primavera, Novo Colorado, Novo Terceiro, Parque Residencial Tropical Ville, Popular, Porto, Quilombo, Ribeirão da Ponte, Ribeirão do Lipa, Santa Marta, Santa Rosa, Residencial Sucuri, Verdão.
                        </p>
        
                        <p style="font-size: 0.9rem; color: var(--secondary); margin-bottom: 5px; font-weight: 700;">Cuiabá (Zona Norte)</p>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px;">
                            Centro Político Administrativo, Jardim Florianópolis, Jardim União, Jardim Vitória, Jardim Aroeiras, Morada da Serra (CPA I, II, III, IV), Morada do Ouro, Nova Conquista, Novo Paraíso I e II, Primeiro de Março, Três Barras, Ouro Fino, Residencial Pádova, Serra Dourada, Doutor Fábio Leite I e II (Santa Fé), Altos da Glória, Jardim Umuarama I e II, Nova Canaã I, II e III, Jardim Brasil, Altos da Serra I e II, Centro América, Flor da Mata, Tancredo Neves, Residencial Jardim Videira.
                        </p>
        
                        <p style="font-size: 0.9rem; color: var(--secondary); margin-bottom: 5px; font-weight: 700;">Cuiabá (Zona Leste)</p>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px;">
                            Areão, Bandeirantes, Baú, Bela Marina, Bela Vista, Boa Esperança, Bosque da Saúde, Cachoeira das Garças, Campo Velho, São Mateus, Canjica, Carumbé, Dom Aquino, Dom Bosco, Grande Terceiro, Jardim Aclimação, Jardim das Américas, Jardim Califórnia, Jardim Eldorado, Jardim Europa, Jardim Imperial, Jardim Itália, Jardim Leblon, Jardim Paulista, Jardim Petrópolis, Jardim Shangri-Lá, Jardim Tropical, Jardim Universitário, Lixeira, Morada dos Nobres, Novo Mato Grosso, Novo Horizonte, Planalto, Paiaguás, Pedregal, Pico do Amor, Poção, Praeirinho, Praeiro, Recanto dos Pássaros, Residencial Itamarati, Residencial Santa Inês, Residencial São Carlos, Santa Cruz, São Roque, Sol Nascente, Terra Nova, Terceiro, UFMT.
                        </p>
        
                        <p style="font-size: 0.9rem; color: var(--secondary); margin-bottom: 5px; font-weight: 700;">Cuiabá (Zona Sul)</p>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px;">
                            Altos do Cerrado, Altos do Coxipó, Cohab São Gonçalo, Coophema, Coxipó, Jardim Comodoro, Jardim Fortaleza, Jardim Gramado, Jardim Industriário, Jardim dos Ipês, Jardim Mossoró, Jardim das Palmeiras, Jardim Passaredo, Jardim Presidente, Jordão, Lagoa Azul, Nossa Senhora Aparecida, Nova Esperança, Novo Milênio, Osmar Cabral, Parque Atalaia, Parque Cuiabá, Parque Georgia, Parque Residencial, Parque Ohara, Pascoal Ramos, Pedra 90, Real Parque, Residencial Coxipó, Residencial Itapajé, Residencial Santa Terezinha I e II, Santa Laura, São Gonçalo, São Gonçalo Beira Rio, São João Del Rei, São José, São Sebastião, São Francisco, Tijucal, Vista Alegre.
                        </p>
        
                        <hr style="margin: 10px 0; border: 0; border-top: 1px solid #eee;">
        
                        <p style="font-size: 0.9rem; color: var(--secondary); margin-bottom: 5px; font-weight: 700;">Várzea Grande (Centro e Arredores)</p>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px;">
                            Água Limpa, Água Vermelha, Canelas, Centro, Centro Norte, Centro Sul, Cohab Canelas, Costa Verde, Figueirinha, Frutal de Minas, Ipase (Vila Ipase), Jardim Aeroporto, Jardim dos Estados, Jardim Eldorado, Jardim Icaraí, Jardim Paula I e II, Jardim Potiguar, Jardim Novo Horizonte, Nova Várzea Grande, Panamericano, Pirinéu, Planalto Ipiranga, Treze de Setembro, Vila Artur, Vila Operária, Vila São João, Vitória Régia.
                        </p>
                    </div>
                </div>
            </details>
        </section>
        
        <footer style="margin-top: auto; padding: 40px 20px; text-align: center; color: var(--text-muted); font-size: 0.9rem; border-top: 1px solid var(--border);">
            <p>© 2024 Dona Antônia Alimentos</p>
        </footer>
    </main>

    <!-- CUSTOMIZER VIEW -->
    <div id="customizer-view" class="hidden">
        <div class="customizer-header">
            <div class="container ch-inner">
                <button class="btn-back" onclick="App.showHome()" aria-label="Voltar">❮</button>
                <div class="cust-basket-info">
                    <h2 id="cust-basket-name">Nome da Cesta</h2>
                    <span>Personalize sua escolha</span>
                </div>
                <!-- BUSCA -->
                <div class="search-container">
                    <input type="text" id="product-search" class="search-input" placeholder="Buscar item extra..." aria-label="Buscar produtos">
                    <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
                <div id="changes-badge" class="changes-counter" style="display:none;">Trocas: 0/0</div>
            </div>
        </div>

        <div class="container customizer-grid">
            <div class="products-col">
                <!-- ITENS INCLUSOS -->
                <div class="basket-group">
                    <h3 class="section-header">Itens Inclusos</h3>
                    <div id="basket-items-container" class="basket-grid"></div>
                </div>

                <!-- EXTRAS -->
                <div>
                    <h3 class="section-header">Adicionar Extras</h3>
                    <div id="other-items-container"></div>
                </div>
            </div>

            <!-- SIDEBAR (Desktop) -->
            <aside class="sidebar-col">
                <!-- Nav Categorias Desktop -->
                <nav class="desktop-cat-nav" aria-label="Navegação de categorias">
                    <h3 style="margin-bottom:15px; font-weight:800; color:var(--secondary); font-size:1.1rem;">Navegação Rápida</h3>
                    <div id="desktop-cat-list"></div>
                </nav>

                <!-- Resumo -->
                <div class="order-summary-card">
                    <div class="ff-info">
                        <span style="font-size:0.8rem; text-transform:uppercase; letter-spacing:1px; color:var(--text-muted); font-weight:700;">Total Estimado</span>
                        <span class="ff-value" id="ff-total-val">R$ 0,00</span>
                    </div>
                    <button class="btn-finish" onclick="App.openCheckout()">
                        <span>Finalizar Pedido</span>
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                    </button>
                </div>
            </aside>
        </div>
    </div>

    <!-- GALLERY OVERLAY (ZOOM) -->
    <div id="gallery-overlay" class="gallery-overlay" aria-modal="true" role="dialog" aria-label="Galeria de Imagens">
        <button class="gallery-close" onclick="Gallery.close()" aria-label="Fechar Galeria">✕</button>
        <div class="gallery-stage" onclick="Gallery.close()">
            <img src="" id="gallery-img" class="gallery-img" onclick="event.stopPropagation()" alt="Imagem ampliada">
        </div>
        <div id="gallery-thumbs" class="gallery-thumbs"></div>
    </div>

    <!-- CHECKOUT MODAL -->
    <dialog id="checkout-modal">
        <div class="modal-header">
            <h3 class="modal-title">Revisar Pedido</h3>
            <button class="modal-close" onclick="document.getElementById('checkout-modal').close()" aria-label="Fechar">✕</button>
        </div>
        <div class="modal-body">
            <!-- Lista de Produtos -->
            <ul id="checkout-list" class="checkout-list"></ul>

            <!-- Total -->
            <div style="text-align:right; font-weight:800; font-size:1.4rem; color:var(--primary); margin-bottom:24px;">
                Total: <span id="checkout-total">R$ 0,00</span>
            </div>

            <!-- Forma de Pagamento -->
            <div class="payment-section">
                <h4>Forma de Pagamento</h4>
                <div class="payment-options">
                    <label class="payment-opt">
                        <input type="radio" name="payment" value="Pix" checked>
                        <span>PIX (Instantâneo)</span>
                    </label>
                    <label class="payment-opt">
                        <input type="radio" name="payment" value="Dinheiro">
                        <span>Dinheiro</span>
                    </label>
                    <label class="payment-opt">
                        <input type="radio" name="payment" value="Cartão de Crédito">
                        <span>Cartão de Crédito</span>
                    </label>
                    <label class="payment-opt">
                        <input type="radio" name="payment" value="Cartão de Débito">
                        <span>Cartão de Débito</span>
                    </label>
                    <label class="payment-opt">
                        <input type="radio" name="payment" value="Cartão Alimentação">
                        <span>Cartão Alimentação</span>
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-confirm" onclick="App.confirmCheckout()">
                Confirmar e Enviar
            </button>
        </div>
    </dialog>

    <script>
        const BASKET_LIMITS = { 
            'econômica': 5, 'economica': 5, 
            'mini': 7, 
            'pequena': 9, 
            'média': 11, 'media': 11, 
            'grande': 13 
        };

        const Gallery = {
            open(mainSrc, productName) {
                const ol = document.getElementById('gallery-overlay');
                const img = document.getElementById('gallery-img');
                const thumbs = document.getElementById('gallery-thumbs');
                
                img.src = mainSrc;
                img.alt = productName; // Accessibility fix
                ol.classList.add('open');

                const baseName = mainSrc.replace(/(\.[\w\d_-]+)$/i, '');
                const ext = mainSrc.match(/(\.[\w\d_-]+)$/i) ? mainSrc.match(/(\.[\w\d_-]+)$/i)[0] : '';
                
                let html = `<img src="${mainSrc}" class="g-thumb active" onclick="Gallery.swap(this, '${mainSrc}')" alt="Miniatura ${productName}">`;
                thumbs.innerHTML = html;
            },
            swap(el, src) {
                document.getElementById('gallery-img').src = src;
                document.querySelectorAll('.g-thumb').forEach(t => t.classList.remove('active'));
                el.classList.add('active');
            },
            close() {
                document.getElementById('gallery-overlay').classList.remove('open');
            }
        };

        const App = {
            data: [], cart: {}, originalCart: {}, baseFee: 0, currentBasket: null, currentLimit: 99, phone: "5565998150975", searchTerm: "", categories: [],

            async init() {
                try {
                    const response = await fetch('produtos/produtos.json');
                    const raw = await response.json();

                    this.data = raw.map(p => {
                        // Limpeza robusta do caminho da imagem
                        // Se o JSON trouxer caminhos complexos, forçamos 'img/produtos/nomedoarquivo'
                        let imgPath = p.imagem || '';
                        if (imgPath && imgPath.includes('/')) {
                            const parts = imgPath.split('/');
                            // Pega a última parte (o nome do arquivo)
                            const fileName = parts[parts.length - 1];
                            imgPath = `img/produtos/${fileName}`;
                        } else if (imgPath) {
                            imgPath = `img/produtos/${imgPath}`;
                        }

                        return {
                            ...p, 
                            id: String(p.id), 
                            valor: parseFloat(p.valor || 0),
                            categoria: (p.categoria || 'OUTROS').toUpperCase().trim(),
                            imagem: imgPath,
                            items: p.items || [], 
                            isOffer: p.oferta && p.oferta.toLowerCase() === 'sim'
                        };
                    });

                    this.renderHome();
                    this.setupScroll();
                    
                    document.getElementById('product-search').addEventListener('input', (e) => {
                        this.searchTerm = e.target.value.toLowerCase();
                        this.renderCustomizerLists();
                    });
                } catch (e) {
                    console.error("Erro ao carregar:", e);
                    document.getElementById('baskets-list').innerHTML = '<div style="padding:40px; text-align:center;">Erro ao carregar produtos. Verifique se o arquivo produtos.json existe.</div>';
                }
            },

            setupScroll() {
                const topBtn = document.getElementById('btn-scroll-top');
                const catBtn = document.getElementById('btn-cat-fab');
                let lastY = 0;
                
                window.addEventListener('scroll', () => {
                    const y = window.scrollY;
                    if (y > 60 && y > lastY) document.body.classList.add('header-hidden');
                    else document.body.classList.remove('header-hidden');
                    lastY = y;

                    if (y > 300) {
                        topBtn.classList.add('visible');
                        if(this.currentBasket) catBtn.classList.add('visible');
                    } else {
                        topBtn.classList.remove('visible');
                        catBtn.classList.remove('visible');
                    }
                });
            },

            renderHome() {
                const container = document.getElementById('baskets-list');
                const cestas = this.data.filter(p => p.categoria === 'CESTA BÁSICA');
                container.innerHTML = cestas.map(p => `
                    <div class="big-card">
                        <div class="bc-image-box" onclick="Gallery.open('${p.imagem}', '${p.nome}')">
                            <img src="${p.imagem}" alt="${p.nome}" class="bc-image">
                        </div>
                        <div class="bc-content">
                            <h2 class="bc-title">${p.nome}</h2>
                            <div class="bc-price">R$ ${p.valor.toFixed(2).replace('.', ',')}</div>
                            <div class="bc-actions">
                                <button class="btn-full btn-customize" onclick="App.openCustomizer('${p.id}')">Personalizar</button>
                                <button class="btn-full btn-whatsapp-outline" onclick="App.directOrder('${p.id}')">Pedir Direto</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            openCustomizer(basketId) {
                const basket = this.data.find(p => p.id === basketId);
                if (!basket) return;
                this.currentBasket = basket;
                this.cart = {};
                this.searchTerm = "";
                document.getElementById('product-search').value = "";

                // POPULA O CARRINHO COM BASE NOS IDS (Correção Principal)
                if (basket.items && Array.isArray(basket.items)) {
                    basket.items.forEach(item => {
                        let productMatch = null;

                        // 1. Tenta buscar EXATAMENTE pelo ID (Mais seguro e preciso)
                        if (item.id) {
                            productMatch = this.data.find(p => p.id === String(item.id));
                        }

                        // 2. Fallback: Se não achar por ID, tenta pelo nome (Modo legado)
                        if (!productMatch && (item.nome || typeof item === 'string')) {
                            const nameToSearch = (item.nome || item).toString().toLowerCase();
                            // Tenta match exato primeiro
                            productMatch = this.data.find(p => p.categoria !== 'CESTA BÁSICA' && p.nome.toLowerCase() === nameToSearch);
                            
                            // Se ainda não achar, tenta parcial (primeira palavra) - Cuidado com falsos positivos
                            if (!productMatch) {
                                const firstWord = nameToSearch.split(' ')[0];
                                if (firstWord.length > 3) { 
                                    productMatch = this.data.find(p => p.categoria !== 'CESTA BÁSICA' && p.nome.toLowerCase().includes(firstWord));
                                }
                            }
                        }

                        // Se encontrou o produto, adiciona ao carrinho
                        if (productMatch) {
                            const qty = parseInt(item.qty || item.qtd || 1);
                            this.cart[productMatch.id] = (this.cart[productMatch.id] || 0) + qty;
                        }
                    });
                }
                
                this.originalCart = {...this.cart};
                
                const nameKey = basket.nome.toLowerCase().replace('cesta', '').trim();
                let limitKey = Object.keys(BASKET_LIMITS).find(k => nameKey.includes(k));
                this.currentLimit = limitKey ? BASKET_LIMITS[limitKey] : 99;

                let sumItems = 0;
                for(let id in this.cart) {
                    let p = this.data.find(x => x.id === id);
                    if(p) sumItems += p.valor * this.cart[id];
                }
                this.baseFee = basket.valor - sumItems;

                document.getElementById('cust-basket-name').innerText = basket.nome;
                document.getElementById('home-view').classList.add('hidden');
                document.getElementById('customizer-view').classList.remove('hidden');
                window.scrollTo(0,0);
                this.renderCustomizerLists();
            },

            showHome() {
                document.getElementById('customizer-view').classList.add('hidden');
                document.getElementById('home-view').classList.remove('hidden');
                document.getElementById('btn-cat-fab').classList.remove('visible');
                document.getElementById('credit-toast').classList.remove('visible');
                this.currentBasket = null;
            },

            renderCustomizerLists() {
                const basketContainer = document.getElementById('basket-items-container');
                const othersContainer = document.getElementById('other-items-container');
                const catListDesktop = document.getElementById('desktop-cat-list');
                const catListMobile = document.getElementById('mobile-cat-list');
                const badge = document.getElementById('changes-badge');

                // 1. Itens Inclusos
                let basketItems = Object.keys(this.cart).map(id => this.data.find(x => x.id === id)).filter(p => p);
                
                if (basketItems.length === 0) basketContainer.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:20px; color:#999;">Cesta vazia</div>';
                else {
                    basketContainer.innerHTML = basketItems.map(p => `
                        <div class="product-card">
                            <div class="pc-img-box" onclick="Gallery.open('${p.imagem}', '${p.nome}')">
                                <img src="${p.imagem}" alt="${p.nome}" class="pc-img" loading="lazy">
                            </div>
                            <div class="pc-info">
                                <div class="pc-name">${p.nome}</div>
                                <div class="pc-bottom">
                                    <div class="pc-meta">${this.originalCart[p.id] ? 'Incluso' : 'Adicionado'}</div>
                                    <div class="pc-actions">
                                        <div class="qty-control">
                                            <button class="qty-btn" onclick="App.changeQty('${p.id}', -1)" aria-label="Remover 1 ${p.nome}">-</button>
                                            <span class="qty-val">${this.cart[p.id]}</span>
                                            <button class="qty-btn" onclick="App.changeQty('${p.id}', 1)" aria-label="Adicionar 1 ${p.nome}">+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }

                // 2. Extras (Filtrados)
                let extras = this.data.filter(p => p.categoria !== 'CESTA BÁSICA' && (!this.searchTerm || p.nome.toLowerCase().includes(this.searchTerm)));
                
                let groups = {};
                extras.forEach(p => { if(!groups[p.categoria]) groups[p.categoria]=[]; groups[p.categoria].push(p); });
                let cats = Object.keys(groups).sort();
                this.categories = cats;

                const navHTML = cats.map(c => `<a class="desktop-cat-link cat-link" onclick="App.scrollToCat('${c}')">${c}</a>`).join('');
                catListDesktop.innerHTML = navHTML;
                catListMobile.innerHTML = navHTML;

                let html = '';
                if(extras.length === 0) html = '<div style="text-align:center; padding:40px;">Nenhum produto encontrado.</div>';
                else {
                    cats.forEach(c => {
                        html += `<div id="cat-${c}" class="cat-separator"><span>${c}</span></div><div class="extras-grid">`;
                        html += groups[c].map(p => {
                            let qty = this.cart[p.id] || 0;
                            let btn = qty === 0 
                                ? `<button class="btn-add-sm" onclick="App.changeQty('${p.id}', 1)" aria-label="Adicionar ${p.nome}">Adicionar</button>` 
                                : `<div class="qty-control">
                                     <button class="qty-btn" onclick="App.changeQty('${p.id}', -1)" aria-label="Remover 1 ${p.nome}">-</button>
                                     <span class="qty-val">${qty}</span>
                                     <button class="qty-btn" onclick="App.changeQty('${p.id}', 1)" aria-label="Adicionar 1 ${p.nome}">+</button>
                                   </div>`;
                            return `
                                <div class="product-card">
                                    <div class="pc-img-box" onclick="Gallery.open('${p.imagem}', '${p.nome}')">
                                        <img src="${p.imagem}" alt="${p.nome}" class="pc-img" loading="lazy">
                                    </div>
                                    <div class="pc-info">
                                        <div class="pc-name">${p.nome}</div>
                                        <div class="pc-bottom">
                                            <div class="pc-price">R$ ${p.valor.toFixed(2).replace('.', ',')}</div>
                                            <div class="pc-actions">${btn}</div>
                                        </div>
                                    </div>
                                </div>`;
                        }).join('');
                        html += `</div>`;
                    });
                }
                othersContainer.innerHTML = html;

                const removals = this.countRemovals();
                badge.innerText = `Excluídos: ${removals}/${this.currentLimit}`;
                badge.style.display = 'block';
                if(removals >= this.currentLimit) badge.classList.add('limit-reached');
                else badge.classList.remove('limit-reached');

                this.updateTotal();
            },

            countRemovals() {
                let removals = 0;
                for(let id in this.originalCart) {
                    if (this.originalCart[id] > 0 && (!this.cart[id] || this.cart[id] === 0)) {
                        removals++;
                    }
                }
                return removals;
            },

            changeQty(id, delta) {
                const currentQty = this.cart[id] || 0;
                const newQty = currentQty + delta;
                
                if (this.originalCart[id] && delta < 0 && newQty === 0) {
                    const currentRemovals = this.countRemovals();
                    if (currentRemovals >= this.currentLimit) {
                        alert(`Limite de ${this.currentLimit} produtos excluídos atingido.`);
                        return;
                    }
                }

                if(!this.cart[id]) this.cart[id] = 0;
                this.cart[id] += delta;
                if(this.cart[id] <= 0) delete this.cart[id];
                this.renderCustomizerLists();
            },

            updateTotal() {
                let itemsSum = 0;
                for(let id in this.cart) {
                    let p = this.data.find(x => x.id === id);
                    if(p) itemsSum += p.valor * this.cart[id];
                }

                const originalPrice = this.currentBasket.valor;
                let calculatedTotal = itemsSum + this.baseFee;
                let finalTotal = Math.max(calculatedTotal, originalPrice);
                
                let credit = 0;
                if (calculatedTotal < originalPrice) {
                    credit = originalPrice - calculatedTotal;
                }

                document.getElementById('ff-total-val').innerText = 'R$ ' + finalTotal.toFixed(2).replace('.', ',');
                
                const toast = document.getElementById('credit-toast');
                if (credit > 0) {
                    document.getElementById('credit-text').innerText = `Crédito para gastar: R$ ${credit.toFixed(2).replace('.', ',')}`;
                    toast.classList.add('visible');
                } else {
                    toast.classList.remove('visible');
                }

                return finalTotal;
            },

            toggleCategorySheet() {
                document.getElementById('cat-sheet').classList.toggle('open');
            },
            scrollToCat(cat) {
                const el = document.getElementById('cat-'+cat);
                if(el) {
                    window.scrollTo({top: el.offsetTop - 140, behavior: 'smooth'});
                    document.getElementById('cat-sheet').classList.remove('open');
                }
            },

            openCheckout() {
                if(Object.keys(this.cart).length === 0) return alert("Cesta vazia");
                
                const listEl = document.getElementById('checkout-list');
                listEl.innerHTML = '';
                
                let total = this.updateTotal();
                
                for(let id in this.cart) {
                    let p = this.data.find(x => x.id === id);
                    if(p) {
                        listEl.innerHTML += `
                            <li class="checkout-item">
                                <span>${this.cart[id]}x ${p.nome}</span>
                            </li>
                        `;
                    }
                }
                
                document.getElementById('checkout-total').innerText = 'R$ ' + total.toFixed(2).replace('.', ',');
                document.getElementById('checkout-modal').showModal();
            },

            confirmCheckout() {
                const payment = document.querySelector('input[name="payment"]:checked').value;
                const totalStr = document.getElementById('checkout-total').innerText;
                
                let msg = `*NOVO PEDIDO: ${this.currentBasket.nome}*\n--------------------------------\n`;
                msg += `*ITENS:*\n`;
                for(let id in this.cart) {
                    let p = this.data.find(x => x.id === id);
                    if(p) msg += `${this.cart[id]}x ${p.nome}\n`;
                }
                
                msg += `--------------------------------\n`;
                msg += `*TOTAL: ${totalStr}*\n`;
                msg += `*PAGAMENTO:* ${payment}\n`;
                
                window.open(`https://api.whatsapp.com/send?phone=${this.phone}&text=${encodeURIComponent(msg)}`, '_blank');
                document.getElementById('checkout-modal').close();
            },

            directOrder(id) {
                const p = this.data.find(x => x.id === id);
                let msg = `Olá! Tenho interesse na *${p.nome}*.`;
                window.open(`https://api.whatsapp.com/send?phone=${this.phone}&text=${encodeURIComponent(msg)}`, '_blank');
            }
        };

        document.addEventListener('DOMContentLoaded', () => { App.init(); });
    </script>
</body>
</html>