<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <title>Super Cestas Dona Ant√¥nia | Cuiab√° e V√°rzea Grande</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web" defer></script>

    <style>
        /* --- ESTILOS BASE DO INDEX ATUAL --- */
        :root {
            --primary: #d31a28; /* Vermelho do Index 1 para manter identidade */
            --primary-gradient: linear-gradient(135deg, #d31a28 0%, #b91c1c 100%);
            --success: #10B981;
            --background: #F3F4F6;
            --text-main: #111827;
            --header-h: 70px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--background); color: var(--text-main); }
        body.customizer-mode { background: #fff; }
        .hidden { display: none !important; }

        /* HEADER */
        .app-header {
            height: var(--header-h); background: #fff; border-bottom: 1px solid #eee;
            display: flex; align-items: center; justify-content: center; position: sticky; top: 0; z-index: 1000;
        }
        .logo-header { width: 60px; height: 60px; border-radius: 50%; }

        /* HERO BANNER (DO INDEX 1) */
        .hero-banner-section { padding: 20px 0; background: #fff; overflow: hidden; border-bottom: 1px solid #eee; }
        .hb-track { display: flex; gap: 16px; overflow-x: auto; scroll-snap-type: x mandatory; padding: 10px; scrollbar-width: none; }
        .hb-track::-webkit-scrollbar { display: none; }
        .hb-card { flex: 0 0 85%; scroll-snap-align: center; background: #f8fafc; border-radius: 16px; padding: 20px; display: flex; align-items: center; gap: 15px; border: 1px solid #e2e8f0; }
        @media(min-width: 1024px) { .hb-card { flex: 0 0 30%; } }
        .hb-icon { font-size: 1.5rem; }
        .hb-text { font-weight: 600; font-size: 0.9rem; }

        /* CARROSSEL OFERTAS (DO INDEX 1) */
        .offers-section { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .carousel-track { display: flex; gap: 15px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .offer-mini-card { flex: 0 0 140px; background: #fff; padding: 10px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; }
        .offer-mini-card img { width: 100%; border-radius: 8px; }

        /* GRID DE CESTAS */
        .catalog-container { padding: 20px; display: grid; grid-template-columns: 1fr; gap: 20px; max-width: 1200px; margin: 0 auto; }
        @media (min-width: 1024px) { .catalog-container { grid-template-columns: repeat(3, 1fr); } }

        .product-section { background: white; border-radius: 24px; box-shadow: 0 10px 15px rgba(0,0,0,0.05); overflow: hidden; display: flex; flex-direction: column; border: 1px solid #eee; }
        .p-main-content { padding: 20px; display: flex; flex-direction: column; height: 100%; }
        .basket-hero-img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 16px; }
        
        /* CHAT / CUSTOMIZER (DO INDEX 1) */
        #customizer-view { padding: 20px; max-width: 800px; margin: 0 auto; }
        .chat-msg { background: #f1f5f9; padding: 15px; border-radius: 0 15px 15px 15px; margin-bottom: 15px; max-width: 85%; }
        .chat-msg.user { background: var(--primary); color: white; margin-left: auto; border-radius: 15px 15px 0 15px; }
        .chat-actions { display: grid; gap: 10px; grid-template-columns: 1fr 1fr; }
        .btn-chat { padding: 12px; border: 1px solid var(--primary); border-radius: 10px; background: #fff; color: var(--primary); font-weight: 600; }
        .btn-chat.primary { grid-column: 1/-1; background: var(--primary); color: #fff; }

        /* BARRA DE TOTAL FIXA */
        .credit-chip-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #111827; color: #fff; padding: 15px 25px; border-radius: 50px; display: flex; justify-content: space-between; align-items: center; width: 90%; max-width: 400px; z-index: 2000; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }

        /* GRID PRODUTOS NO CHAT */
        .grid-products-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .card-prod { background: #f8fafc; padding: 10px; border-radius: 12px; text-align: center; position: relative; }
        .card-prod img { width: 100%; border-radius: 8px; }
        .qty-ctrl-float { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 5px; }
        .btn-circle-add { background: var(--primary); color: #fff; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; margin: 0 auto; }
    </style>
</head>
<body>

    <header class="app-header">
        <div id="header-home-content" style="display: flex; align-items: center;">
            <img src="https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" class="logo-header" alt="Logo">
            <h1 style="font-size: 18px; margin-left: 10px;">Dona Ant√¥nia</h1>
        </div>
        <div id="header-customizer-content" class="hidden">
            <button onclick="App.goHome()" style="background:none; border:none; font-size: 20px; cursor:pointer;"><i class="ph ph-arrow-left"></i> Voltar</button>
        </div>
    </header>

    <main id="home-view">
        <section class="hero-banner-section">
            <div id="hero-banner-track" class="hb-track">
                <div class="hb-card"><span class="hb-icon">üöö</span><div class="hb-text">Entrega Gr√°tis<br>Cuiab√° e VG</div></div>
                <div class="hb-card"><span class="hb-icon">üè†</span><div class="hb-text">Pague apenas<br>na Entrega</div></div>
                <div class="hb-card"><span class="hb-icon">üí≥</span><div class="hb-text">3x Sem Juros<br>no Cart√£o</div></div>
                <div class="hb-card"><span class="hb-icon">üöÄ</span><div class="hb-text">Pe√ßa at√© 9h<br>Receba Hoje</div></div>
            </div>
        </section>

        <section id="offers-container" class="offers-section hidden">
            <h3 style="margin-bottom: 10px;"><i class="ph ph-fire" style="color:red"></i> Ofertas do Dia</h3>
            <div id="offers-track" class="carousel-track"></div>
        </section>

        <div id="catalog-mount" class="catalog-container"></div>
    </main>

    <div id="customizer-view" class="hidden">
        <div id="chat-stream"></div>
    </div>

    <div id="credit-chip" class="credit-chip-bar hidden">
        <div>
            <div style="font-size: 11px; opacity: 0.8;">Total do Pedido</div>
            <div id="ccb-val" style="font-weight: 800; font-size: 18px;">R$ 0,00</div>
        </div>
        <button onclick="ChatFlow.startCheckout()" style="background:var(--primary); color:#fff; border:none; padding:10px 20px; border-radius:25px; font-weight:700;">Finalizar</button>
    </div>

    <script>
        // --- CONSTANTES E DADOS ---
        const CONSTANTS = { 
            PHONE: "5565996813588",
            LIMITS: { 'economica': 5, 'mini': 7, 'pequena': 9, 'media': 11, 'grande': 13 }
        };

        const App = {
            data: [], cart: {}, currentBasket: null, baseFee: 0,
            
            async init() {
                try {
                    const res = await fetch('produtos/produtos.json?v=' + Date.now());
                    const raw = await res.json();
                    this.data = (raw.produtos || raw).map(p => ({
                        ...p,
                        id: String(p.id),
                        nome: p.nome,
                        valor: parseFloat(p.valor || 0),
                        offerPrice: parseFloat(p.Valor_Oferta || 0),
                        isOffer: p.Oferta === 'Sim',
                        imagem: p.imagem ? `img/produtos/${p.imagem.split('/').pop()}` : 'img/placeholder.jpg',
                        categoria: p.categoria.toUpperCase()
                    }));

                    this.renderHome();
                    this.renderOffers();
                    this.initHeroBanner();
                } catch (e) { console.error("Erro ao carregar dados", e); }
            },

            initHeroBanner() {
                const track = document.getElementById('hero-banner-track');
                setInterval(() => {
                    if(track.scrollLeft + track.offsetWidth >= track.scrollWidth) track.scrollTo({left: 0, behavior: 'smooth'});
                    else track.scrollBy({left: 200, behavior: 'smooth'});
                }, 3000);
            },

            renderOffers() {
                const offers = this.data.filter(p => p.isOffer);
                if(offers.length === 0) return;
                document.getElementById('offers-container').classList.remove('hidden');
                document.getElementById('offers-track').innerHTML = offers.map(p => `
                    <div class="offer-mini-card">
                        <img src="${p.imagem}">
                        <div style="font-size: 11px; font-weight: 700; margin-top:5px;">${p.nome}</div>
                        <div style="color:var(--primary); font-weight:800;">R$ ${p.offerPrice.toFixed(2)}</div>
                    </div>
                `).join('');
            },

            renderHome() {
                const baskets = this.data.filter(p => p.categoria.includes('CESTA'));
                document.getElementById('catalog-mount').innerHTML = baskets.map(p => `
                    <section class="product-section">
                        <div class="p-main-content">
                            <h2 style="text-align:center; margin-bottom:15px;">${p.nome}</h2>
                            <img src="${p.imagem}" class="basket-hero-img">
                            <div style="margin: 15px 0; font-weight: 800; font-size: 24px; text-align:center;">R$ ${p.valor.toFixed(2)}</div>
                            <button class="btn-chat primary" onclick="App.openCustomizer('${p.id}')" style="cursor:pointer; width:100%; margin-bottom:10px;">PERSONALIZAR CESTA</button>
                            <button onclick="App.directOrder('${p.nome}')" style="background:var(--success); color:#fff; border:none; padding:12px; border-radius:10px; font-weight:700; cursor:pointer; width:100%;">PEDIR NORMAL</button>
                        </div>
                    </section>
                `).join('');
            },

            openCustomizer(id) {
                const basket = this.data.find(x => x.id === id);
                this.currentBasket = basket;
                this.cart = {};
                
                // Monta o carrinho inicial baseado nos itens da cesta
                if(basket.items) {
                    basket.items.forEach(i => {
                        this.cart[String(i.id)] = parseInt(i.qty);
                    });
                }

                document.getElementById('home-view').classList.add('hidden');
                document.getElementById('customizer-view').classList.remove('hidden');
                document.getElementById('header-home-content').classList.add('hidden');
                document.getElementById('header-customizer-content').classList.remove('hidden');
                document.getElementById('credit-chip').classList.remove('hidden');
                
                ChatFlow.start();
                this.updateTotal();
            },

            goHome() {
                location.reload(); // Forma mais simples de resetar o estado
            },

            updateTotal() {
                let sum = 0;
                for(let id in this.cart) {
                    const p = this.data.find(x => x.id === id);
                    if(p) sum += (p.isOffer ? p.offerPrice : p.valor) * this.cart[id];
                }
                document.getElementById('ccb-val').innerText = `R$ ${sum.toFixed(2)}`;
            },

            directOrder(name) {
                const msg = encodeURIComponent(`Ol√°! Gostaria de pedir a ${name} normal.`);
                window.open(`https://api.whatsapp.com/send?phone=${CONSTANTS.PHONE}&text=${msg}`);
            }
        };

        const ChatFlow = {
            container: null,
            
            async start() {
                this.container = document.getElementById('chat-stream');
                this.container.innerHTML = '';
                this.addMessage(`Excelente escolha! Vamos personalizar sua <strong>${App.currentBasket.nome}</strong>?`);
                this.showInitialActions();
            },

            addMessage(text, type = 'bot') {
                const cls = type === 'user' ? 'chat-msg user' : 'chat-msg';
                this.container.insertAdjacentHTML('beforeend', `<div class="${cls}">${text}</div>`);
            },

            showInitialActions() {
                const html = `
                <div class="chat-actions">
                    <button class="btn-chat primary" onclick="ChatFlow.showBasketItems()">Sim, vamos l√°!</button>
                </div>`;
                this.container.insertAdjacentHTML('beforeend', html);
            },

            showBasketItems() {
                this.addMessage("Sim, vamos l√°!", "user");
                this.addMessage("Aqui est√£o os itens da sua cesta. Voc√™ pode remover o que n√£o quiser clicando no lixo ou sinal de menos.");
                
                const products = Object.keys(App.cart).map(id => App.data.find(x => x.id === id));
                const gridHtml = `<div class="grid-products-row">
                    ${products.map(p => `
                        <div class="card-prod" id="cp-${p.id}">
                            <img src="${p.imagem}">
                            <div style="font-size:10px; margin:5px 0;">${p.nome}</div>
                            <div class="qty-ctrl-float">
                                <button onclick="ChatFlow.modQty('${p.id}', -1)">-</button>
                                <span id="qty-${p.id}">${App.cart[p.id]}</span>
                                <button onclick="ChatFlow.modQty('${p.id}', 1)">+</button>
                            </div>
                        </div>
                    `).join('')}
                </div>`;
                this.container.insertAdjacentHTML('beforeend', gridHtml);
            },

            modQty(id, delta) {
                const current = App.cart[id] || 0;
                const newVal = current + delta;
                if(newVal <= 0) delete App.cart[id];
                else App.cart[id] = newVal;
                
                const span = document.getElementById(`qty-${id}`);
                if(span) span.innerText = App.cart[id] || 0;
                if(newVal <= 0) document.getElementById(`cp-${id}`).style.opacity = '0.3';
                else document.getElementById(`cp-${id}`).style.opacity = '1';

                App.updateTotal();
            },

            startCheckout() {
                let msg = `*MEU PEDIDO: ${App.currentBasket.nome}*\n\n`;
                for(let id in App.cart) {
                    const p = App.data.find(x => x.id === id);
                    msg += `- ${App.cart[id]}x ${p.nome}\n`;
                }
                msg += `\n*TOTAL: ${document.getElementById('ccb-val').innerText}*`;
                window.open(`https://api.whatsapp.com/send?phone=${CONSTANTS.PHONE}&text=${encodeURIComponent(msg)}`);
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
