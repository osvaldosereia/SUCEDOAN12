<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Super Cestas Dona Ant√¥nia - Encomende online via WhatsApp.">
    
    <meta name="geo.region" content="BR-MT" />
    <meta name="geo.placename" content="Cuiab√°" />
    <meta name="theme-color" content="#0F172A"> <title>Super Cestas Dona Ant√¥nia</title>

    <style>
        /* --- DESIGN SYSTEM MINIMALISTA --- */
        :root {
            --cor-primary: #0F172A;
            --cor-action: #FF6D00;
            --cor-success: #00C853;
            --cor-warning: #FFAB00;
            --cor-bg: #F8FAFC;
            --cor-surface: #FFFFFF; 
            --cor-text-main: #334155;
            --cor-text-light: #94A3B8;
            --cor-divider: #F1F5F9;
            
            --font-stack: 'Inter', -apple-system, sans-serif;
            --radius-sm: 8px;
            --radius-md: 12px;
            --shadow-soft: 0 2px 15px rgba(0,0,0,0.04);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            font-family: var(--font-stack);
            background-color: var(--cor-bg);
            color: var(--cor-text-main);
            margin: 0;
            padding-bottom: 120px;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: hidden;
        }

        /* --- HEADER & NAVIGATION --- */
        .header-wrapper {
            position: sticky; top: 0; z-index: 1000;
            background: var(--cor-primary);
            transition: transform 0.3s ease;
        }
        .header-hidden { transform: translateY(-64px); }

        header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; height: 64px;
            max-width: 1200px; margin: 0 auto;
        }
        
        .logo { width: 32px; height: 32px; border-radius: 50%; border: 1.5px solid white; }
        .page-title { font-size: 0.9rem; font-weight: 600; color: white; letter-spacing: 0.5px; }
        .btn-back { font-size: 1.2rem; color: white; padding: 10px; margin-left: -10px; }

        /* --- STICKY BARS --- */
        .sticky-container {
            position: sticky; top: 0; z-index: 999;
            background: var(--cor-bg);
        }

        .balance-bar {
            background: var(--cor-primary); color: white;
            padding: 12px 20px;
            display: none; justify-content: space-between; align-items: center;
        }
        .balance-bar.credit { background: var(--cor-warning); color: #000; }
        .balance-bar.success { background: var(--cor-success); }
        
        .balance-val { font-size: 1.1rem; font-weight: 800; }
        .balance-label { font-size: 0.65rem; text-transform: uppercase; font-weight: 700; opacity: 0.8; }

        .search-container {
            padding: 10px 20px;
            background: var(--cor-bg);
            display: none;
        }
        .search-box {
            width: 100%; padding: 12px 16px;
            border: none; border-radius: var(--radius-md);
            background: white; box-shadow: var(--shadow-soft);
            font-size: 0.9rem; color: var(--cor-text-main);
        }

        /* --- VIEWS --- */
        .view { display: none; animation: fadeIn 0.4s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- HOME --- */
        .hero-section { padding: 40px 20px; text-align: center; }
        .hero-title { font-size: 1.3rem; font-weight: 800; margin-bottom: 8px; color: var(--cor-primary); }
        .hero-subtitle { font-size: 0.8rem; color: var(--cor-text-light); }

        .grid-cestas { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 20px; }
        .cesta-card { 
            background: white; border-radius: var(--radius-md); overflow: hidden;
            box-shadow: var(--shadow-soft); transition: transform 0.2s;
        }
        .cesta-img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .cesta-content { padding: 15px; text-align: center; }
        .cesta-price { font-size: 1.2rem; font-weight: 800; color: var(--cor-action); margin: 10px 0; }

        /* --- PERSONALIZA√á√ÉO --- */
        .basket-base-list { background: white; padding: 20px; margin-bottom: 10px; }
        .base-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px solid var(--cor-divider);
        }
        .base-item-name { font-size: 0.8rem; font-weight: 500; }
        
        .qty-control {
            display: flex; align-items: center; gap: 12px;
            background: #F8FAFC; padding: 4px 8px; border-radius: 20px;
        }
        .btn-q { width: 28px; height: 28px; font-size: 1rem; color: var(--cor-primary); }
        .val-q { font-weight: 700; font-size: 0.85rem; min-width: 15px; text-align: center; }

        /* --- CARROSSEL --- */
        .section-price-title { 
            padding: 30px 20px 10px; font-size: 0.75rem; 
            text-transform: uppercase; letter-spacing: 1px; color: var(--cor-text-light);
            border-top: 6px solid var(--cor-divider);
        }
        .carousel-container { margin-bottom: 25px; }
        .carousel-title { padding: 0 20px 10px; font-size: 0.95rem; font-weight: 700; }
        .carousel-track {
            display: flex; overflow-x: auto; padding: 0 20px 10px; gap: 12px;
            scroll-snap-type: x mandatory; scrollbar-width: none;
        }
        .carousel-track::-webkit-scrollbar { display: none; }

        .prod-card {
            flex: 0 0 140px; scroll-snap-align: start;
            background: white; border-radius: var(--radius-md);
            padding: 10px; box-shadow: var(--shadow-soft);
            display: flex; flex-direction: column;
        }
        .prod-img { width: 100%; aspect-ratio: 1; object-fit: contain; margin-bottom: 8px; }
        .prod-name { 
            font-size: 0.75rem; line-height: 1.3; height: 3.9em; 
            overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;
            color: var(--cor-text-main); margin-bottom: 5px;
        }
        .prod-price { font-size: 0.9rem; font-weight: 800; color: var(--cor-action); }

        /* --- BUTTONS --- */
        .btn-main-action {
            width: 100%; padding: 14px; border-radius: var(--radius-sm);
            background: var(--cor-action); color: white; font-weight: 700;
            font-size: 0.85rem; text-transform: uppercase;
        }
        
        /* --- FAB & CHECKOUT --- */
        .fab-cart {
            position: fixed; bottom: 85px; right: 20px;
            width: 56px; height: 56px; border-radius: 50%;
            background: var(--cor-action); color: white;
            box-shadow: 0 4px 20px rgba(255, 109, 0, 0.3);
            display: flex; align-items: center; justify-content: center; z-index: 1001;
        }
        .fab-badge {
            position: absolute; top: -2px; right: -2px;
            background: var(--cor-danger); font-size: 0.7rem;
            padding: 2px 6px; border-radius: 10px; border: 2px solid white;
        }

        .checkout-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; padding: 15px 20px; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 -2px 15px rgba(0,0,0,0.05);
        }

        /* --- DIALOGS --- */
        dialog { border: none; border-radius: 16px; width: 90%; max-width: 400px; padding: 25px; }
        dialog::backdrop { background: rgba(15, 23, 42, 0.8); }

        @media (min-width: 900px) {
            .grid-cestas { grid-template-columns: repeat(3, 1fr); max-width: 1200px; margin: 0 auto; }
            .prod-card { flex: 0 0 180px; }
        }
    </style>
</head>
<body>

    <div class="header-wrapper" id="header-wrapper">
        <header>
            <div style="display:flex; align-items:center; gap:12px">
                <button class="btn-back" id="btn-back" onclick="goHome()" style="display:none">‚Üê</button>
                <img src="img/logo.webp" class="logo">
                <div class="page-title">Super Cestas</div>
            </div>
        </header>
    </div>

    <div class="sticky-container">
        <div id="balance-bar" class="balance-bar">
            <div class="balance-info">
                <span class="balance-label" id="balance-label">Cofre</span>
                <div class="balance-val" id="balance-val">R$ 0,00</div>
            </div>
            <div id="balance-sub" style="font-size:0.7rem; opacity:0.8"></div>
        </div>

        <div id="search-container" class="search-container">
            <input type="text" id="search-input" class="search-box" placeholder="O que voc√™ deseja adicionar?" oninput="renderCatalogo()">
        </div>
    </div>

    <main>
        <div id="view-home" class="view active">
            <div class="hero-section">
                <h2 class="hero-title">Sua compra do m√™s pronta.</h2>
                <p class="hero-subtitle">Entrega Gr√°tis em Cuiab√° e VG</p>
            </div>
            <div class="grid-cestas" id="cestas-list"></div>
        </div>

        <div id="view-custom" class="view">
            <div class="basket-base-list" id="basket-base-list"></div>
            
            <div id="btn-calculate-box" style="padding: 20px;">
                <button class="btn-main-action" style="background:var(--cor-primary)" onclick="unlockCatalogo()">REVIS√ÉO CONCLU√çDA ‚Üí</button>
            </div>

            <div id="catalogo-content"></div>
        </div>
    </main>

    <div id="fab-cart" class="fab-cart" onclick="openCheckoutModal()" style="display:none">
        üõí <div class="fab-badge" id="fab-count">0</div>
    </div>

    <div id="checkout-bar" class="checkout-bar" style="display:none">
        <div>
            <div class="balance-label">Total Final</div>
            <div class="balance-val" id="chk-total-val" style="color:var(--cor-primary)">R$ 0,00</div>
        </div>
        <button class="btn-main-action" style="width:auto; padding: 12px 25px;" onclick="openCheckoutModal()">CONCLUIR</button>
    </div>

    <dialog id="modal-decision">
        <div style="text-align:center">
            <h3 id="decision-title" style="margin-bottom:20px"></h3>
            <button class="btn-main-action" style="background:var(--cor-success); margin-bottom:12px" onclick="orderFast()">PEDIR AGORA VIA WHATSAPP</button>
            <button class="btn-main-action" style="background:white; color:var(--cor-action); border:1px solid var(--cor-action)" onclick="startCustomization()">PERSONALIZAR ITENS</button>
            <button onclick="this.closest('dialog').close()" style="margin-top:20px; color:var(--cor-text-light); font-size:0.8rem">Voltar</button>
        </div>
    </dialog>

    <dialog id="modal-checkout">
        <h3 style="margin-bottom:20px">Finalizar</h3>
        <div id="checkout-summary" style="margin-bottom:20px; font-size:0.85rem"></div>
        <input type="text" id="cust-name" class="search-box" placeholder="Seu Nome" style="margin-bottom:12px; border:1px solid #eee">
        <select id="cust-pay" class="search-box" style="margin-bottom:20px; border:1px solid #eee">
            <option>PIX (Na entrega)</option>
            <option>Cart√£o Cr√©dito/D√©bito</option>
            <option>Dinheiro</option>
            <option>Alimenta√ß√£o</option>
        </select>
        <button class="btn-main-action" onclick="sendOrder()">ENVIAR NO WHATSAPP</button>
    </dialog>

    <script>
        const CONFIG_WHATSAPP = "5565984491018";
        const CONFIG_CATEGORIAS = {
            "Mercearia B√°sica": ["AMIDO", "SARDINHA", "ARROZ", "FEIJAO", "ACUCAR", "OLEO", "MILHARINA", "CUZ CUZ", "FARINHA", "FUBA", "MILHO VERDE", "SAL", "TRIGO"],
            "Beb√™ e Infantil": ["FRALDA", "LENCO UMEDECIDO", "HUGGIES", "POMADA", "MUCILON"],
            "Cabelo, Unha, Corpo e Maquiagem": ["LOCAO", "LO√á√ÉO", "ELASTICO DE CABELO", "Necessaire", "PIN√áA", "AGUA OXIGENADA", "ACETONA", "PIRANHA", "PRESILHA", "XUXINHA", "LA√áO", "RABICO", "ESPONJA DE MAQUIAGEM", "LIXA DE UNHA", "CORTADOR DE UNHA", "SHAMPOO", "CONDICIONADOR", "PENTE", "ESCOVA DE CABELO", "CREME DE PENTEAR"],
            "Higiene Pessoal": ["TALCO", "APARELHO BARBEAR", "LAMINAS DE BARBEAR", "ESPONJA DE BANHO", "SABONETE", "DESODORANTE", "ABSORVENTE", "ALGODAO", "COTONETE", "GILETTE"],
            "Higiene Bucal": ["CREME DENTAL", "ESCOVA DENTAL", "FIO DENTAL"],
            "Lavanderia": ["LAVA ROUPA", "ESCOVA LAVANDERIA", "SABAO", "OMO", "YPE", "AMACIANTE", "AGUA SANITARIA", "VARAL", "PREGADOR", "PRENDEDOR"],
            "Limpeza da Casa": ["PEDRA SAINARIA", "ESCOVA DE LIMPEZA", "ESPONJA MAGICA", "DESINFETANTE", "VEJA", "DETERGENTE", "ESPONJA DE A√áO", "BUCHA DE LAVAR LOU√áA", "PANO DE CH√ÉO", "INSETICIDA", "VASSOURA", "SACO DE LIXO", "RODO"],
            "Massas e Molhos": ["KETCHUP", "MAIONESE", "MOSTARDA", "MACARRAO", "EXTRATO DE TOMATE", "MOLHO DE TOMATE", "QUEIJO RALADO"],
            "Caf√© da Manh√£": ["CAFE", "FILTRO DE CAFE", "LEITE INTEGRAL", "LEITE DESNATADO", "ACHOCOLATADO", "CEREAL", "AVEIA", "SUCO", "CHA", "ERVA DE TERERE"],
            "Biscoitos e Lanches": ["BATATA PRINGLES", "BOLACHA WAFER", "BOLACHA SHOW", "BISCOITO", "BOLACHA", "WAFER", "TORRADA", "ROSQUINHA"],
            "Doces e Sobremesas": ["COCO RALADO", "DROPS", "TRIDENT", "LEITE CONDENSADO", "GELATINA", "BOLO", "MISTURA PRA BOLO", "CREME DE LEITE"],
            "Temperos": ["AZEITE", "CALDO", "TEMPERO", "PIMENTA", "MAIONESE", "KETCHUP", "VINAGRE", "CONDIMENTO"],
            "Cozinha": ["PALITO DENTAL", "ABRIDOR DE GARRAFA", "BALDE DE PIPOCA", "FORMA DE GELO", "JOGO AMERICANO", "PROCESSADOR", "TABUA DE CORTE", "CAPA PARA BOTIJAO", "CORTINA", "LUVA TERMICA", "PRATINHO", "LAVA LOU√áA", "ISQUEIRO", "COPO", "PANELA", "DESCANSO DE PANELA", "PRATO", "GARFO", "FACA", "COLHER", "TABUA DE CARNE", "TALHER", "PAPEL ALUMINIO", "TIGELA", "TRAVESSA", "CANECA", "PETISQUEIRA", "JARRA", "POTE", "CUMBUCA", "SOCADOR", "DESCASCADOR", "PENEIRA"],
            "Utilidades": ["BALAO", "ABRACADEIRA", "CANTONEIRA", "FITA ADESIVA", "PORTA COMPRIMIDOS", "PORTA OBJETOS", "PROTETOR VEDA", "RELOGIO", "LACRE", "CESTO", "AGULHEIRO", "ALFINETE", "LINHA", "CHAVEIRO", "LAMPADA", "PILHA", "FOSFORO", "RALO", "SUPORTE", "PREGO", "PARAFUSO", "PROTETOR DE RALO"],
            "Papelaria": ["ESTILETE", "CANETA", "LAPIS", "CADERNO", "BORRACHA", "APONTADOR", "CLIPS", "REGUA", "GRAMPEADOR", "GRAFITE", "LAPISEIRA", "LIVRO"],
            "Cal√ßados": ["CHINELO"]
        };

        let DB_PROD = [];
        let DB_CESTAS = [];
        let STATE = {
            cesta: null, cart: {}, basePrice: 0, currentTotal: 0, 
            isUnlocked: false, lastScroll: 0
        };

        async function init() {
            try {
                const [r1, r2] = await Promise.all([fetch('produtos-cesta-basica.json'), fetch('produtos.json')]);
                if (r1.ok) DB_CESTAS = await r1.json();
                if (r2.ok) {
                    let txt = await r2.text();
                    txt = txt.trim().replace(/,(\s+)?$/, "");
                    if (!txt.startsWith('[')) txt = '[' + txt + ']';
                    DB_PROD = JSON.parse(txt).filter(x => x.situacao === "A").map(p => ({
                        id: String(p.id), name: p.nome, price: parseFloat(p.preco),
                        img: `img/produtos/${p.codigo || p.id}.webp`
                    }));
                }
                renderHome();
            } catch (e) { console.error(e); }
        }

        // --- NAVIGATION ---
        function goHome() {
            STATE.cart = {}; STATE.isUnlocked = false; STATE.cesta = null;
            document.getElementById('view-home').classList.add('active');
            document.getElementById('view-custom').classList.remove('active');
            document.getElementById('btn-back').style.display = 'none';
            document.getElementById('balance-bar').style.display = 'none';
            document.getElementById('search-container').style.display = 'none';
            document.getElementById('fab-cart').style.display = 'none';
            document.getElementById('checkout-bar').style.display = 'none';
            document.getElementById('btn-calculate-box').style.display = 'block';
            document.getElementById('catalogo-content').innerHTML = "";
        }

        function renderHome() {
            const el = document.getElementById('cestas-list');
            el.innerHTML = DB_CESTAS.map(c => `
                <div class="cesta-card" onclick="openDecision('${c.id}')">
                    <img src="${c.imagem || ''}" class="cesta-img">
                    <div class="cesta-content">
                        <div style="font-weight:700">${c.nome}</div>
                        <div class="cesta-price">${fmt(c.preco)}</div>
                    </div>
                </div>
            `).join('');
        }

        // --- FLOW ---
        function openDecision(id) {
            STATE.cesta = DB_CESTAS.find(x => x.id === id);
            document.getElementById('decision-title').innerText = STATE.cesta.nome;
            document.getElementById('modal-decision').showModal();
        }

        function orderFast() {
            const msg = `Ol√°! Quero a ${STATE.cesta.nome} original (${fmt(STATE.cesta.preco)}).`;
            window.location.href = `https://wa.me/${CONFIG_WHATSAPP}?text=${encodeURIComponent(msg)}`;
        }

        function startCustomization() {
            document.getElementById('modal-decision').close();
            STATE.basePrice = STATE.cesta.preco;
            STATE.cesta.produtos.forEach(itemStr => {
                const [q, id] = itemStr.split('x ');
                if (DB_PROD.find(p => p.id === id.trim())) STATE.cart[id.trim()] = parseInt(q);
            });
            document.getElementById('view-home').classList.remove('active');
            document.getElementById('view-custom').classList.add('active');
            document.getElementById('btn-back').style.display = 'block';
            document.getElementById('balance-bar').style.display = 'flex';
            updateUI();
            renderBaseList();
        }

        function unlockCatalogo() {
            STATE.isUnlocked = true;
            document.getElementById('btn-calculate-box').style.display = 'none';
            document.getElementById('search-container').style.display = 'block';
            document.getElementById('fab-cart').style.display = 'flex';
            document.getElementById('checkout-bar').style.display = 'flex';
            renderCatalogo();
        }

        // --- CORE LOGIC ---
        function upd(pid, d) {
            STATE.cart[pid] = (STATE.cart[pid] || 0) + d;
            if (STATE.cart[pid] <= 0) delete STATE.cart[pid];
            updateUI();
            if (!STATE.isUnlocked) renderBaseList(); else renderCatalogo();
        }

        function updateUI() {
            STATE.currentTotal = Object.entries(STATE.cart).reduce((acc, [id, q]) => {
                const p = DB_PROD.find(x => x.id === id);
                return acc + (p ? p.price * q : 0);
            }, 0);

            const diff = STATE.basePrice - STATE.currentTotal;
            const bar = document.getElementById('balance-bar');
            if (diff > 0.01) {
                bar.className = 'balance-bar credit';
                document.getElementById('balance-label').innerText = "Voc√™ tem Cr√©dito";
                document.getElementById('balance-val').innerText = fmt(diff);
            } else {
                bar.className = 'balance-bar success';
                document.getElementById('balance-label').innerText = "Total";
                document.getElementById('balance-val').innerText = fmt(STATE.currentTotal);
            }
            document.getElementById('chk-total-val').innerText = fmt(STATE.currentTotal);
            document.getElementById('fab-count').innerText = Object.values(STATE.cart).reduce((a,b)=>a+b,0);
        }

        function renderBaseList() {
            const el = document.getElementById('basket-base-list');
            el.innerHTML = `<div style="font-size:0.7rem; color:var(--cor-text-light); margin-bottom:15px; text-transform:uppercase">Passo 1: Retire o que n√£o quer</div>` + 
            STATE.cesta.produtos.map(itemStr => {
                const pid = itemStr.split('x ')[1].trim();
                const p = DB_PROD.find(x => x.id === pid);
                if (!p) return '';
                return `
                <div class="base-item">
                    <span class="base-item-name">${p.name}</span>
                    <div class="qty-control">
                        <button class="btn-q" onclick="upd('${pid}', -1)">-</button>
                        <span class="val-q">${STATE.cart[pid] || 0}</span>
                        <button class="btn-q" onclick="upd('${pid}', 1)">+</button>
                    </div>
                </div>`;
            }).join('');
        }

        function renderCatalogo() {
            const query = document.getElementById('search-input').value.toUpperCase();
            const ranges = [
                { label: "At√© R$ 5", min: 0, max: 5 },
                { label: "Entre R$ 5 e 15", min: 5.01, max: 15 },
                { label: "Acima de R$ 15", min: 15.01, max: 9999 }
            ];

            let html = "";
            ranges.forEach(range => {
                let filtered = DB_PROD.filter(p => p.price >= range.min && p.price <= range.max);
                if (query) filtered = filtered.filter(p => p.name.toUpperCase().includes(query));
                
                if (filtered.length > 0) {
                    html += `<div class="section-price-title">${range.label}</div>`;
                    
                    const cats = Object.keys(CONFIG_CATEGORIAS);
                    let allocatedIds = new Set();

                    cats.forEach(cat => {
                        const catProds = filtered.filter(p => {
                            const first3 = p.name.toUpperCase().split(' ').slice(0, 3).join(' ');
                            return CONFIG_CATEGORIAS[cat].some(key => first3.includes(key));
                        });

                        if (catProds.length > 0) {
                            html += renderCarousel(cat, catProds);
                            catProds.forEach(p => allocatedIds.add(p.id));
                        }
                    });

                    const outros = filtered.filter(p => !allocatedIds.has(p.id));
                    if (outros.length > 0) html += renderCarousel("Outros", outros);
                }
            });
            document.getElementById('catalogo-content').innerHTML = html;
        }

        function renderCarousel(title, prods) {
            return `
            <div class="carousel-container">
                <div class="carousel-title">${title}</div>
                <div class="carousel-track">
                    ${prods.map(p => `
                        <div class="prod-card">
                            <img src="${p.img}" class="prod-img">
                            <div class="prod-name">${p.name}</div>
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:auto">
                                <span class="prod-price">${fmt(p.price)}</span>
                                <div class="qty-control" style="background:var(--cor-bg); padding:2px 5px">
                                    <button onclick="upd('${p.id}', -1)" style="font-size:0.8rem">-</button>
                                    <span style="font-size:0.7rem; font-weight:700">${STATE.cart[p.id] || 0}</span>
                                    <button onclick="upd('${p.id}', 1)" style="font-size:0.8rem">+</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>`;
        }

        // --- SCROLL BEHAVIOR ---
        window.addEventListener('scroll', () => {
            const current = window.pageYOffset;
            const header = document.getElementById('header-wrapper');
            if (current > 100 && current > STATE.lastScroll) header.classList.add('header-hidden');
            else header.classList.remove('header-hidden');
            STATE.lastScroll = current;
        });

        // --- CHECKOUT ---
        function openCheckoutModal() {
            if (STATE.currentTotal < (STATE.basePrice - 0.5)) {
                alert("Use todo seu cr√©dito antes de finalizar!"); return;
            }
            let res = Object.entries(STATE.cart).map(([id, q]) => {
                const p = DB_PROD.find(x => x.id === id);
                return `‚Ä¢ ${q}x ${p.name}`;
            }).join('<br>');
            document.getElementById('checkout-summary').innerHTML = res + `<br><br><b>Total: ${fmt(STATE.currentTotal)}</b>`;
            document.getElementById('modal-checkout').showModal();
        }

        function sendOrder() {
            const n = document.getElementById('cust-name').value;
            const p = document.getElementById('cust-pay').value;
            if (!n) return alert("Nome?");
            let txt = `*NOVO PEDIDO*\nCliente: ${n}\nPagamento: ${p}\nCesta: ${STATE.cesta.nome}\n\n*ITENS:*\n`;
            Object.entries(STATE.cart).forEach(([id, q]) => {
                const prod = DB_PROD.find(x => x.id === id);
                txt += `${q}x ${prod.name}\n`;
            });
            txt += `\n*TOTAL: ${fmt(STATE.currentTotal)}*`;
            window.location.href = `https://wa.me/${CONFIG_WHATSAPP}?text=${encodeURIComponent(txt)}`;
        }

        function fmt(v) { return v.toLocaleString('pt-BR', {style:'currency', currency:'BRL'}); }
        init();
    </script>
</body>
</html>
