<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="Pe√ßa sua Cesta B√°sica em Cuiab√° e VG. Monte e personalize sua cesta. Mercadinho online com pagamento na entrega.">
    <meta name="keywords" content="cesta b√°sica, mercado online, cuiab√°, v√°rzea grande, dona ant√¥nia, delivery alimentos">
    <meta name="author" content="Dona Ant√¥nia Alimentos">
    <meta name="theme-color" content="#ffffff">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="Dona Ant√¥nia | Cestas B√°sicas">
    <meta property="og:description" content="A melhor cesta b√°sica de Cuiab√° e VG. Personalize a sua agora!">
    
    <title>Cestas B√°sicas em Cuiab√° e V√°rzea Grande | Dona Ant√¥nia</title>

    <style>
        /* --- 1. CORE STYLES --- */
        :root {
            --primary: #d31a28;
            --primary-dark: #b91c1c;
            --secondary: #3e3e3e;
            --bg-body: #ffffff;
            --bg-chat: #f5f5f7;
            --border: #e5e5e5;
            --text-main: #1f1f1f;
            --text-light: #666666;
            --header-height: 70px;
            --radius: 12px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body); color: var(--text-main);
            font-size: 16px; line-height: 1.5;
        }

        img { display: block; max-width: 100%; height: auto; }
        button { cursor: pointer; border: none; background: none; font-family: inherit; }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 16px; }
        .hidden { display: none !important; }

        /* --- 2. HEADER (LOGO DEVOLVIDA) --- */
        #main-header {
            position: fixed; top: 0; left: 0; right: 0; height: var(--header-height);
            background: rgba(255,255,255,0.98); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border); z-index: 1000;
            display: flex; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        .header-inner { display: flex; justify-content: space-between; align-items: center; width: 100%; height: 100%; }
        
        .logo-container { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--secondary); }
        .logo-img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
        .logo-text h1 { font-size: 1.1rem; font-weight: 800; margin: 0; line-height: 1.1; }
        .logo-text span { font-size: 0.75rem; color: #666; font-weight: 500; }

        .location-pill {
            display: none; /* Mobile hide */
            font-size: 0.85rem; background: #f4f4f5; padding: 6px 12px; border-radius: 20px; font-weight: 600; color: #555;
        }
        @media(min-width: 600px) { .location-pill { display: inline-block; } }

        /* --- 3. HOME VIEW --- */
        #view-home { padding-top: calc(var(--header-height) + 20px); padding-bottom: 60px; }
        
        .hero { text-align: center; margin-bottom: 40px; padding: 0 10px; }
        .hero h2 { font-size: 1.6rem; color: var(--primary); margin-bottom: 8px; }
        .hero p { color: var(--text-light); max-width: 600px; margin: 0 auto; }

        /* Grid de Cestas */
        .basket-grid { 
            display: grid; grid-template-columns: 1fr; gap: 24px; 
            margin-bottom: 60px;
        }
        @media(min-width: 600px) { .basket-grid { grid-template-columns: repeat(2, 1fr); } }
        @media(min-width: 900px) { .basket-grid { grid-template-columns: repeat(3, 1fr); } }

        .basket-card {
            background: #fff; border: 1px solid var(--border); border-radius: 16px; overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: transform 0.2s;
            display: flex; flex-direction: column;
        }
        .basket-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        
        .bc-img { width: 100%; height: 200px; object-fit: cover; background: #f9f9f9; }
        .bc-body { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .bc-title { font-size: 1.3rem; font-weight: 700; color: #222; margin-bottom: 5px; }
        .bc-price { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 15px; }
        .bc-desc { font-size: 0.9rem; color: #666; margin-bottom: 20px; flex: 1; }
        
        .btn-start {
            width: 100%; padding: 14px; background: var(--secondary); color: white; border-radius: 10px;
            font-weight: 700; font-size: 1rem; text-align: center; transition: background 0.2s;
        }
        .btn-start:hover { background: #222; }

        /* --- 4. FAQ & FOOTER (DEVOLVIDOS) --- */
        .faq-section { margin-top: 40px; background: #f9fafb; padding: 40px 0; border-top: 1px solid var(--border); }
        .faq-title { text-align: center; font-size: 1.4rem; font-weight: 700; margin-bottom: 30px; color: #333; }
        
        details.faq-item {
            background: #fff; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 10px; overflow: hidden;
        }
        details.faq-item summary {
            padding: 15px; font-weight: 600; cursor: pointer; list-style: none; display: flex; justify-content: space-between; align-items: center;
        }
        details.faq-item summary::after { content: '+'; font-size: 1.2rem; font-weight: 400; }
        details.faq-item[open] summary::after { content: '-'; }
        .faq-content { padding: 15px; border-top: 1px solid #eee; color: #555; font-size: 0.95rem; line-height: 1.5; }

        .main-footer {
            background: #fff; padding: 40px 0 20px; text-align: center; border-top: 1px solid var(--border);
        }
        .footer-links { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .f-link { text-decoration: none; color: var(--secondary); font-weight: 600; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }
        .copyright { font-size: 0.8rem; color: #999; margin-top: 20px; }

        /* --- 5. CHAT / PERSONALIZADOR --- */
        #view-chat {
            position: fixed; inset: 0; background: var(--bg-chat); z-index: 2000;
            display: flex; flex-direction: column;
            transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        #view-chat.active { transform: translateX(0); }

        /* Chat Header */
        .chat-header {
            background: #fff; padding: 10px 16px; height: 65px; display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid var(--border); box-shadow: 0 2px 5px rgba(0,0,0,0.02); z-index: 10;
        }
        .ch-info { display: flex; align-items: center; gap: 10px; }
        .ch-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .ch-text h3 { margin: 0; font-size: 1rem; font-weight: 700; color: #333; }
        .ch-text small { color: var(--primary); font-weight: 600; font-size: 0.75rem; }
        .btn-close-chat { font-size: 1.8rem; color: #999; line-height: 1; padding: 0 10px; }

        /* Chat Body */
        .chat-feed {
            flex: 1; overflow-y: auto; padding: 20px 16px 120px; /* Padding bottom para bot√µes fixos */
            display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth;
        }

        /* Mensagens */
        .msg-bot {
            align-self: flex-start; max-width: 90%; background: #fff; 
            padding: 14px 18px; border-radius: 18px; border-top-left-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); color: #333; font-size: 1rem; line-height: 1.5;
            animation: slideIn 0.3s ease;
        }
        .msg-bot strong { color: var(--primary); }
        @keyframes slideIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }

        /* Grid de Produtos no Chat */
        .chat-grid-container {
            width: 100%; background: #fff; border-radius: 16px; padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04); animation: fadeIn 0.5s ease;
        }
        .cgc-header {
            font-size: 1rem; font-weight: 800; color: var(--secondary); margin-bottom: 15px;
            padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        .products-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
        }
        @media(min-width: 500px) { .products-grid { grid-template-columns: repeat(4, 1fr); } }

        /* Card Produto Chat */
        .prod-card { display: flex; flex-direction: column; position: relative; }
        .pc-img-box {
            width: 100%; aspect-ratio: 1; border-radius: 12px; background: #f9f9f9; 
            margin-bottom: 8px; overflow: hidden; position: relative; cursor: zoom-in;
        }
        .pc-img { width: 100%; height: 100%; object-fit: contain; mix-blend-mode: multiply; }
        .pc-name { font-size: 0.85rem; line-height: 1.2; color: #444; margin-bottom: 4px; height: 2.4em; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        
        /* Controles Qtd */
        .pc-ctrl {
            display: flex; align-items: center; justify-content: space-between;
            background: #fff; border: 1px solid #eee; border-radius: 8px; height: 36px; overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .pc-btn { width: 30px; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: var(--secondary); cursor: pointer; background: #fdfdfd; }
        .pc-btn:active { background: #eee; }
        .pc-val { font-weight: 700; font-size: 0.9rem; flex: 1; text-align: center; }
        .pc-btn.add { color: var(--primary); }

        /* Bot√µes de A√ß√£o (Respostas) */
        .chat-actions {
            margin-top: 10px; display: flex; flex-direction: column; gap: 10px; width: 100%;
        }
        .btn-chat-opt {
            width: 100%; padding: 16px; border-radius: 12px; font-weight: 700; font-size: 0.95rem; text-align: center;
            border: 1px solid #ddd; background: #fff; color: #444; transition: all 0.2s;
            display: flex; justify-content: space-between; align-items: center; padding-left: 20px; padding-right: 20px;
        }
        .btn-chat-opt.primary { background: var(--secondary); color: #fff; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .btn-chat-opt:active { transform: scale(0.98); }

        /* --- 6. MODAL ZOOM IMAGEM --- */
        #zoom-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 3000;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #zoom-modal.open { opacity: 1; pointer-events: auto; }
        .zoom-img { max-width: 95%; max-height: 80vh; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .zoom-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 2rem; cursor: pointer; }

        /* --- 7. MODAL CHECKOUT --- */
        dialog.checkout-modal {
            margin: auto; width: 100%; max-width: 500px; border: none; border-radius: 20px 20px 0 0;
            position: fixed; bottom: 0; padding: 0; background: #fff;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2); animation: slideUp 0.3s; z-index: 2500;
        }
        dialog.checkout-modal::backdrop { background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); }
        @keyframes slideUp { from{transform:translateY(100%)} to{transform:translateY(0)} }

        .co-head { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; font-weight: 800; font-size: 1.2rem; }
        .co-list { padding: 20px; max-height: 50vh; overflow-y: auto; background: #fcfcfc; }
        .co-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #eee; font-size: 0.95rem; }
        .co-foot { padding: 20px; background: #fff; border-top: 1px solid #eee; }
        
        .co-total-row { display: flex; justify-content: space-between; font-size: 1.4rem; font-weight: 800; margin-bottom: 20px; color: #222; }
        .btn-whatsapp { width: 100%; padding: 16px; background: #25D366; color: white; font-weight: 700; border-radius: 10px; font-size: 1rem; }
    </style>
</head>
<body>

    <header id="main-header">
        <div class="container header-inner">
            <a href="#" class="logo-container" onclick="location.reload()">
                <img src="https://donaantonia.com.br/site/img/produtos/logo-cesta-basica-dona-antonia-cesta-basica-cuiaba-varzea-grande.webp" class="logo-img" alt="Logo">
                <div class="logo-text">
                    <h1>Dona Ant√¥nia</h1>
                    <span>Cestas B√°sicas</span>
                </div>
            </a>
            <div class="location-pill">üìç Cuiab√° & VG</div>
        </div>
    </header>

    <div id="view-home">
        <div class="container">
            <div class="hero">
                <h2>Cestas B√°sicas & Mercado</h2>
                <p>Qualidade, pre√ßo justo e pagamento facilitado na entrega.</p>
            </div>
            
            <div id="basket-list" class="basket-grid">
                <div style="padding:40px; text-align:center; color:#999; grid-column:1/-1;">Carregando produtos...</div>
            </div>
        </div>

        <div class="faq-section">
            <div class="container">
                <h3 class="faq-title">D√∫vidas Frequentes</h3>
                <details class="faq-item"><summary>Como funciona a entrega?</summary><div class="faq-content">Entregamos em at√© 24h para Cuiab√° e V√°rzea Grande.</div></details>
                <details class="faq-item"><summary>Quais as formas de pagamento?</summary><div class="faq-content">Pix, Dinheiro, Cart√£o de Cr√©dito/D√©bito e Vale Alimenta√ß√£o na entrega.</div></details>
                <details class="faq-item"><summary>Posso personalizar?</summary><div class="faq-content">Sim! Escolha uma cesta base e adicione ou remova itens pelo nosso chat.</div></details>
            </div>
        </div>

        <footer class="main-footer">
            <div class="container">
                <div class="footer-links">
                    <a href="#" class="f-link">üìû (65) 99681-3588</a>
                    <a href="#" class="f-link">üìç Ver Mapa</a>
                </div>
                <div class="copyright">¬© 2024 Dona Ant√¥nia Alimentos. Todos os direitos reservados.</div>
            </div>
        </footer>
    </div>

    <div id="view-chat">
        <div class="chat-header">
            <div class="ch-info">
                <img src="https://donaantonia.com.br/site/img/produtos/logo-cesta-basica-dona-antonia-cesta-basica-cuiaba-varzea-grande.webp" class="ch-avatar">
                <div class="ch-text">
                    <h3>Atendente Virtual</h3>
                    <small>Online agora</small>
                </div>
            </div>
            <button class="btn-close-chat" onclick="App.closeChat()">√ó</button>
        </div>

        <div class="chat-feed" id="chat-feed">
            </div>
    </div>

    <div id="zoom-modal" onclick="this.classList.remove('open')">
        <div class="zoom-close">√ó</div>
        <img src="" class="zoom-img" id="zoom-target">
    </div>

    <dialog id="modal-checkout" class="checkout-modal">
        <div class="co-head">
            Resumo do Pedido <button onclick="document.getElementById('modal-checkout').close()">‚úï</button>
        </div>
        <div class="co-list" id="checkout-list"></div>
        <div class="co-foot">
            <div class="co-total-row">
                <span>Total a Pagar</span>
                <span id="final-total" style="color:var(--primary)">R$ 0,00</span>
            </div>
            <div style="margin-bottom:15px">
                <label style="font-weight:600; font-size:0.9rem; display:block; margin-bottom:5px;">Pagamento na Entrega:</label>
                <select id="pay-method" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px;">
                    <option>Pix</option>
                    <option>Dinheiro</option>
                    <option>Cart√£o Cr√©dito/D√©bito</option>
                    <option>Vale Alimenta√ß√£o</option>
                </select>
            </div>
            <button class="btn-whatsapp" onclick="App.sendWhatsapp()">Finalizar no WhatsApp</button>
        </div>
    </dialog>

    <script>
        // CONFIGURA√á√ÉO DO FLUXO DO CHAT
        const CATEGORIES_FLOW = [
            { key: 'MERCEARIA E ALIMENTOS', label: 'Mercearia e Alimentos' },
            { key: 'CAF√â DA MANH√É E LANCHES', label: 'Caf√© da Manh√£' },
            { key: 'LIMPEZA E LAVANDERIA', label: 'Limpeza' },
            { key: 'CUIDADOS PESSOAIS', label: 'Higiene Pessoal' },
            { key: 'BAZAR E UTILIDADES', label: 'Utilidades' }
        ];

        const App = {
            data: [],
            cart: {}, // { id: qtd }
            activeBasket: null,
            currentCatIndex: 0,

            init() {
                // Tenta carregar produtos (com fallback manual se falhar por seguran√ßa local)
                fetch('produtos.json')
                    .then(r => { if(!r.ok) throw new Error(); return r.json(); })
                    .then(json => this.processData(json))
                    .catch(() => {
                        fetch('produtos (10).json')
                        .then(r => { if(!r.ok) throw new Error(); return r.json(); })
                        .then(json => this.processData(json))
                        .catch(() => this.showManualUpload());
                    });
            },

            showManualUpload() {
                document.getElementById('basket-list').innerHTML = `
                    <div style="grid-column:1/-1; text-align:center; padding:30px; border:2px dashed #d31a28; border-radius:12px; background:#fff5f5;">
                        <h3 style="color:#d31a28">Carregar Lista de Produtos</h3>
                        <p style="margin-bottom:15px">Por seguran√ßa, carregue o arquivo <strong>produtos.json</strong>.</p>
                        <input type="file" accept=".json" onchange="App.handleFile(this)">
                    </div>`;
            },

            handleFile(input) {
                const file = input.files[0];
                if(!file) return;
                const reader = new FileReader();
                reader.onload = e => {
                    try { this.processData(JSON.parse(e.target.result)); } 
                    catch(err) { alert("Arquivo inv√°lido"); }
                };
                reader.readAsText(file);
            },

            processData(json) {
                const raw = json.produtos || json;
                this.data = raw.map(p => ({
                    id: String(p.id),
                    name: p.nome.trim(),
                    price: parseFloat(p.valor || 0),
                    // Tenta identificar categoria principal e sub
                    catMain: (p.categoria || "").split('>')[0].trim().toUpperCase(),
                    image: p.imagem ? `img/produtos/${p.imagem.split('/').pop()}` : 'https://via.placeholder.com/300?text=Sem+Foto'
                }));
                this.renderHome();
            },

            renderHome() {
                const list = document.getElementById('basket-list');
                const baskets = this.data.filter(p => p.catMain.includes('CESTA'));
                
                list.innerHTML = baskets.map(b => `
                    <div class="basket-card">
                        <img src="${b.image}" class="bc-img" loading="lazy">
                        <div class="bc-body">
                            <div class="bc-title">${b.name}</div>
                            <div class="bc-price">R$ ${b.price.toFixed(2).replace('.',',')}</div>
                            <div class="bc-desc">Toque para ver itens, personalizar e encomendar.</div>
                            <button class="btn-start" onclick="App.startChat('${b.id}')">Personalizar Cesta</button>
                        </div>
                    </div>
                `).join('');
            },

            // --- L√ìGICA DO CHAT ---
            startChat(basketId) {
                this.activeBasket = this.data.find(x => x.id === basketId);
                this.cart = {};
                this.currentCatIndex = 0;

                // Inicializa carrinho com itens da cesta (se houver items no JSON)
                // OU, como padr√£o se n√£o houver lista, adiciona a pr√≥pria cesta
                if(this.activeBasket.items && Array.isArray(this.activeBasket.items)) {
                    this.activeBasket.items.forEach(i => {
                        this.cart[String(i.id)] = parseInt(i.qty || 1);
                    });
                } else {
                    // Se n√£o tiver lista t√©cnica, assume que a cesta √© o item base
                    this.cart[basketId] = 1;
                }

                document.getElementById('view-chat').classList.add('active');
                const feed = document.getElementById('chat-feed');
                feed.innerHTML = '';

                // 1. Sauda√ß√£o por hor√°rio
                const hour = new Date().getHours();
                let greeting = "Bom dia";
                if(hour >= 12) greeting = "Boa tarde";
                if(hour >= 18) greeting = "Boa noite";

                this.botSay(`${greeting}! Sou a assistente da Dona Ant√¥nia.`);
                setTimeout(() => {
                    this.botSay(`Voc√™ escolheu a <strong>${this.activeBasket.name}</strong>.`);
                    this.botSay("Posso mostrar os produtos que fazem parte dela para voc√™ conferir?");
                    
                    this.showActions([
                        { text: "üëç Pode sim, mostrar itens", action: () => this.showBasketItems() },
                        { text: "Voltar", action: () => this.closeChat() }
                    ]);
                }, 600);
            },

            showBasketItems() {
                // Identifica itens da cesta atual no carrinho
                const ids = Object.keys(this.cart);
                const items = ids.map(id => this.data.find(x => x.id === id)).filter(x=>x);

                this.botSay("Aqui est√£o. Voc√™ pode adicionar (+) ou remover (-) o que quiser.");
                this.renderGridInChat(items, "ITENS DA CESTA");

                setTimeout(() => {
                    this.askNextCategory();
                }, 800);
            },

            askNextCategory() {
                if(this.currentCatIndex >= CATEGORIES_FLOW.length) {
                    this.offerFinish();
                    return;
                }

                const cat = CATEGORIES_FLOW[this.currentCatIndex];
                
                this.botSay(`Deseja ver op√ß√µes de <strong>${cat.label}</strong> para complementar?`);
                this.showActions([
                    { text: `Sim, ver ${cat.label}`, action: () => this.showCategoryProducts(cat) },
                    { text: "N√£o, pular essa", action: () => { this.currentCatIndex++; this.askNextCategory(); } },
                    { text: "‚úÖ Finalizar Pedido Agora", action: () => this.openCheckout(), primary: true }
                ]);
            },

            showCategoryProducts(catObj) {
                // Filtra produtos da categoria
                const items = this.data.filter(p => p.catMain === catObj.key).slice(0, 16); // Limit 16
                
                if(items.length === 0) {
                    this.botSay("Desculpe, n√£o tenho itens nesta categoria no momento.");
                } else {
                    this.renderGridInChat(items, catObj.label);
                }

                this.currentCatIndex++;
                
                setTimeout(() => {
                    this.showActions([
                        { text: "Continuar (Pr√≥xima Sess√£o) ‚û°", action: () => this.askNextCategory(), primary: true },
                        { text: "Finalizar Pedido", action: () => this.openCheckout() }
                    ]);
                }, 500);
            },

            offerFinish() {
                this.botSay("Passamos por tudo! Agora vamos fechar?");
                this.showActions([
                    { text: "üìù Ver Resumo e Enviar", action: () => this.openCheckout(), primary: true },
                    { text: "Revisar algo", action: () => { /* Logica de rever se quiser, ou apenas fechar o modal */ } }
                ]);
            },

            // --- RENDERIZADORES DO CHAT ---
            botSay(html) {
                const feed = document.getElementById('chat-feed');
                const div = document.createElement('div');
                div.className = 'msg-bot';
                div.innerHTML = html;
                feed.appendChild(div);
                this.scrollToBottom();
            },

            renderGridInChat(items, title) {
                const feed = document.getElementById('chat-feed');
                
                const container = document.createElement('div');
                container.className = 'chat-grid-container';
                
                let html = `<div class="cgc-header">${title}</div><div class="products-grid">`;
                
                html += items.map(p => {
                    const qty = this.cart[p.id] || 0;
                    // FOTO + NOME APENAS (Botao de Qtd tem controle)
                    return `
                    <div class="prod-card" id="card-${p.id}">
                        <div class="pc-img-box" onclick="App.zoomImage('${p.image}')">
                            <img src="${p.image}" class="pc-img" loading="lazy">
                        </div>
                        <div class="pc-name">${p.name}</div>
                        <div class="pc-ctrl">
                            <div class="pc-btn" onclick="App.modQty('${p.id}', -1)">-</div>
                            <div class="pc-val" id="qty-${p.id}">${qty}</div>
                            <div class="pc-btn add" onclick="App.modQty('${p.id}', 1)">+</div>
                        </div>
                    </div>`;
                }).join('');
                
                html += `</div>`;
                container.innerHTML = html;
                feed.appendChild(container);
                
                // Scroll para o t√≠tulo ficar no topo
                setTimeout(() => {
                    container.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            },

            showActions(opts) {
                const feed = document.getElementById('chat-feed');
                const div = document.createElement('div');
                div.className = 'chat-actions';
                
                opts.forEach(o => {
                    const btn = document.createElement('button');
                    btn.className = `btn-chat-opt ${o.primary ? 'primary' : ''}`;
                    btn.innerHTML = `<span>${o.text}</span> ${o.primary ? '<span>‚û°</span>' : ''}`;
                    btn.onclick = () => {
                        div.remove(); // Remove bot√µes ao clicar
                        o.action();
                    };
                    div.appendChild(btn);
                });
                feed.appendChild(div);
                this.scrollToBottom();
            },

            scrollToBottom() {
                const feed = document.getElementById('chat-feed');
                setTimeout(() => feed.scrollTop = feed.scrollHeight, 50);
            },

            closeChat() {
                if(confirm("Sair do atendimento e limpar o pedido?")) {
                    document.getElementById('view-chat').classList.remove('active');
                }
            },

            // --- CARRINHO & ZOOM ---
            modQty(id, delta) {
                if(!this.cart[id]) this.cart[id] = 0;
                this.cart[id] += delta;
                if(this.cart[id] <= 0) delete this.cart[id];
                
                // Atualiza visualmente se o card estiver na tela
                const el = document.getElementById(`qty-${id}`);
                if(el) el.innerText = this.cart[id] || 0;
            },

            zoomImage(src) {
                document.getElementById('zoom-target').src = src;
                document.getElementById('zoom-modal').classList.add('open');
            },

            // --- CHECKOUT (L√≥gica de Pre√ßo) ---
            openCheckout() {
                const list = document.getElementById('checkout-list');
                const totalEl = document.getElementById('final-total');
                
                let total = 0;
                let itemsHtml = "";

                // C√°lculo: Come√ßa com 0 e soma tudo. 
                // A l√≥gica de "Cesta Base + Adicionais" √© complexa se o usu√°rio remover itens da cesta base.
                // SOLU√á√ÉO SIMPLIFICADA E SEGURA PARA O CLIENTE:
                // Soma (Pre√ßo Unit√°rio * Qtd) de tudo que est√° no carrinho.
                // Se a cesta base foi adicionada como um item (id da cesta), ela soma o valor cheio da cesta.
                
                for(let id in this.cart) {
                    const p = this.data.find(x => x.id === id);
                    if(p) {
                        const itemTotal = p.price * this.cart[id];
                        total += itemTotal;
                        
                        // N√ÉO MOSTRAR VALOR UNIT√ÅRIO, APENAS QTD E NOME
                        itemsHtml += `
                        <div class="co-item">
                            <span><strong>${this.cart[id]}x</strong> ${p.name}</span>
                            <span></span> </div>`;
                    }
                }

                list.innerHTML = itemsHtml;
                totalEl.innerText = "R$ " + total.toFixed(2).replace('.',',');
                document.getElementById('modal-checkout').showModal();
            },

            sendWhatsapp() {
                const pay = document.getElementById('pay-method').value;
                const total = document.getElementById('final-total').innerText;
                
                let msg = `*PEDIDO DONA ANT√îNIA* üõí\n\n`;
                msg += `*ITENS:*\n`;
                
                for(let id in this.cart) {
                    const p = this.data.find(x => x.id === id);
                    if(p) msg += `‚ñ™ ${this.cart[id]}x ${p.name}\n`;
                }
                
                msg += `\n*TOTAL: ${total}*\n`;
                msg += `Pagamento: ${pay}\n`;
                
                window.open(`https://api.whatsapp.com/send?phone=5565996813588&text=${encodeURIComponent(msg)}`, '_blank');
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>
