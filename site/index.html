<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Super Cestas B√°sicas Dona Ant√¥nia - Cestas de qualidade e pre√ßo justo em Cuiab√° e V√°rzea Grande. Encomende online agora!">
    
    <meta name="geo.region" content="BR-MT" />
    <meta name="geo.placename" content="Cuiab√°" />
    <meta name="theme-color" content="#0F172A"> 
    <title>Super Cestas B√°sicas Dona Ant√¥nia</title>

    <style>
        /* --- DESIGN SYSTEM --- */
        :root {
            --cor-primary: #0F172A;
            --cor-action: #FF6D00;
            --cor-success: #008037; 
            --cor-warning: #FFAB00;
            --cor-danger: #D32F2F; 
            --cor-bg: #F1F5F9;
            --cor-surface: #FFFFFF; 
            --cor-text-main: #1E293B;
            --cor-text-light: #64748B;
            --cor-divider: #E2E8F0;
            
            --font-stack: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            
            --radius-md: 8px;
            --shadow-soft: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Reset & Base */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline-color: var(--cor-action); }
        
        body {
            font-family: var(--font-stack);
            background-color: #F1F5F9; 
            color: var(--cor-text-main);
            margin: 0;
            padding-bottom: 120px; /* Espa√ßo extra para barra fixa */
            font-size: 16px; 
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden; 
            width: 100%;
        }

        /* Container Limitador */
        .limit-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
            width: 100%;
        }

        h1, h2, h3, h4 { margin: 0; font-weight: 700; color: var(--cor-primary); letter-spacing: -0.02em; }
        button { cursor: pointer; border: none; background: none; font-family: inherit; font-weight: 600; }
        
        button:focus-visible, input:focus-visible, select:focus-visible {
            outline: 3px solid var(--cor-action);
            outline-offset: 2px;
        }

        /* --- HEADER --- */
        .header-wrapper {
            position: sticky; top: 0; z-index: 1000;
            background: var(--cor-primary);
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            width: 100%;
        }

        header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 20px; /* MODIFICADO: Aumentado para dar respiro */
            min-height: 70px;
            width: 100%;
        }
        
        .header-left { display: flex; align-items: center; gap: 12px; flex: 1; }
        .logo { width: 44px; height: 44px; border-radius: 50%; border: 2px solid white; object-fit: cover; flex-shrink: 0; }
        
        .page-title { 
            font-size: 1rem; font-weight: 700; color: white; 
            white-space: normal; line-height: 1.2;
        }
        
        .header-actions { display: flex; align-items: center; gap: 10px; }

        /* Novos Bot√µes Mini Topo */
        .header-mini-btns {
            display: flex; flex-direction: column; gap: 4px; margin-right: 5px;
        }
        .btn-mini-info {
            font-size: 0.65rem; background: rgba(255,255,255,0.15); color: white; 
            padding: 2px 8px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2);
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .btn-mini-info:hover { background: rgba(255,255,255,0.3); }

        .btn-header-icon {
            background: rgba(255,255,255,0.1); color: white;
            border-radius: 50%; padding: 0; 
            display: flex; align-items: center; justify-content: center;
            width: 40px; height: 40px; 
            font-size: 0.85rem; font-weight: 700;
            text-decoration: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            flex-shrink: 0;
            transition: 0.2s;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-header-icon:hover { background: rgba(255,255,255,0.2); }
        .btn-header-icon.whatsapp { background: #25D366; border-color: #25D366; }

        /* --- STICKY SEARCH & FILTERS --- */
        .sticky-stack { 
            position: sticky; 
            top: 70px; /* Abaixo do header */
            z-index: 990; 
            width: 100%; 
            background: var(--cor-bg); 
            padding-top: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }

        .search-container { padding: 8px 16px; background: var(--cor-bg); }
        .search-box {
            width: 100%; padding: 12px 16px;
            padding-right: 40px;
            border: 1px solid var(--cor-divider); border-radius: var(--radius-md);
            background: white;
            font-size: 1rem; color: var(--cor-text-main);
            box-shadow: var(--shadow-soft);
        }

        .btn-clear-search {
            position: absolute; right: 16px; top: 50%; transform: translateY(-50%);
            color: #94a3b8; font-size: 1.1rem; padding: 5px; display: none; z-index: 10;
        }

        .filters-container {
            padding: 0 16px 8px;
            background: var(--cor-bg);
            display: flex; gap: 8px;
            overflow-x: auto; white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .filters-container::-webkit-scrollbar { display: none; }
        
        .filter-chip {
            padding: 6px 14px; border-radius: 20px;
            border: 1px solid #CBD5E1; background: white;
            font-size: 0.85rem; color: var(--cor-text-light); font-weight: 600;
            transition: all 0.2s; flex-shrink: 0;
        }
        .filter-chip.active {
            background: var(--cor-primary); color: white;
            border-color: var(--cor-primary); box-shadow: 0 2px 4px rgba(15, 23, 42, 0.2);
        }
        
        .cat-chip {
            padding: 6px 14px; border-radius: 6px;
            border: 1px solid #e2e8f0; background: white;
            font-size: 0.8rem; color: var(--cor-text-main); font-weight: 600;
            text-transform: uppercase;
            transition: all 0.2s; flex-shrink: 0;
            cursor: pointer;
        }
        .cat-chip:hover { background: #f1f5f9; border-color: var(--cor-text-light); }

        /* --- HERO & BANNERS --- */
        .hero-section { background: white; padding: 15px 20px; text-align: center; margin-bottom: 10px; }
        .hero-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .hero-banner-mini {
            background: #E0F2F1; color: #00695C; padding: 10px 5px;
            border-radius: 8px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; line-height: 1.2;
            box-shadow: var(--shadow-soft); font-size: 0.8rem;
        }
        .hero-banner-mini strong { font-size: 0.85rem; display: block; margin-bottom: 2px; }

        /* --- CARROSSEL DE CESTAS (TOPO) --- */
        .section-title {
            padding: 15px 20px 10px; font-size: 1rem; color: var(--cor-primary); /* Fonte reduzida */
        }

        .cestas-scroll-container {
            display: flex; overflow-x: auto; padding: 0 20px 20px; gap: 15px;
            scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;
        }
        /* Scrollbar visible for Baskets too */
        .cestas-scroll-container::-webkit-scrollbar { display: block; height: 6px; }
        .cestas-scroll-container::-webkit-scrollbar-track { background: #f1f5f9; margin: 0 20px; border-radius: 4px; }
        .cestas-scroll-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

        .cesta-mini-card {
            flex: 0 0 260px; scroll-snap-align: center;
            background: white; border-radius: var(--radius-md);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid transparent;
            display: flex; flex-direction: column; overflow: hidden;
            transition: transform 0.2s;
        }
        .cesta-mini-card:hover { transform: translateY(-2px); border-color: var(--cor-action); }
        .cesta-mini-img { width: 100%; height: 160px; object-fit: cover; background: #eee; }
        .cesta-mini-content { padding: 12px; flex: 1; display: flex; flex-direction: column; }
        .cesta-mini-name { font-weight: 700; color: var(--cor-primary); margin-bottom: 4px; font-size: 1rem; }
        .cesta-mini-price { font-weight: 800; color: var(--cor-action); font-size: 1.2rem; margin-bottom: 8px; }
        .btn-cesta-select {
            margin-top: auto; width: 100%; background: var(--cor-primary); color: white;
            padding: 8px; border-radius: 6px; font-size: 0.85rem; text-transform: uppercase;
        }

        /* --- √ÅREA DE LISTA DA CESTA SELECIONADA (ESTILO RECUPERADO) --- */
        #selected-basket-area {
            background: white;
            margin-bottom: 15px;
            border-bottom: 1px solid #E2E8F0;
            animation: fadeIn 0.3s ease;
        }

        .intro-title-custom {
            padding: 15px 20px;
            background: #E0F2F1; color: #00695C;
            border-bottom: 1px solid #B2DFDB;
            font-size: 0.95rem; font-weight: 700;
            line-height: 1.4;
            text-align: center;
        }

        /* Estilos para Toggle Retr√°til - MODIFICADO */
        .basket-toggle-header {
            padding: 12px 20px;
            background: var(--cor-action); /* Cor de destaque */
            color: white; /* Texto branco */
            font-size: 0.9rem; font-weight: 700;
            text-transform: uppercase;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .basket-toggle-icon { transition: transform 0.3s ease; }
        .basket-toggle-icon.rotated { transform: rotate(180deg); }
        
        #basket-wrapper-collapsible {
            display: none; /* Come√ßa oculto ou vis√≠vel, controlado via JS */
            background: white;
        }
        /* Fim estilos Toggle */

        .basket-base-list { 
            background: white; padding: 0 20px 15px; 
            /* MODIFICADO: Scrollbar removida para mostrar tudo */
        }
        
        .list-header-row {
            display: flex; justify-content: space-between; 
            font-size: 0.7rem; font-weight: 700; color: #94a3b8; text-transform: uppercase;
            margin: 15px 0 8px; padding-bottom: 4px; border-bottom: 1px solid #f1f5f9;
        }

        .base-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px solid var(--cor-divider);
        }
        .base-item:last-child { border-bottom: none; }
        .base-item-name { font-size: 0.9rem; font-weight: 600; color: var(--cor-text-main); flex: 1; padding-right: 10px; }

        .section-separator {
            padding: 15px 20px; background: #f8fafc;
            border-top: 1px solid #e2e8f0; text-align: center;
        }
        .separator-title { font-size: 1rem; color: var(--cor-primary); font-weight: 800; }
        .separator-sub { font-size: 0.85rem; color: var(--cor-text-light); }

        /* --- CATALOGO GERAL --- */
        .catalog-section { padding-top: 10px; }
        
        .carousel-container { margin-bottom: 30px; background: white; padding-bottom: 15px; border-top: 1px solid var(--cor-divider); position: relative; }
        .carousel-header { padding: 15px 20px 10px; display: flex; justify-content: space-between; align-items: center; }
        .carousel-title { font-size: 1rem; font-weight: 700; color: var(--cor-primary); } /* Fonte reduzida */
        
        /* Select de ordena√ß√£o no carrossel */
        .carousel-sort-select {
            border: 1px solid #e2e8f0; border-radius: 4px;
            font-size: 0.75rem; color: var(--cor-text-light);
            background: #fff; padding: 4px;
        }

        .carousel-track {
            display: flex; overflow-x: auto; padding: 0 20px 10px; gap: 12px;
            scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; scroll-behavior: smooth;
        }
        .carousel-track::-webkit-scrollbar { display: block; height: 6px; }
        .carousel-track::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; margin: 0 20px; }
        .carousel-track::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }

        .prod-card {
            flex: 0 0 150px; scroll-snap-align: start;
            background: white; border: 1px solid var(--cor-divider); border-radius: var(--radius-md);
            padding: 10px; display: flex; flex-direction: column; position: relative;
        }
        .prod-img { width: 100%; aspect-ratio: 1; object-fit: contain; margin-bottom: 10px; background: white; cursor: zoom-in; }
        .prod-name { 
            font-size: 0.75rem; line-height: 1.3; height: 3.9em; 
            overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;
            color: var(--cor-text-main); margin-bottom: 8px; text-transform: uppercase;
        }
        .prod-price { font-size: 0.95rem; font-weight: 800; color: var(--cor-action); margin-top: auto; }
        
        .qty-control {
            display: flex; align-items: center; justify-content: space-between;
            background: #F1F5F9; padding: 2px 4px; border-radius: 20px;
            border: 1px solid #E2E8F0; margin-top: 6px;
        }
        .btn-q { 
            width: 28px; height: 28px; border-radius: 50%;
            background: white; color: var(--cor-primary); 
            font-size: 1.1rem; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .val-q { font-weight: 700; font-size: 0.9rem; min-width: 20px; text-align: center; }

        /* SETAS DO CARROSSEL (POSICIONADAS NA LINHA DA SCROLLBAR) */
        .carousel-arrow {
            display: flex; position: absolute; bottom: 8px; /* Alinhado com a scrollbar */
            width: 32px; height: 32px; background: white; border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 10;
            align-items: center; justify-content: center; font-size: 1rem;
            cursor: pointer; color: var(--cor-primary); border: 1px solid #eee;
        }
        .carousel-arrow:hover { background: #f8f8f8; }
        .arrow-left { left: 10px; }
        .arrow-right { right: 10px; }

        /* --- CHECKOUT BAR --- */
        .checkout-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; padding: 10px 16px; z-index: 1001; 
            display: grid; grid-template-columns: 1fr auto; gap: 10px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1); border-top: 1px solid #eee;
        }
        
        .btn-main-action {
            width: 100%; padding: 0 20px; border-radius: var(--radius-md);
            background: var(--cor-action); color: white; font-weight: 700;
            font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            height: 48px; display: flex; align-items: center; justify-content: center;
        }
        
        .btn-trash {
            width: 48px; height: 48px; border-radius: 8px;
            background: #FEE2E2; color: #D32F2F; border: 1px solid #FECACA;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 1.2rem;
        }

        /* --- TOASTS --- */
        #toast-container {
            position: fixed; top: 90px; right: 20px;
            z-index: 2000; display: flex; flex-direction: column; gap: 10px;
        }
        .toast {
            background: white; color: var(--cor-text-main);
            padding: 12px 16px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            font-size: 0.9rem; font-weight: 600;
            display: flex; align-items: center; gap: 10px;
            border-left: 4px solid var(--cor-action);
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }
        .toast.success { border-left-color: var(--cor-success); }
        .toast.remove { border-left-color: var(--cor-danger); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- BOTAO FLUTUANTE DIFEREN√áAS --- */
        .btn-floating-diff {
            position: fixed; bottom: 80px; right: 20px;
            width: 50px; height: 50px; background: white; color: var(--cor-primary);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 998;
            font-size: 1.5rem; cursor: pointer; border: 1px solid #CBD5E1;
            display: none; /* S√≥ aparece quando tem cesta selecionada */
        }

        /* --- MODAIS --- */
        dialog { 
            border: none; border-radius: 16px; width: 95%; max-width: 500px; 
            padding: 0; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); 
            background: white;
        }
        dialog:not([open]) { display: none; }
        dialog::backdrop { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(4px); }
        .modal-body { padding: 24px; text-align: center; }
        .modal-title { font-size: 1.25rem; margin-bottom: 12px; color: var(--cor-primary); font-weight: 800; }
        
        .btn-modal { width: 100%; padding: 14px; border-radius: 8px; font-weight: 700; margin-bottom: 10px; font-size: 0.95rem; cursor: pointer; }
        .btn-modal.primary { background: var(--cor-success); color: white; border: none; }
        .btn-modal.secondary { background: white; border: 2px solid var(--cor-action); color: var(--cor-action); }
        .btn-modal.ghost { color: var(--cor-text-light); font-weight: 400; margin-top: 10px; background: none; border: none; }

        /* FAQ */
        .faq-item { text-align: left; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .faq-q { font-weight: 700; color: var(--cor-primary); cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .faq-a { font-size: 0.9rem; color: #64748B; margin-top: 5px; display: none; }
        .faq-item.active .faq-a { display: block; }
        .faq-info { margin-top: 20px; padding: 15px; background: #F8FAFC; border-radius: 8px; font-size: 0.9rem; color: var(--cor-text-main); }

        /* Preview Carrossel */
        #modal-basket-preview .carousel-container { border: none; box-shadow: none; margin: 0; padding-bottom: 0; }
        #modal-basket-preview .carousel-track { padding: 10px 5px; justify-content: flex-start; }
        #modal-basket-preview .prod-card { border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05); width: 140px; }

        /* Zoom */
        #modal-image-zoom { background: transparent; box-shadow: none; width: 100%; height: 100%; max-width: 100%; max-height: 100%; }
        #modal-image-zoom .modal-body { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; padding: 20px; }
        #zoom-img { max-width: 90vw; max-height: 80vh; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); background: white; }

        @media (min-width: 900px) {
            .prod-card { flex: 0 0 180px; }
            .checkout-bar { max-width: 1200px; left: 50%; transform: translateX(-50%); }
        }
    </style>
</head>
<body>

    <div class="header-wrapper">
        <header class="limit-container">
            <div class="header-left">
                <img src="img/logo.webp" class="logo" alt="Logo Dona Ant√¥nia" width="44" height="44">
                <div class="page-title">Super Cestas<br>Dona Ant√¥nia</div>
            </div>
            
            <div class="header-actions">
                <div class="header-mini-btns">
                    <button class="btn-mini-info" onclick="showTopInfo('pagamento')">Pagamento</button>
                    <button class="btn-mini-info" onclick="showTopInfo('entrega')">Entrega</button>
                </div>

                <button class="btn-header-icon" onclick="document.getElementById('modal-faq').showModal()" aria-label="D√∫vidas Frequentes">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                </button>
                <a href="https://wa.me/5565996813588" target="_blank" class="btn-header-icon whatsapp" aria-label="Falar no WhatsApp">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                    </svg>
                </a>
            </div>
        </header>
    </div>

    <main class="limit-container">
        <div class="hero-section">
            <div class="hero-grid">
                <div class="hero-banner-mini">
                    <strong>Entrega Gr√°tis</strong>
                    <span>em Cuiab√° e VG</span>
                </div>
                <div class="hero-banner-mini">
                    <strong>Pague somente</strong>
                    <span>na entrega</span>
                </div>
            </div>
        </div>

        <div id="baskets-top-container">
            <div class="section-title">Escolha uma Cesta Pronta (Atalho)</div>
            <div class="cestas-scroll-container" id="cestas-scroll-list">
                </div>
        </div>

        <div style="padding: 0 20px 15px;" id="zero-mode-banner">
            <div class="hero-banner-mini" style="width:100%; padding: 15px;">
                <strong>Voc√™ pode montar a sua cesta como quiser.</strong>
                <span>Pedido m√≠nimo R$ 85,00</span>
            </div>
        </div>

        <div id="selected-basket-area" style="display:none;">
            <div class="intro-title-custom" id="basket-intro-msg"></div>
            
            <div class="basket-toggle-header" onclick="toggleBasketDetails()">
                <span>Ver itens da cesta</span>
                <span id="basket-arrow" class="basket-toggle-icon">‚ñº</span>
            </div>
            
            <div id="basket-wrapper-collapsible">
                <div class="basket-base-list" id="basket-list-content"></div>
            </div>

            <div class="section-separator">
                <h3 class="separator-title">Adicionar mais itens?</h3>
                <p class="separator-sub">Navegue pelo cat√°logo abaixo</p>
            </div>
        </div>

        <div class="sticky-stack">
            <div class="search-container">
                <div class="limit-container" style="position:relative">
                    <input type="text" id="search-input" class="search-box" placeholder="üîç Buscar produto (ex: arroz, sab√£o)..." aria-label="Buscar produtos" oninput="renderCatalogo()">
                    <button class="btn-clear-search" id="btn-clear-search" onclick="clearSearch()">‚úï</button>
                </div>
            </div>
            
            <div class="filters-container" id="category-nav">
                </div>
        </div>

        <div id="catalogo-content" class="catalog-section"></div>
    </main>

    <div class="checkout-bar">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div style="display:flex; flex-direction:column; justify-content:center;">
                <div id="chk-status-text" style="font-size:0.75rem; font-weight:700; color:var(--cor-text-light); line-height:1.2; text-transform:uppercase;">Montando...</div>
                <div class="balance-val" id="chk-total-val" style="color:var(--cor-primary); font-size:1.1rem; font-weight:800">R$ 0,00</div>
            </div>
        </div>
        <div style="display:flex; gap:8px;">
            <button class="btn-trash" onclick="clearCart()" title="Limpar Carrinho">üóëÔ∏è</button>
            <button class="btn-main-action" id="btn-concluir-pedido" onclick="openCheckoutModal()" style="flex:1;">
                CONCLUIR PEDIDO
            </button>
        </div>
    </div>
    
    <button class="btn-floating-diff" onclick="openDiffModal()" id="btn-view-diff-float">üìù</button>
    <div id="toast-container"></div>

    <dialog id="modal-basket-preview">
        <div class="modal-body" style="padding: 15px 0 20px;">
            <div style="padding: 0 20px;">
                <h3 class="modal-title" id="preview-title" style="margin-bottom:5px;">Nome da Cesta</h3>
                <p style="font-size:0.9rem; color:var(--cor-text-light); margin-bottom:15px;" id="preview-desc">Confira os itens abaixo:</p>
            </div>
            
            <div class="carousel-container" id="preview-carousel-container" style="background:#f8fafc;"></div>
            
            <div style="padding: 10px 20px;">
                <div style="margin-bottom:15px; font-size:1.2rem; font-weight:800; color:var(--cor-primary)" id="preview-price">R$ 0,00</div>
                <button class="btn-main-action" onclick="confirmBasketSelection()">ESCOLHER ESTA CESTA</button>
                <button class="btn-modal ghost" onclick="document.getElementById('modal-basket-preview').close()" style="margin-top:10px">Voltar</button>
            </div>
        </div>
    </dialog>

    <dialog id="modal-checkout">
        <div class="modal-body" style="text-align:left; padding: 15px 20px;">
            <h3 class="modal-title" style="margin-bottom:15px; text-align:center">Finalizar Pedido</h3>
            <div id="checkout-summary" style="margin-bottom:15px; font-size:0.9rem; background:#F8FAFC; padding:10px 15px; border-radius:8px; border:1px solid #eee; max-height: 40vh; overflow-y:auto;"></div>
            <div style="font-size:1.1rem; font-weight:800; text-align:right; margin-bottom:15px; color:var(--cor-primary)" id="checkout-total-display"></div>
            
            <label style="display:block; font-size:0.8rem; font-weight:700; color:#334155; margin-bottom:2px">Seu Nome:</label>
            <input type="text" id="cust-name" class="search-box" style="margin-bottom:10px; padding:10px; font-size:0.95rem" placeholder="Digite seu nome completo">
            
            <label style="display:block; font-size:0.8rem; font-weight:700; color:#334155; margin-bottom:2px">Forma de Pagamento:</label>
            <select id="cust-pay" class="search-box" style="margin-bottom:20px; padding:10px; font-size:0.95rem">
                <option>PIX (Na entrega)</option>
                <option>Dinheiro</option>
                <option>Cart√£o de Cr√©dito</option>
                <option>Cart√£o de D√©bito</option>
                <option>Cart√£o Alimenta√ß√£o</option>
            </select>
            
            <button class="btn-modal primary" onclick="sendOrder()">ENVIAR PEDIDO</button>
            <button class="btn-modal ghost" onclick="document.getElementById('modal-checkout').close()">Voltar</button>
        </div>
    </dialog>

    <dialog id="modal-diff">
        <div class="modal-body">
            <h3 class="modal-title">Altera√ß√µes na Cesta</h3>
            <div id="diff-content" style="text-align: left; background: #F8FAFC; padding: 15px; border-radius: 8px; font-size: 0.9rem; max-height: 50vh; overflow-y: auto;"></div>
            <button class="btn-modal primary" onclick="document.getElementById('modal-diff').close()" style="margin-top:15px">FECHAR</button>
        </div>
    </dialog>

    <dialog id="modal-faq">
        <div class="modal-body">
            <h3 class="modal-title">D√∫vidas Frequentes</h3>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Como funciona a entrega? <span>‚ñº</span></div><div class="faq-a">Entregamos gratuitamente em Cuiab√° e V√°rzea Grande. O prazo geralmente √© de at√© 24h √∫teis ap√≥s o pedido.</div></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Quais as formas de pagamento? <span>‚ñº</span></div><div class="faq-a">Aceitamos PIX, Dinheiro, Cart√£o de Cr√©dito, D√©bito e Cart√£o Alimenta√ß√£o na hora da entrega.</div></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Posso personalizar a cesta? <span>‚ñº</span></div><div class="faq-a">Sim! Voc√™ pode escolher uma cesta base e retirar ou adicionar qualquer produto que desejar.</div></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Tem pedido m√≠nimo? <span>‚ñº</span></div><div class="faq-a">Para cestas montadas do zero, o m√≠nimo √© R$ 85,00 e 10 itens. Para cestas prontas, n√£o h√° m√≠nimo.</div></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Os produtos s√£o de qualidade? <span>‚ñº</span></div><div class="faq-a">Sim, trabalhamos apenas com marcas reconhecidas e produtos selecionados com data de validade longa.</div></div>
            
            <div class="faq-info">
                <strong>Super Cestas Dona Ant√¥nia</strong><br>
                R. Trinta, 105 - Jardim Nossa Sra. Aparecida<br>Cuiab√° - MT, 78090-660<br><br>
                üìû (65) 99815-0975<br>
                üìû (65) 98449-1018
            </div>
            
            <div style="display:flex; gap:10px; margin-top:15px;">
                <a href="https://wa.me/5565998150975" target="_blank" class="btn-modal primary" style="margin:0; background:#25D366; display:flex; align-items:center; justify-content:center; gap:8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12.005 2.01C6.533 2.01 2.083 6.46 2.083 11.929C2.083 13.799 2.607 15.617 3.6 17.193L2.83 21.239L6.965 20.465C8.496 21.373 10.232 21.848 12.005 21.848C17.476 21.848 21.926 17.398 21.926 11.929C21.926 9.281 20.894 6.79 19.02 4.916C17.146 3.042 14.655 2.01 12.005 2.01Z"/></svg>Chamar no Zap
                </a>
                <a href="https://instagram.com" target="_blank" class="btn-modal secondary" style="margin:0; border-color:#E1306C; color:#E1306C; display:flex; align-items:center; justify-content:center; gap:8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>Instagram
                </a>
            </div>
            <button class="btn-modal ghost" onclick="document.getElementById('modal-faq').close()" style="margin-top:15px">Fechar</button>
        </div>
    </dialog>
    
    <dialog id="modal-mini-info">
        <div class="modal-body">
            <h3 class="modal-title" id="mini-info-title">Informa√ß√£o</h3>
            <p id="mini-info-text" style="color: #64748B; font-size: 0.95rem;"></p>
            <button class="btn-modal primary" onclick="document.getElementById('modal-mini-info').close()" style="margin-top:15px">OK</button>
        </div>
    </dialog>

    <dialog id="modal-image-zoom" onclick="this.close()">
        <div class="modal-body">
            <img id="zoom-img" src="" alt="Zoom">
            <button class="btn-modal secondary" style="background:white; margin-top:10px; width:auto; padding:10px 20px;">FECHAR</button>
        </div>
    </dialog>

    <script>
        // --- CONFIG ---
        const CONFIG_WHATSAPP = "5565996813588"; 
        
        // --- STATE ---
        let DB_PROD = [];
        let DB_CESTAS = [];
        let STATE = {
            cesta: null, cart: {}, basePrice: 0, currentTotal: 0, 
            sortType: 'name', initialGap: 0, mode: 'zero', // Come√ßa no modo ZERO por padr√£o
            previewBasketId: null
        };

        // --- INIT ---
        async function init() {
            try {
                const [r1, r2] = await Promise.all([
                    fetch('produtos-cesta-basica.json?v=' + Date.now()), 
                    fetch('produtos.json?v=' + Date.now())
                ]);
                
                if (r1.ok) DB_CESTAS = await r1.json();
                if (r2.ok) {
                    let txt = await r2.text();
                    txt = txt.trim().replace(/,(\s+)?$/, "");
                    if (!txt.startsWith('[')) txt = '[' + txt + ']';
                    DB_PROD = JSON.parse(txt).filter(x => x.situacao === "A").map(p => ({
                        id: String(p.id), code: String(p.codigo || p.id), name: p.nome, price: parseFloat(p.preco),
                        category: (p.categoria || p.Categoria || "Outros").trim(), img: `img/produtos/${p.codigo || p.id}.webp`
                    }));
                }
                
                renderBasketsTop();
                renderCategoryChips(); // Renderiza os chips de categoria
                renderCatalogo(); // Renderiza o catalogo imediatamente
                updateUI(); // Reseta UI
            } catch (e) { 
                console.error(e);
                document.getElementById('catalogo-content').innerHTML = '<p style="text-align:center; color:red">Erro ao carregar sistema.</p>';
            }
        }

        function renderBasketsTop() {
            const container = document.getElementById('cestas-scroll-list');
            container.innerHTML = DB_CESTAS.map(c => `
                <div class="cesta-mini-card" onclick="previewBasket('${c.id}')">
                    <img src="${c.imagem || ''}" class="cesta-mini-img" loading="lazy">
                    <div class="cesta-mini-content">
                        <div class="cesta-mini-name">${c.nome}</div>
                        <div class="cesta-mini-price">${fmt(c.preco)}</div>
                        <button class="btn-cesta-select">Ver Detalhes</button>
                    </div>
                </div>
            `).join('');
        }

        // --- LOGICA DE CATEGORIAS ---
        function renderCategoryChips() {
            const container = document.getElementById('category-nav');
            const categories = {};
            DB_PROD.forEach(p => { categories[p.category] = true; });
            let sortedCats = Object.keys(categories).sort();
            if(sortedCats.includes("Outros")) { sortedCats = sortedCats.filter(c => c !== "Outros"); sortedCats.push("Outros"); }
            
            // REMOVIDO CHIP DE BUSCAR DAQUI
            let html = "";
            html += sortedCats.map(cat => {
                const safeId = 'cat-' + cat.replace(/[^a-zA-Z0-9]/g, '-');
                return `<div class="cat-chip" onclick="scrollToCat('${safeId}')">${cat}</div>`;
            }).join('');
            
            container.innerHTML = html;
        }

        function scrollToCat(id) {
            const el = document.getElementById(id);
            if(el) {
                const headerOffset = 130;
                const elementPosition = el.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                window.scrollTo({ top: offsetPosition, behavior: "smooth" });
            }
        }

        // --- LOGICA DE PREVIEW & SELE√á√ÉO DE CESTA ---
        function previewBasket(id) {
            const cesta = DB_CESTAS.find(x => x.id === id);
            if(!cesta) return;
            STATE.previewBasketId = id;
            document.getElementById('preview-title').innerText = cesta.nome;
            document.getElementById('preview-price').innerText = fmt(cesta.preco);
            document.getElementById('preview-desc').innerText = `Esta cesta cont√©m v√°rios produtos selecionados.`;
            
            let itemsHtml = "";
            cesta.produtos.forEach(itemStr => {
                const [qStr, id] = itemStr.split('x ');
                const product = DB_PROD.find(p => p.id === id.trim());
                if (product) {
                    itemsHtml += `
                        <div class="prod-card">
                            <img src="${product.img}" class="prod-img" loading="lazy" onclick="openImageZoom('${product.img}')">
                            <div class="prod-name">${product.name}</div>
                            <div class="prod-price" style="font-size:0.9rem;color:#64748B;font-weight:normal">${qStr} UNIDADE(S)</div>
                        </div>`;
                }
            });
            document.getElementById('preview-carousel-container').innerHTML = `<div class="carousel-track">${itemsHtml}</div>`;
            document.getElementById('modal-basket-preview').showModal();
        }

        function confirmBasketSelection() {
            const id = STATE.previewBasketId;
            if(!id) return;
            
            // L√≥gica de substitui√ß√£o do carrinho
            STATE.cesta = DB_CESTAS.find(x => x.id === id);
            STATE.mode = 'custom';
            STATE.basePrice = STATE.cesta.preco;
            STATE.cart = {};
            
            let initialSum = 0;
            STATE.cesta.produtos.forEach(itemStr => {
                const [q, pid] = itemStr.split('x ');
                const product = DB_PROD.find(p => p.id === pid.trim());
                if (product) {
                    STATE.cart[pid.trim()] = parseInt(q);
                    initialSum += product.price * parseInt(q);
                }
            });
            
            STATE.initialGap = STATE.cesta.preco - initialSum;
            
            document.getElementById('modal-basket-preview').close();
            
            // Oculta banner de modo zero
            document.getElementById('zero-mode-banner').style.display = 'none';

            // ATIVA A AREA DA CESTA E RENDERIZA A LISTA
            document.getElementById('selected-basket-area').style.display = 'block';
            document.getElementById('basket-intro-msg').innerHTML = `Voc√™ selecionou a <strong>${STATE.cesta.nome}</strong>.<br>Edite os itens abaixo se quiser.`;
            
            // Abre a lista inicialmente para o usu√°rio ver
            document.getElementById('basket-wrapper-collapsible').style.display = 'block';
            document.getElementById('basket-arrow').classList.add('rotated');
            
            renderActiveBasketList();

            updateUI();
            renderCatalogo(); // Re-renderiza para mostrar quantidades
            
            document.getElementById('btn-view-diff-float').style.display = 'flex';
            showToast(`Cesta ${STATE.cesta.nome} carregada!`, 'success');
            
            // Scroll suave at√© a √°rea de edi√ß√£o
            document.getElementById('selected-basket-area').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Toggle Retr√°til da Lista
        function toggleBasketDetails() {
            const wrapper = document.getElementById('basket-wrapper-collapsible');
            const arrow = document.getElementById('basket-arrow');
            
            if(wrapper.style.display === 'none') {
                wrapper.style.display = 'block';
                arrow.classList.add('rotated');
            } else {
                wrapper.style.display = 'none';
                arrow.classList.remove('rotated');
            }
        }

        function renderActiveBasketList() {
             const el = document.getElementById('basket-list-content');
             const cartIds = Object.keys(STATE.cart);
             
             if(cartIds.length === 0) {
                 el.innerHTML = '<p style="text-align:center;color:#64748B;padding:10px;">Cesta vazia.</p>';
                 return;
             }
             
             // Sort A-Z
             cartIds.sort((a,b) => {
                 const pa = DB_PROD.find(x => x.id === a);
                 const pb = DB_PROD.find(x => x.id === b);
                 return (pa && pb) ? pa.name.localeCompare(pb.name) : 0;
             });

             let itemsHtml = cartIds.map(pid => {
                 const p = DB_PROD.find(x => x.id === pid);
                 if(!p) return '';
                 const qty = STATE.cart[pid];
                 return `
                 <div class="base-item">
                     <span class="base-item-name">${p.name}</span>
                     <div class="qty-control">
                         <button class="btn-q" onclick="upd('${pid}', -1)">-</button>
                         <span class="val-q qty-${pid}">${qty}</span>
                         <button class="btn-q" onclick="upd('${pid}', 1)">+</button>
                     </div>
                 </div>`;
             }).join('');

             el.innerHTML = `
                <div class="list-header-row">
                    <span>Produtos da Cesta</span>
                    <span>Qtd</span>
                </div>
                ${itemsHtml}
             `;
        }

        function clearCart() {
            if(Object.keys(STATE.cart).length === 0) return showToast("O carrinho j√° est√° vazio.", 'remove');
            if(!confirm("Tem certeza que deseja limpar todo o carrinho e come√ßar do zero?")) return;
            
            STATE.cart = {};
            STATE.mode = 'zero';
            STATE.cesta = null;
            STATE.basePrice = 0;
            STATE.initialGap = 0;
            
            // Esconde a √°rea da cesta selecionada
            document.getElementById('selected-basket-area').style.display = 'none';
            // Mostra banner de modo zero
            document.getElementById('zero-mode-banner').style.display = 'block';

            updateUI();
            renderCatalogo();
            document.getElementById('btn-view-diff-float').style.display = 'none';
            showToast("Carrinho limpo com sucesso!", 'remove');
        }

        // --- UPDATE & RENDER ---
        function upd(pid, d) {
            STATE.cart[pid] = (STATE.cart[pid] || 0) + d;
            if (STATE.cart[pid] <= 0) delete STATE.cart[pid];
            
            // Se usu√°rio mexe no carrinho, atualiza UI e Lista do Topo
            updateUI();
            
            // Se a lista da cesta estiver vis√≠vel, atualiza ela tamb√©m
            if(document.getElementById('selected-basket-area').style.display !== 'none') {
                renderActiveBasketList();
            }

            // Atualiza visualmente os contadores no cat√°logo
            const els = document.querySelectorAll(`.qty-${pid}`);
            els.forEach(el => el.innerText = STATE.cart[pid] || 0);
            
            // Toast logic
            const p = DB_PROD.find(x => x.id === pid);
            if(p) {
                if(d > 0) showToast(`${p.name} adicionado!`, 'success');
                else showToast(`${p.name} removido!`, 'remove');
            }
        }

        function updateUI() {
            const sumCart = Object.entries(STATE.cart).reduce((acc, [id, q]) => {
                const p = DB_PROD.find(x => x.id === id);
                return acc + (p ? p.price * q : 0);
            }, 0);
            
            STATE.currentTotal = sumCart + (STATE.initialGap || 0);

            const statusText = document.getElementById('chk-status-text');
            const totalVal = document.getElementById('chk-total-val');
            const btnConcluir = document.getElementById('btn-concluir-pedido');
            
            totalVal.innerText = fmt(STATE.currentTotal);
            
            if (STATE.mode === 'zero') {
                statusText.innerText = "TOTAL ACUMULADO";
                statusText.style.color = "var(--cor-text-light)";
                btnConcluir.innerText = "CONCLUIR PEDIDO";
            } else {
                // L√≥gica de Diferen√ßa para Cestas
                const diff = STATE.basePrice - STATE.currentTotal;
                
                // Texto do bot√£o
                let hasChanges = false;
                 if (STATE.mode === 'custom' && STATE.cesta) {
                    let originalMap = {};
                    STATE.cesta.produtos.forEach(itemStr => { const [q, id] = itemStr.split('x '); originalMap[id.trim()] = parseInt(q); });
                    for (let [id, origQty] of Object.entries(originalMap)) { if ((STATE.cart[id] || 0) < origQty) { hasChanges = true; break; } }
                    if(!hasChanges) { for (let [id, currQty] of Object.entries(STATE.cart)) { if (currQty > (originalMap[id] || 0)) { hasChanges = true; break; } } }
                }
                
                btnConcluir.innerText = hasChanges ? "CONCLUIR PERSONALIZA√á√ÉO" : "ENCOMENDAR CESTA NORMAL";

                // Texto de Status
                if (diff > 0.01) {
                    statusText.innerText = `CR√âDITO: ${fmt(diff)}`;
                    statusText.style.color = "var(--cor-success)";
                } else if (diff < -0.01) {
                    statusText.innerText = `EXTRA: +${fmt(Math.abs(diff))}`;
                    statusText.style.color = "#D32F2F";
                } else {
                    statusText.innerText = "CESTA COMPLETA";
                    statusText.style.color = "#64748B";
                }
            }
        }

        function renderCatalogo() {
            const query = document.getElementById('search-input').value.toUpperCase();
            const btnClear = document.getElementById('btn-clear-search');
            if(btnClear) btnClear.style.display = query ? 'block' : 'none';

            let html = "";
            let sorter = (a, b) => a.name.localeCompare(b.name);
            if (STATE.sortType === 'price_asc') sorter = (a, b) => a.price - b.price;
            else if (STATE.sortType === 'price_desc') sorter = (a, b) => b.price - a.price;

            if (query) {
                let results = DB_PROD.filter(p => p.name.toUpperCase().includes(query));
                results.sort(sorter);
                if (results.length > 0) {
                    html = `
                    <div class="carousel-container" id="search-results">
                        <div class="carousel-header">
                            <div class="carousel-title">Resultados da Busca</div>
                            <select class="carousel-sort-select" onchange="setSort(this.value)">
                                <option value="name" ${STATE.sortType=='name'?'selected':''}>A-Z</option>
                                <option value="price_asc" ${STATE.sortType=='price_asc'?'selected':''}>$ Min</option>
                                <option value="price_desc" ${STATE.sortType=='price_desc'?'selected':''}>$ Max</option>
                            </select>
                        </div>
                        <div class="carousel-arrow arrow-left" onclick="this.parentElement.querySelector('.carousel-track').scrollBy({left:-200, behavior:'smooth'})">‚ùÆ</div>
                        <div class="carousel-track">
                            ${results.map(p => renderProdCard(p)).join('')}
                        </div>
                        <div class="carousel-arrow arrow-right" onclick="this.parentElement.querySelector('.carousel-track').scrollBy({left:200, behavior:'smooth'})">‚ùØ</div>
                    </div>`;
                } else {
                    html = `<p style="text-align:center; padding:30px; color:#666">Nenhum produto encontrado.</p>`;
                }
            } else {
                // Ofertas
                const offers = DB_PROD.filter(p => p.name.toUpperCase().startsWith("OFERTA"));
                if (offers.length > 0) {
                    offers.sort(sorter);
                    html += `
                    <div class="carousel-container" id="cat-ofertas">
                        <div class="carousel-header">
                            <div class="carousel-title" style="color:var(--cor-danger)">üî• SUPER OFERTAS</div>
                            <select class="carousel-sort-select" onchange="setSort(this.value)">
                                <option value="name" ${STATE.sortType=='name'?'selected':''}>A-Z</option>
                                <option value="price_asc" ${STATE.sortType=='price_asc'?'selected':''}>$ Min</option>
                                <option value="price_desc" ${STATE.sortType=='price_desc'?'selected':''}>$ Max</option>
                            </select>
                        </div>
                        <div class="carousel-arrow arrow-left" onclick="this.parentElement.querySelector('.carousel-track').scrollBy({left:-200, behavior:'smooth'})">‚ùÆ</div>
                        <div class="carousel-track">${offers.map(p => renderProdCard(p)).join('')}</div>
                        <div class="carousel-arrow arrow-right" onclick="this.parentElement.querySelector('.carousel-track').scrollBy({left:200, behavior:'smooth'})">‚ùØ</div>
                    </div>`;
                }
                
                // Categorias
                const productsByCategory = {};
                DB_PROD.forEach(p => { let cat = p.category; if(!productsByCategory[cat]) productsByCategory[cat] = []; productsByCategory[cat].push(p); });
                let sortedCats = Object.keys(productsByCategory).sort();
                if(sortedCats.includes("Outros")) { sortedCats = sortedCats.filter(c => c !== "Outros"); sortedCats.push("Outros"); }
                
                sortedCats.forEach(catName => {
                    let catProds = productsByCategory[catName];
                    catProds.sort(sorter);
                    const safeId = 'cat-' + catName.replace(/[^a-zA-Z0-9]/g, '-');
                    if (catProds.length > 0) {
                        html += `
                        <div class="carousel-container" id="${safeId}">
                            <div class="carousel-header">
                                <div class="carousel-title">${catName}</div>
                                <select class="carousel-sort-select" onchange="setSort(this.value)">
                                    <option value="name" ${STATE.sortType=='name'?'selected':''}>A-Z</option>
                                    <option value="price_asc" ${STATE.sortType=='price_asc'?'selected':''}>$ Min</option>
                                    <option value="price_desc" ${STATE.sortType=='price_desc'?'selected':''}>$ Max</option>
                                </select>
                            </div>
                            <div class="carousel-arrow arrow-left" onclick="this.parentElement.querySelector('.carousel-track').scrollBy({left:-200, behavior:'smooth'})">‚ùÆ</div>
                            <div class="carousel-track">${catProds.map(p => renderProdCard(p)).join('')}</div>
                            <div class="carousel-arrow arrow-right" onclick="this.parentElement.querySelector('.carousel-track').scrollBy({left:200, behavior:'smooth'})">‚ùØ</div>
                        </div>`;
                    }
                });
            }
            document.getElementById('catalogo-content').innerHTML = html;
        }

        function renderProdCard(p) {
            return `
                <div class="prod-card">
                    <img src="${p.img}" class="prod-img" loading="lazy" onclick="openImageZoom('${p.img}')">
                    <div class="prod-name">${p.name}</div>
                    <div class="prod-price">${fmt(p.price)}</div>
                    <div class="qty-control">
                        <button class="btn-q" onclick="upd('${p.id}', -1)">-</button>
                        <span class="val-q qty-${p.id}">${STATE.cart[p.id] || 0}</span>
                        <button class="btn-q" onclick="upd('${p.id}', 1)">+</button>
                    </div>
                </div>`;
        }

        // --- UTILS & MODALS EXTRAS ---
        function showTopInfo(type) {
            const t = document.getElementById('mini-info-title');
            const c = document.getElementById('mini-info-text');
            
            if(type === 'pagamento') {
                t.innerText = "Formas de Pagamento";
                c.innerHTML = "Aceitamos na entrega:<br>‚Ä¢ PIX<br>‚Ä¢ Dinheiro<br>‚Ä¢ Cart√£o de Cr√©dito<br>‚Ä¢ Cart√£o de D√©bito<br>‚Ä¢ Cart√£o Alimenta√ß√£o";
            } else {
                t.innerText = "Sobre a Entrega";
                c.innerHTML = "‚Ä¢ Entrega GR√ÅTIS em Cuiab√° e V√°rzea Grande.<br>‚Ä¢ Prazo: At√© 24h √∫teis ap√≥s o pedido.";
            }
            document.getElementById('modal-mini-info').showModal();
        }

        function showToast(msg, type='success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `${type === 'remove' ? 'üóëÔ∏è' : '‚úÖ'}<span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 2500);
        }

        function openDiffModal() {
            let originalMap = {};
            if(STATE.cesta) STATE.cesta.produtos.forEach(itemStr => { const [q, id] = itemStr.split('x '); originalMap[id.trim()] = parseInt(q); });
            
            let removed = [], added = [];
            const fmtName = (n) => n.toLowerCase().split(' ').map(w => w.length <= 3 ? w : w[0].toUpperCase() + w.slice(1)).join(' ');

            for (let [id, origQty] of Object.entries(originalMap)) {
                const currQty = STATE.cart[id] || 0;
                if (currQty < origQty) { const p = DB_PROD.find(x => x.id === id); if(p) removed.push(`<div style="color:#D32F2F"><strong>- ${origQty - currQty}x</strong> ${fmtName(p.name)}</div>`); }
            }
            for (let [id, currQty] of Object.entries(STATE.cart)) {
                const origQty = originalMap[id] || 0;
                if (currQty > origQty) { const p = DB_PROD.find(x => x.id === id); if(p) added.push(`<div style="color:#008037"><strong>+ ${currQty - origQty}x</strong> ${fmtName(p.name)}</div>`); }
            }
            
            let content = (removed.length === 0 && added.length === 0) ? "<p style='color:#64748B'>Nenhuma altera√ß√£o.</p>" : "";
            if (removed.length > 0) content += `<div><h4 style="color:#D32F2F">Itens Retirados:</h4>${removed.join('')}</div>`;
            if (added.length > 0) content += `<div style="margin-top:10px"><h4 style="color:#008037">Itens Adicionados:</h4>${added.join('')}</div>`;
            
            document.getElementById('diff-content').innerHTML = content;
            document.getElementById('modal-diff').showModal();
        }

        function openCheckoutModal() {
            if (STATE.mode === 'custom' && STATE.currentTotal < (STATE.basePrice - 0.5)) return alert(`Faltam ${fmt(STATE.basePrice - STATE.currentTotal)} para completar o valor da cesta.`);
            if (STATE.mode === 'zero') {
                if (STATE.currentTotal < 85) return alert(`O valor m√≠nimo para montar uma cesta do zero √© R$ 85,00. Faltam ${fmt(85 - STATE.currentTotal)}.`);
                if (Object.keys(STATE.cart).length < 10) return alert(`Voc√™ precisa escolher pelo menos 10 itens diferentes. Atualmente: ${Object.keys(STATE.cart).length}.`);
            }
            
            let html = Object.entries(STATE.cart).map(([id, q]) => {
                const p = DB_PROD.find(x => x.id === id);
                return `<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee"><span style="font-size:0.9rem">${p.name}</span><span style="font-weight:700">${q}x</span></div>`;
            }).join('');
            
            document.getElementById('checkout-summary').innerHTML = html;
            document.getElementById('checkout-total-display').innerText = `Total: ${fmt(STATE.currentTotal)}`;
            document.getElementById('modal-checkout').showModal();
        }

        async function sendOrder() {
            const name = document.getElementById('cust-name').value;
            const pay = document.getElementById('cust-pay').value;
            if (!name) return alert("Digite seu nome.");
            
            const orderId = new Date().getTime().toString().slice(-6);
            let checklist = `TIPO: ${STATE.mode === 'zero' ? 'MONTADA DO ZERO' : 'PERSONALIZADA'} | CESTA: ${STATE.cesta ? STATE.cesta.nome : 'N/A'}`;
            
            const itensPayload = [];
            Object.entries(STATE.cart).forEach(([id, q]) => { const p = DB_PROD.find(x => x.id === id); if(p) itensPayload.push({id:p.id, nome:p.name, quantidade:q, preco_unitario:p.price}); });
            
            const payload = {
                cliente: { nome: name },
                pedido: { itens: itensPayload, total_site: STATE.currentTotal, forma_pagamento: pay, cesta_origem: checklist, observacoes: `Ref #${orderId}` }
            };

            try { await fetch("https://hook.eu1.make.com/yisqs4w309ogi6fx4969dbsr2q7fu7il", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) }); } catch(e){}

            let msg = `*PEDIDO #${orderId}*\nüë§ ${name}\nüí∞ ${pay}\n\n*ITENS:*\n`;
            itensPayload.forEach(i => msg += `${i.quantidade}x ${i.nome}\n`);
            msg += `\n*TOTAL: ${fmt(STATE.currentTotal)}*`;
            
            window.location.href = `https://wa.me/${CONFIG_WHATSAPP}?text=${encodeURIComponent(msg)}`;
        }

        function fmt(v) { return v.toLocaleString('pt-BR', {style:'currency', currency:'BRL'}); }
        function setSort(type) { STATE.sortType = type; renderCatalogo(); }
        function clearSearch() { document.getElementById('search-input').value = ""; renderCatalogo(); }
        function openImageZoom(src) { document.getElementById('zoom-img').src = src; document.getElementById('modal-image-zoom').showModal(); }

        init();
    </script>
</body>
</html>
