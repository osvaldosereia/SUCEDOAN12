<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Super Cestas Dona Ant√¥nia - Encomende online via WhatsApp.">
    
    <meta name="geo.region" content="BR-MT" />
    <meta name="geo.placename" content="Cuiab√°" />
    <meta name="theme-color" content="#ffffff">
    
    <title>Super Cestas Dona Ant√¥nia</title>

    <script type="application/ld-json">
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "Super Cestas Dona Ant√¥nia",
      "telephone": "5565984491018",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Cuiab√°",
        "addressRegion": "MT",
        "addressCountry": "BR"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": -15.6014,
        "longitude": -56.0979
      },
      "openingHoursSpecification": {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
        "opens": "07:30",
        "closes": "18:00"
      }
    }
    </script>

    <style>
        /* --- CONFIGURA√á√ïES GERAIS --- */
        :root {
            --cor-primary: #E63946; 
            --cor-bg: #F4F6F8;
            --cor-surface: #FFFFFF;
            --cor-text-main: #1D3557;
            --cor-text-sec: #6c757d;
            --cat-bg: #E7ECEF;
            --radius-box: 20px;
            --radius-btn: 50px;
            --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-stack);
            background-color: var(--cor-bg);
            color: var(--cor-text-main);
            margin: 0;
            padding-bottom: 120px;
            font-size: 16px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3 { margin: 0; font-weight: 700; color: var(--cor-text-main); letter-spacing: -0.5px; }
        button { cursor: pointer; border: none; outline: none; background: none; font-family: inherit; }

        /* --- ANIMA√á√ïES --- */
        @keyframes pop { 
            0% { transform: scale(1); } 
            50% { transform: scale(1.4); } 
            100% { transform: scale(1); } 
        }
        @keyframes shake { 
            0%, 100% { transform: translateX(0); } 
            20%, 60% { transform: translateX(-6px); } 
            40%, 80% { transform: translateX(6px); } 
        }
        @keyframes pulse-bar {
            0% { transform: scale(1); box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
            50% { transform: scale(1.02); box-shadow: 0 15px 40px rgba(230, 57, 70, 0.4); }
            100% { transform: scale(1); box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
        }

        .anim-pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .anim-shake { animation: shake 0.4s ease-in-out; }
        .anim-pulse { animation: pulse-bar 0.3s ease-out; }

        /* --- CABE√áALHO --- */
        .header-wrapper {
            position: sticky; top: 0; z-index: 100;
            background: var(--cor-surface);
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }

        header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 20px;
            height: 64px;
        }
        
        .header-left { display: flex; align-items: center; gap: 12px; }
        
        .logo { 
            width: 40px; height: 40px; 
            background: var(--cor-primary); color: white; 
            border-radius: 12px; display: grid; place-items: center; 
            font-weight: 800; font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(230, 57, 70, 0.3);
        }
        
        .page-title { font-size: 1.1rem; font-weight: 700; color: var(--cor-text-main); }
        .btn-back { display: none; font-size: 1.4rem; color: var(--cor-text-sec); padding: 5px; }
        .btn-help { width: 36px; height: 36px; background: #EDF2F4; border-radius: 50%; color: var(--cor-text-main); font-weight: bold; font-size: 1.1rem; }

        /* --- VISUALIZA√á√ÉO (VIEWS) --- */
        main { display: block; width: 100%; }
        .view { display: none; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .view.active { display: block; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- CARDS DE CESTAS (HOME) --- */
        .grid-cestas { 
            display: grid; 
            gap: 24px; 
            padding-top: 10px;
            grid-template-columns: 1fr; 
        }
        @media (min-width: 900px) {
            .grid-cestas { grid-template-columns: repeat(3, 1fr); }
        }
        
        .cesta-card {
            background: var(--cor-surface); border-radius: var(--radius-box);
            overflow: hidden; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
            display: flex; flex-direction: column;
        }
        .cesta-card:active { transform: scale(0.98); }

        .cesta-img-wrap { 
            width: 100%; 
            aspect-ratio: 1 / 1; 
            background: #EDF2F4; 
            position: relative; 
        }
        .cesta-img { width: 100%; height: 100%; object-fit: cover; }
        
        .cesta-content { padding: 20px; display: flex; flex-direction: column; flex: 1; }
        .cesta-name { font-size: 1.3rem; margin-bottom: 4px; color: var(--cor-text-main); }
        .cesta-info { 
            display: inline-block; background: #EDF2F4; color: var(--cor-text-sec); 
            padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; margin-bottom: 12px;
            align-self: flex-start;
        }
        .cesta-price { font-size: 1.6rem; font-weight: 800; color: var(--cor-primary); display: block; margin-bottom: 16px; margin-top: auto; }
        
        .cesta-actions { display: grid; grid-template-columns: 1fr 1.5fr; gap: 12px; }
        .btn-card { 
            padding: 14px; border-radius: var(--radius-btn); font-weight: 700; font-size: 0.95rem; 
            text-align: center;
        }
        .btn-outline { background: #EDF2F4; color: var(--cor-text-main); }
        .btn-primary { 
            background: var(--cor-primary); color: white; 
            box-shadow: 0 4px 12px rgba(230, 57, 70, 0.3); 
        }

        /* --- FERRAMENTAS DO CAT√ÅLOGO --- */
        .catalog-tools {
            position: sticky; top: 64px; z-index: 95;
            background: var(--cor-bg);
            padding: 10px 0 15px 0;
            margin-bottom: 10px;
        }
        
        .search-container {
            position: relative; margin-bottom: 12px;
        }
        .search-input {
            width: 100%; padding: 12px 15px 12px 45px;
            border-radius: 30px; border: none;
            background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            font-size: 1rem; color: #333; outline: none;
        }
        .search-icon {
            position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
            color: #999; font-size: 1.2rem; pointer-events: none;
        }

        .cat-nav {
            display: flex; gap: 8px; overflow-x: auto; 
            padding-bottom: 5px; scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }
        .cat-nav::-webkit-scrollbar { display: none; }
        
        .cat-chip {
            white-space: nowrap; padding: 8px 16px;
            border-radius: 20px; background: white;
            font-size: 0.85rem; font-weight: 600; color: #555;
            border: 1px solid #e0e0e0; transition: all 0.2s;
        }
        .cat-chip:active, .cat-chip.active {
            background: var(--cor-primary); color: white; border-color: var(--cor-primary);
        }

        /* --- CAT√ÅLOGO --- */
        .cat-section { scroll-margin-top: 180px; }
        
        .cat-title {
            font-size: 1.1rem; font-weight: 800; color: var(--cor-text-main);
            margin: 20px 0 15px 0; 
            text-transform: uppercase; letter-spacing: 0.5px;
            background: var(--cat-bg);
            padding: 12px 16px;
            border-radius: 12px;
            border-left: 5px solid var(--cor-primary);
        }
        
        /* CARROSSEL */
        .products-carousel {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 10px 5px 25px 5px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scroll-snap-type: x mandatory;
        }
        .products-carousel::-webkit-scrollbar { height: 6px; }
        .products-carousel::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .products-carousel::-webkit-scrollbar-thumb { background: #d1d1d1; border-radius: 4px; }

        .prod-card {
            background: var(--cor-surface);
            border-radius: 16px;
            padding: 15px;
            display: flex; flex-direction: column;
            align-items: center; text-align: center;
            border: 1px solid transparent;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            transition: all 0.2s;
            position: relative;
            flex: 0 0 auto; 
            width: 170px;
            scroll-snap-align: start;
        }
        @media (min-width: 900px) { .prod-card { width: 220px; } }

        .prod-card.esgotado { opacity: 0.7; filter: grayscale(1); }
        .prod-card.active { border-color: var(--cor-primary); background: #FFFBFB; }
        .prod-card.hidden { display: none !important; } 

        .prod-img-box {
            width: 100%; height: 130px;
            margin-bottom: 10px;
            display: flex; align-items: center; justify-content: center;
        }
        .prod-img { width: 100%; height: 100%; object-fit: contain; mix-blend-mode: multiply; }

        .prod-price { font-size: 1.1rem; font-weight: 800; color: var(--cor-primary); margin-bottom: 4px; }
        .prod-name { 
            font-size: 0.9rem; color: #555; font-weight: 500; 
            line-height: 1.3; margin-bottom: 15px;
            display: -webkit-box; -webkit-line-clamp: 3;
            -webkit-box-orient: vertical; overflow: hidden; 
            min-height: 52px;
        }

        .action-area { width: 100%; margin-top: auto; }
        
        .btn-add-simple {
            width: 100%; padding: 12px; background: #EDF2F4; color: var(--cor-text-main);
            border-radius: 12px; font-weight: 700; font-size: 0.9rem;
            transition: transform 0.1s;
        }
        .btn-add-simple:active { transform: scale(0.95); background: #e0e0e0; }

        .btn-esgotado {
            width: 100%; padding: 12px; background: #eee; color: #999;
            border-radius: 12px; font-weight: 700; font-size: 0.85rem;
            cursor: not-allowed;
        }
        
        .qty-control {
            display: flex; align-items: center; justify-content: space-between;
            background: var(--cor-primary); border-radius: 12px;
            padding: 6px; color: white; width: 100%;
        }
        .btn-q { width: 30px; height: 30px; font-size: 1.2rem; display: grid; place-items: center; font-weight: bold; transition: transform 0.1s; }
        .btn-q:active { transform: scale(0.8); }
        .val-q { font-weight: 700; font-size: 1.1rem; }

        /* --- LISTA HORIZONTAL (ITENS DA CESTA) --- */
        .basket-scroll {
            display: flex; gap: 12px; overflow-x: auto; padding: 10px 5px 25px; scroll-behavior: smooth;
        }
        .basket-scroll::-webkit-scrollbar { height: 8px; }
        .basket-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .basket-scroll::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        
        .chip-item {
            flex: 0 0 135px;
            background: white; padding: 12px; border-radius: 16px;
            border: 1px solid #e0e0e0; text-align: center;
            display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .ctrl-top { display: flex; gap: 10px; margin-top: 8px; align-items: center; }
        .btn-mini-top { width: 32px; height: 32px; background: #f0f0f0; border-radius: 50%; font-weight: bold; font-size: 1.2rem; display: grid; place-items: center; color: var(--cor-primary); transition: transform 0.1s; }
        .btn-mini-top:active { transform: scale(0.8); }

        /* --- BARRA FLUTUANTE --- */
        .float-bar {
            position: fixed; bottom: 20px; left: 15px; right: 15px;
            background: #222; color: white;
            padding: 12px 20px; border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.25);
            display: none; justify-content: space-between; align-items: center; z-index: 90;
            max-width: 600px; margin: 0 auto;
        }
        .total-lbl { font-size: 0.7rem; opacity: 0.8; text-transform: uppercase; font-weight: 700; }
        .total-val { font-size: 1.3rem; font-weight: 700; }
        .btn-finish {
            background: var(--cor-primary); color: white;
            padding: 10px 24px; border-radius: 30px; font-weight: 700; font-size: 0.95rem;
        }
        .btn-finish:disabled { background: #555; color: #aaa; }

        /* --- MODAIS --- */
        dialog {
            border: none; border-radius: 24px; padding: 0; width: 90%; max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); background: var(--cor-surface);
        }
        dialog::backdrop { background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        
        .modal-head { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f0f0f0; }
        .modal-body { padding: 24px; max-height: 70vh; overflow-y: auto; }
        
        .input-box {
            width: 100%; padding: 14px; border: 2px solid #EDF2F4; 
            border-radius: 12px; font-size: 1rem; margin-bottom: 16px;
            background: #F8FAFC; transition: border-color 0.2s;
        }
        .input-box:focus { border-color: var(--cor-primary); background: white; }
        label { display: block; margin-bottom: 6px; font-weight: 700; color: var(--cor-text-main); font-size: 0.9rem; }

        .clean-item {
            display: flex; align-items: center; justify-content: flex-start;
            padding: 10px 0; border-bottom: 1px solid #f0f0f0; gap: 15px;
        }
        .clean-qty { 
            background: #EDF2F4; color: var(--cor-primary); padding: 5px 12px; 
            border-radius: 8px; font-weight: 800; font-size: 1rem;
        }
        .clean-name { font-size: 0.95rem; color: #333; font-weight: 500; }

        /* --- FAQ --- */
        details { background: #f9f9f9; border-radius: 12px; margin-bottom: 10px; overflow: hidden; }
        summary { padding: 15px; font-weight: 700; cursor: pointer; display: flex; justify-content: space-between; color: #333; }
        .ans { padding: 0 15px 15px; color: #555; line-height: 1.4; }

        .company-info { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px dashed #ddd; }
        .company-name { font-weight: 800; color: var(--cor-primary); margin: 10px 0 5px; font-size: 1.1rem; }
        .company-data { font-size: 0.9rem; color: #777; margin-bottom: 15px; line-height: 1.6; }
        .social-btns { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }
        .btn-social { 
            padding: 10px 20px; border-radius: 20px; font-size: 0.85rem; 
            color: white; text-decoration: none; font-weight: 600; display: inline-block;
        }

        /* ZOOM */
        dialog#zoom-modal { background: #fff; width: 100%; height: 100%; max-width: 100%; max-height: 100%; border-radius: 0; }
        .zoom-close { position: absolute; top: 20px; right: 20px; font-size: 2rem; padding: 10px; z-index: 10; }
        .zoom-content { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .zoom-img-full { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .status-toast {
            display: none; position: fixed; top: 100px; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 12px 24px; border-radius: 50px;
            font-weight: 600; z-index: 200; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <div id="status-toast" class="status-toast"></div>

    <div class="header-wrapper">
        <header>
            <div class="header-left">
                <button class="btn-back" id="btn-back" onclick="resetAndGoHome()">‚ùÆ</button>
                <div class="logo">D</div>
                <div id="page-title" class="page-title">Super Cestas</div>
            </div>
            <button class="btn-help" onclick="document.getElementById('modal-faq').showModal()">?</button>
        </header>
    </div>

    <main id="main-content">
        
        <div id="view-home" class="view active">
            <h2 style="padding: 10px 0; color:#444;">Nossas Cestas</h2>
            <div class="grid-cestas" id="cestas-container">
                <p style="text-align:center; padding:40px; color:#999">Carregando cat√°logo...</p>
            </div>
        </div>

        <div id="view-catalogo" class="view">
            <div class="catalog-tools">
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="search-input" placeholder="O que voc√™ procura?" onkeyup="doSearch(this.value)">
                </div>
                <div class="cat-nav" id="cat-nav">
                    </div>
            </div>
            <div id="catalog-content"></div>
        </div>
    </main>

    <div class="float-bar" id="cart-bar">
        <div class="total-info">
            <div class="total-lbl">Total Estimado</div>
            <div class="total-val" id="total-display">R$ 0,00</div>
        </div>
        <button class="btn-finish" id="btn-finish" onclick="openCheckout()">CONCLUIR PEDIDO</button>
    </div>

    <dialog id="modal-details">
        <div class="modal-head">
            <h3>Itens da Cesta</h3>
            <button onclick="document.getElementById('modal-details').close()" style="font-size:1.5rem;">‚úï</button>
        </div>
        <div class="modal-body">
            <div id="detail-list"></div>
            <div style="padding:20px 0; text-align:center;">
                <button class="btn-finish" style="width:100%" onclick="orderDirect()">PEDIR ESSA CESTA</button>
            </div>
        </div>
    </dialog>

    <dialog id="modal-checkout">
        <div class="modal-head">
            <h3>Finalizar Pedido</h3>
            <button onclick="document.getElementById('modal-checkout').close()" style="font-size:1.5rem;">‚úï</button>
        </div>
        <div class="modal-body">
            <h4 style="margin-bottom:15px; color:#666;">Resumo dos Itens</h4>
            <div id="checkout-list" style="margin-bottom:25px;"></div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 16px; text-align: center; margin-bottom: 25px; border: 2px dashed #e9ecef;">
                <span style="display:block; font-size:0.85rem; color:#666; font-weight:700; margin-bottom:5px; text-transform:uppercase;">Valor Total a Pagar</span>
                <span id="checkout-total" style="font-size:2rem; font-weight:800; color:var(--cor-primary);">R$ 0,00</span>
            </div>
            
           <form onsubmit="sendWhatsapp(event)">
            <label>Seu Nome</label>
            <input type="text" id="cust-name" class="input-box" required placeholder="Digite seu nome">
            
            <label>CPF (Para o Cadastro)</label>
            <input type="tel" id="cust-cpf" class="input-box" required placeholder="000.000.000-00" maxlength="14" oninput="mascaraCPF(this)">
            
            <label>Celular (WhatsApp)</label>
            <input type="tel" id="cust-phone" class="input-box" required placeholder="(65) 99999-9999" maxlength="15" oninput="mascaraTelefone(this)">

            <label>Endere√ßo de Entrega</label>
            <input type="text" id="cust-addr" class="input-box" required placeholder="Rua, N√∫mero, Bairro">
            
            <label>Forma de Pagamento</label>
            <select id="cust-pay" class="input-box">
                <option>PIX (Na entrega)</option>
                <option>Dinheiro (Levar troco?)</option>
                <option>Cart√£o (Cr√©dito/D√©bito)</option>
            </select>
            
            <button type="submit" class="btn-finish" style="width:100%; padding: 15px; font-size: 1.1rem;">ENVIAR PEDIDO AGORA</button>
        </form>
        </div>
    </dialog>

    <dialog id="modal-faq">
        <div class="modal-head"><h3>Ajuda</h3><button onclick="document.getElementById('modal-faq').close()" style="font-size:1.5rem;">‚úï</button></div>
        <div class="modal-body">
            <details><summary>Entrega</summary><div class="ans">Cuiab√° e V√°rzea Grande. Combinamos o hor√°rio no WhatsApp.</div></details>
            <details><summary>Pagamento</summary><div class="ans">Pague somente na entrega via PIX, Dinheiro ou Cart√£o.</div></details>
            <details><summary>Posso mudar itens?</summary><div class="ans">Sim! Clique em "Personalizar". Voc√™ pode trocar ou retirar at√© 30% dos itens.</div></details>
            <details><summary>Pedido M√≠nimo</summary><div class="ans">O valor m√≠nimo √© o pre√ßo da cesta escolhida.</div></details>

            <div class="company-info">
                <div class="logo" style="width:50px; height:50px; margin:0 auto; font-size:1.5rem;">D</div>
                <div class="company-name">Super Cestas Dona Ant√¥nia</div>
                <div class="company-data">
                    CNPJ: 00.000.000/0001-00<br>
                    Atendimento Online - Cuiab√° e VG<br>
                    <strong>(65) 98449-1018</strong><br>
                    <strong>(65) 99815-0975</strong>
                </div>
                <div class="social-btns">
                    <a href="https://wa.me/5565984491018" class="btn-social" style="background:#25D366">WhatsApp</a>
                    <a href="#" class="btn-social" style="background:#E1306C">Instagram</a>
                </div>
            </div>
        </div>
    </dialog>

    <dialog id="zoom-modal">
        <button class="zoom-close" onclick="document.getElementById('zoom-modal').close()">‚úï</button>
        <div class="zoom-content">
            <img id="zoom-img" class="zoom-img-full">
        </div>
    </dialog>

    <script>
        const CONFIG = { whatsapp: "5565984491018", maxRemoval: 0.3 };
        const MAKE_WEBHOOK = "https://hook.eu1.make.com/yisqs4w309ogi6fx4969dbsr2q7fu7il"; 

        // ============================================================
        //  CONFIGURA√á√ÉO DAS CATEGORIAS
        // ============================================================
        const CONFIG_CATEGORIAS = {
            "Beb√™ e Infantil": ["FRALDA", "LENCO UMEDECIDO", "LEN√áO UMED", "HUGGIES", "PIQUITUCHO", "POMADA", "MUCILON"],
            "Cabelos": ["SHAMPOO", "CONDICIONADOR", "SH SEDA", "SEDA", "SKALA", "CREME DE PENTEAR", "LOCAO", "LUMINOSO UV", "CACHOS", "LISO PERFEITO", "CERAMIDAS", "PENTE", "ELASTICO DE CABELO", "ESCOVA DE CABELO", "ESCOVA RETANGULAR"],
            "Higiene Pessoal": ["SABONETE", "SAB NIVEA", "SAB FARNESE", "SAB ALBANY", "PALMOLIVE", "FLOR DE YPE", "DESODORANTE", "DES AERO", "HERBISSIMO", "ABOVE", "TABU", "NIVEA", "LEITE DE ROSAS", "ABSORVENTE", "ABS ", "INTIMUS", "SYM", "DIANA", "OB MEDIO", "OB TAMPAO", "ALGODAO", "COTONETE", "HASTES FLEXIVEIS", "CURATIVO", "SALVELOX", "LAMINA", "BARBEAR", "PRESTOBARBA", "GILLETTE", "APAR BARB", "ACETONA", "REMOVEDOR", "LIXA", "TALCO"],
            "Higiene Bucal": ["CREME DENTAL", "ESCOVA DENTAL", "FIO DENTAL", "SORRISO", "COLGATE", "KESS", "PALITO DENTAL"],
            "Lavanderia": ["SABAO EM PO", "SABAO PO", "TIXAN", "OMO", "YPE", "SABAO BARRA", "MINUANO", "INDAIA", "AMACIANTE", "AGUA SANITARIA", "Q BOA", "ALVEJANTE", "PRENDEDOR", "ESCOVA ROUPA"],
            "Limpeza da Casa": ["DESINFETANTE", "BAK", "OESTE", "REMMUS", "PINHO", "VEJA", "MULTI USO", "LIMPA ALUMINIO", "DETERGENTE", "LAVA LOUCAS", "ESPONJA", "LA DE ACO", "BOMBRIL", "ASSOLAN", "PANO", "INSETICIDA", "SBP", "PURIFICADOR", "GLADE", "PEDRA SANITARIA", "ESCOVA SANITARIA", "VASSOURA", "RODO", "PA DE LIXO", "SACO DE LIXO", "SACO PANO"],
            "Mercearia B√°sica": ["ARROZ", "FEIJAO", "OLEO", "AZEITE", "FARINHA", "FUBA", "FLOCAO", "MILHARINA", "AMIDO DE MILHO", "CANJIQUINHA", "PIPOCA", "MILHO PIPOCA", "SARDINHA", "COQUEIRO", "MILHO VERDE", "SELETA", "ERVILHA", "AZEITONA"],
            "Massas e Molhos": ["MACARRAO", "MASSA", "PENNE", "PARAFUSO", "ESPAGUETE", "PADRE NOSSO", "EXTRATO", "MOLHO TOMATE", "FUGINI", "QUEIJO RALADO"],
            "Caf√© da Manh√£": ["CAFE", "FILTRO CAFE", "COADOR", "CHA ", "ERVA MATE", "ERVA TERERE", "LEITE PO", "LEITE EM PO", "MERILU", "ACHOCOLATADO", "TODDY", "NESCAU", "CEREAL MATINAL", "SUCRILHOS", "GRANOLA", "AVEIA"],
            "Biscoitos e Lanches": ["BISCOITO", "BOLACHA", "WAFER", "CREAM CRACKER", "AGUA E SAL", "MAIZENA", "ROSQUINHA", "MABEL", "LIANE", "RANCHEIRO", "BELCOCO", "TUCS", "BARRA DE CEREAL", "BARRA CEREAIS", "TRIO"],
            "Doces e Sobremesas": ["ACUCAR", "ADOCANTE", "LEITE CONDENSADO", "CREME DE LEITE", "MISTURA CREME", "GELATINA", "MISTURA BOLO", "FERMENTO", "COCO RALADO", "LEITE DE COCO", "GOIABADA", "DOCE", "BALA", "CHICLE", "TRIDENT", "FINI", "CHOCOLATE", "BOMBOM"],
            "Temperos e Condimentos": ["CALDO", "KNORR", "MAGGI", "ARISCO", "SAZON", "SAL ", "SAL REF", "TEMPERO", "PIMENTA", "OREGANO", "COLORAU", "ACAFRAO", "ALHO", "LOURO", "BICARBONATO", "MAIONESE", "HELLMANNS", "KETCHUP", "MOSTARDA", "VINAGRE"],
            "Utilidades Dom√©sticas": ["LAMPADA", "PILHA", "BATERIA", "RAYOVAC", "ELGIN", "FOSFORO", "ISQUEIRO", "COLA", "PAPEL ALUMINIO", "FILME PVC", "TIGELA", "JARRA", "POTE", "COPO", "PRATO", "TALHER", "FACA", "ESPATULA", "DESCASCADOR", "FORMA GELO", "PROTETOR DE RALO", "PILAO", "PENEIRA", "DESCANSO DE PANELA", "CHAVEIRO", "AGULHA DESENTUPIR", "ESPONJA DE BANHO"],
            "Bazar e Papelaria": ["CHINELO", "HAVAIANA", "SANDALIA", "CANETA", "LAPIS", "GRAFITE", "CADERNO", "LINHA", "AGULHA", "TESOURA"]
        };
        const CATEGORIA_PADRAO = "Outros";

        let DB_PROD = [], DB_CESTAS = [], CART = {}, CURR_CESTA = null, ORIG_COUNTS = {}, ORIG_TOTAL = 0;

        function detectarCategoria(nomeProduto) {
            if (!nomeProduto) return CATEGORIA_PADRAO;
            const nomeNormalizado = nomeProduto.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase();
            for (const [categoria, keywords] of Object.entries(CONFIG_CATEGORIAS)) {
                for (const keyword of keywords) {
                    const kwNormalizada = keyword.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase();
                    if (nomeNormalizado.includes(kwNormalizada)) {
                        return categoria;
                    }
                }
            }
            return CATEGORIA_PADRAO;
        }

        async function init() {
            try {
                try {
                    const cRes = await fetch('produtos-cesta-basica.json');
                    if (cRes.ok) {
                        DB_CESTAS = await cRes.json();
                        renderHome();
                    } else {
                        document.getElementById('cestas-container').innerHTML = "<p style='text-align:center; padding:40px'>Erro ao carregar cestas.</p>";
                    }
                } catch (e) { console.error("Erro Cestas:", e); }

                try {
                    const pRes = await fetch('produtos.json');
                    if (pRes.ok) {
                        let text = await pRes.text();
                        text = text.trim().replace(/,(\s+)?$/, ""); 
                        if (!text.startsWith('[')) text = '[' + text;
                        if (!text.endsWith(']')) text = text + ']';

                        const rawProd = JSON.parse(text);
                        DB_PROD = rawProd.filter(x => x && x.situacao === "A").map(x => {
                                const sId = String(x.id);
                                const sCodigo = x.codigo ? String(x.codigo) : sId;
                                const finalImg = `img/produtos/${sCodigo}.webp`;
                                const nomeCategoria = detectarCategoria(x.nome);
                                return { id: sId, name: x.nome, price: parseFloat(x.preco), cat: nomeCategoria, stock: x.estoque || 0, img: finalImg };
                            });
                        
                        const savedCestaId = localStorage.getItem('da_cesta_id');
                        const savedCart = localStorage.getItem('da_cart');
                        const savedOrig = localStorage.getItem('da_orig');
                        
                        if (savedCestaId && savedCart && DB_CESTAS.length > 0) {
                            const c = DB_CESTAS.find(x => x.id === savedCestaId);
                            if (c) {
                                CURR_CESTA = c;
                                CART = JSON.parse(savedCart);
                                ORIG_COUNTS = savedOrig ? JSON.parse(savedOrig) : {};
                                ORIG_TOTAL = 0;
                                for(let k in ORIG_COUNTS) ORIG_TOTAL += ORIG_COUNTS[k];
                                document.getElementById('view-home').classList.remove('active');
                                document.getElementById('view-catalogo').classList.add('active');
                                document.getElementById('btn-back').style.display = 'block';
                                document.getElementById('cart-bar').style.display = 'flex';
                                document.getElementById('page-title').innerText = CURR_CESTA.nome;
                                renderCatalog();
                                updateTotals();
                                showToast("Seu carrinho foi restaurado!");
                            }
                        }
                    }
                } catch (e) { console.error("Erro Produtos:", e); }

            } catch (err) { console.error("Erro fatal:", err); }
        }

        function saveState() {
            if (CURR_CESTA) {
                localStorage.setItem('da_cesta_id', CURR_CESTA.id);
                localStorage.setItem('da_cart', JSON.stringify(CART));
                localStorage.setItem('da_orig', JSON.stringify(ORIG_COUNTS));
            }
        }

        function resetAndGoHome() {
            if(confirm("Deseja limpar o carrinho e voltar para o in√≠cio?")) {
                localStorage.removeItem('da_cesta_id');
                localStorage.removeItem('da_cart');
                localStorage.removeItem('da_orig');
                CART = {}; CURR_CESTA = null; ORIG_COUNTS = {};
                goHome();
            }
        }

        function goHome() {
            document.getElementById('view-home').classList.add('active');
            document.getElementById('view-catalogo').classList.remove('active');
            document.getElementById('btn-back').style.display = 'none';
            document.getElementById('cart-bar').style.display = 'none';
            document.getElementById('page-title').innerText = "Super Cestas";
            document.getElementById('status-toast').style.display = 'none';
        }

        function goCatalog(id) {
            if (DB_PROD.length === 0) {
                showToast("Aguarde, carregando estoque de produtos...");
                init();
                return;
            }
            window.scrollTo(0,0);
            CURR_CESTA = DB_CESTAS.find(c => c.id === id);
            CART = {}; ORIG_COUNTS = {}; ORIG_TOTAL = 0;
            
            CURR_CESTA.produtos.forEach(s => {
                const parts = s.split('x '); 
                if(parts.length >= 2) {
                    const iq = parseInt(parts[0]);
                    const cid = parts[1].trim();
                    if(DB_PROD.find(x => x.id === cid)) {
                        CART[cid] = iq; ORIG_COUNTS[cid] = iq; ORIG_TOTAL += iq;
                    }
                }
            });
            
            saveState();
            document.getElementById('view-home').classList.remove('active');
            document.getElementById('view-catalogo').classList.add('active');
            document.getElementById('btn-back').style.display = 'block';
            document.getElementById('cart-bar').style.display = 'flex';
            document.getElementById('page-title').innerText = CURR_CESTA.nome;
            renderCatalog(); 
            updateTotals();
        }

        function renderHome() {
            const div = document.getElementById('cestas-container');
            if (DB_CESTAS.length === 0) {
                div.innerHTML = "<p style='text-align:center; padding:40px'>Nenhuma cesta encontrada.</p>";
                return;
            }
            div.innerHTML = "";
            const ph = svgPlace();
            
            DB_CESTAS.forEach(c => {
                const img = (c.imagem && c.imagem !== "") ? c.imagem : ph;
                div.innerHTML += `
                <div class="cesta-card">
                    <div class="cesta-img-wrap"><img src="${img}" class="cesta-img" loading="lazy" onclick="zoom('${img}')"></div>
                    <div class="cesta-content">
                        <div class="cesta-name">${c.nome}</div>
                        <span class="cesta-info">${c.produtos.length} Itens</span>
                        <span class="cesta-price">${fmt(c.preco)}</span>
                        <div class="cesta-actions">
                            <button class="btn-card btn-outline" onclick="details('${c.id}')">Ver Itens</button>
                            <button class="btn-card btn-primary" onclick="goCatalog('${c.id}')">Personalizar</button>
                        </div>
                    </div>
                </div>`;
            });
        }

        function renderCatalog() {
            const div = document.getElementById('catalog-content');
            div.innerHTML = "";
            const ph = svgPlace();
            
            const navDiv = document.getElementById('cat-nav');
            navDiv.innerHTML = "";
            
            let html = `<div style="margin-bottom:30px;">
                <h3 style="font-size:1rem; color:#888; margin-bottom:10px; padding-left:5px;">Itens da Cesta</h3>
                <div class="basket-scroll">`;
            
            Object.keys(ORIG_COUNTS).forEach(id => {
                const p = DB_PROD.find(x => x.id === id);
                if(!p) return;
                const qty = CART[id] || 0;
                html += `
                <div class="chip-item">
                    <img src="${p.img || ph}" style="width:100px; height:100px; object-fit:contain;" onclick="zoom('${p.img||ph}')">
                    <div style="font-weight:700; font-size:1rem; margin:6px 0;">${qty}un</div>
                    <div class="ctrl-top">
                        <button class="btn-mini-top" onclick="upd('${id}', -1)">-</button>
                        <button class="btn-mini-top" onclick="upd('${id}', 1)">+</button>
                    </div>
                </div>`;
            });
            html += `</div></div>`;

            const cats = {};
            DB_PROD.forEach(p => { if(!cats[p.cat]) cats[p.cat] = []; cats[p.cat].push(p); });
            const sortedKeys = Object.keys(cats).sort();

            sortedKeys.forEach((c, index) => {
                if (c === CATEGORIA_PADRAO && cats[c].length === 0) return;

                const safeId = `cat-${index}`;
                navDiv.innerHTML += `<button class="cat-chip" onclick="scrollToCat('${safeId}')">${c}</button>`;

                html += `<div id="${safeId}" class="cat-section">
                         <div class="cat-title">${c}</div>
                         <div class="products-carousel">`;
                
                cats[c].forEach(p => {
                    const q = CART[p.id] || 0;
                    const semEstoque = p.stock <= 0;
                    const activeClass = q > 0 ? 'active' : (semEstoque ? 'esgotado' : '');
                    const imgSrc = p.img || ph;
                    
                    let btnHtml = "";
                    if (semEstoque && q === 0) {
                        btnHtml = `<button class="btn-esgotado">ESGOTADO</button>`;
                    } else if (q > 0) {
                        btnHtml = `<div class="qty-control"><button class="btn-q" onclick="upd('${p.id}', -1)">-</button><span class="val-q" id="qty-${p.id}">${q}</span><button class="btn-q" onclick="upd('${p.id}', 1)">+</button></div>`;
                    } else {
                        btnHtml = `<button class="btn-add-simple" onclick="upd('${p.id}', 1)">ADICIONAR</button>`;
                    }

                    html += `
                    <div class="prod-card ${activeClass} prod-search-item" id="card-${p.id}" data-name="${p.name.toLowerCase()}">
                        <div class="prod-img-box"><img src="${imgSrc}" class="prod-img" loading="lazy" onclick="zoom('${imgSrc}')"></div>
                        <div class="prod-price">${fmt(p.price)}</div>
                        <div class="prod-name">${p.name}</div>
                        <div class="action-area" id="act-${p.id}">${btnHtml}</div>
                    </div>`;
                });
                html += `</div></div>`; 
            });
            div.innerHTML = html;
        }

        function doSearch(term) {
            const t = term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const items = document.querySelectorAll('.prod-search-item');
            
            items.forEach(el => {
                const name = el.getAttribute('data-name').normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                if (name.includes(t)) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });

            document.querySelectorAll('.cat-section').forEach(sec => {
                const visibleItems = sec.querySelectorAll('.prod-search-item:not(.hidden)');
                sec.style.display = visibleItems.length > 0 ? 'block' : 'none';
            });
        }

        function scrollToCat(id) {
            const el = document.getElementById(id);
            if(el) {
                const y = el.getBoundingClientRect().top + window.pageYOffset - 150; 
                window.scrollTo({top: y, behavior: 'smooth'});
            }
        }

        function upd(id, d) {
            const prod = DB_PROD.find(x => x.id === id);
            
            if (prod && prod.stock <= 0 && d > 0) {
                 triggerShake(id);
                 showToast("Produto esgotado.");
                 return;
            }

            if(navigator.vibrate) navigator.vibrate(10);
            
            if(!CART[id]) CART[id] = 0;
            const nq = CART[id] + d;
            
            if (d < 0 && ORIG_COUNTS[id]) {
                let currOrig = 0;
                for(let k in CART) if(ORIG_COUNTS[k]) currOrig += Math.min(k===id ? nq : CART[k], ORIG_COUNTS[k]);
                const minAllowed = Math.ceil(ORIG_TOTAL * (1 - CONFIG.maxRemoval));
                if (currOrig < minAllowed) { 
                    triggerShake(id);
                    showToast(`M√≠nimo de itens originais atingido.`); 
                    return; 
                }
            }
            if(nq < 0) return;
            CART[id] = nq;
            
            saveState();
            renderCatalog(); 
            updateTotals();

            triggerPop(id);
            triggerPulseBar();
            
            const searchVal = document.getElementById('search-input').value;
            if(searchVal) doSearch(searchVal);
        }

        function triggerShake(id) {
            const card = document.getElementById(`card-${id}`);
            if(card) {
                card.classList.remove('anim-shake');
                void card.offsetWidth; 
                card.classList.add('anim-shake');
                if(navigator.vibrate) navigator.vibrate([50, 50, 50]);
            }
        }

        function triggerPop(id) {
            const qtySpan = document.getElementById(`qty-${id}`);
            if(qtySpan) {
                qtySpan.classList.add('anim-pop');
            }
        }

        function triggerPulseBar() {
            const bar = document.getElementById('cart-bar');
            bar.classList.remove('anim-pulse');
            void bar.offsetWidth; 
            bar.classList.add('anim-pulse');
        }

        function updateTotals() {
            let u=0, o=0;
            for(let k in CART) u += (DB_PROD.find(x=>x.id===k)?.price||0) * CART[k];
            for(let k in ORIG_COUNTS) o += (DB_PROD.find(x=>x.id===k)?.price||0) * ORIG_COUNTS[k];
            const total = CURR_CESTA.preco + (u - o);
            window.finalTotal = total;
            document.getElementById('total-display').innerText = fmt(total);
            
            const btn = document.getElementById('btn-finish');
            if(total < CURR_CESTA.preco) {
                btn.style.background = "#555";
                btn.innerText = `M√çNIMO: ${fmt(CURR_CESTA.preco)}`;
                btn.disabled = true;
            } else {
                btn.style.background = "var(--cor-primary)";
                btn.innerText = "CONCLUIR PEDIDO";
                btn.disabled = false;
            }
        }

        function details(id) {
            window.viewId = id;
            const c = DB_CESTAS.find(x => x.id === id);
            trackEvent('ViewContent', { content_type: 'product', content_ids: [id], content_name: c.nome, value: c.preco, currency: 'BRL' });
            const d = document.getElementById('detail-list'); d.innerHTML = "";
            c.produtos.forEach(s => {
                const parts = s.split('x ');
                if(parts.length >= 2) {
                    const q = parts[0];
                    const pid = parts[1].trim();
                    const p = DB_PROD.find(x => x.id === pid);
                    const displayName = p ? p.name : `Produto C√≥digo ${pid}`;
                    d.innerHTML += `<div class="clean-item"><span class="clean-qty">${q}</span><span class="clean-name">${displayName}</span></div>`;
                }
            });
            document.getElementById('modal-details').showModal();
        }

        function openCheckout() {
            const list = document.getElementById('checkout-list'); 
            list.innerHTML = "";
            let items = [];
            for(let k in CART) {
                if(CART[k] > 0) {
                    const p = DB_PROD.find(x => x.id === k);
                    items.push(k);
                    list.innerHTML += `<div class="clean-item"><span class="clean-qty">${CART[k]}</span><span class="clean-name">${p.name}</span></div>`;
                }
            }
            document.getElementById('checkout-total').innerText = fmt(window.finalTotal);
            trackEvent('InitiateCheckout', { value: window.finalTotal, currency: 'BRL', content_ids: items, num_items: items.length });
            document.getElementById('modal-checkout').showModal();
        }

        async function sendWhatsapp(e) {
            e.preventDefault();
            
            const n = document.getElementById('cust-name').value;
            const cpf = document.getElementById('cust-cpf').value;
            const phone = document.getElementById('cust-phone').value; 
            const a = document.getElementById('cust-addr').value;
            const p = document.getElementById('cust-pay').value;
            
            let somaProdutos = 0;
            const itensMake = [];
            const itemsKeys = Object.keys(CART).filter(k=>CART[k]>0);

            for(let k in CART) {
                if(CART[k] > 0) {
                    const produto = DB_PROD.find(x => x.id === k);
                    somaProdutos += (produto.price * CART[k]);

                    itensMake.push({
                        "id": k,
                        "nome": produto.name,
                        "quantidade": CART[k],
                        "preco_unitario": produto.price
                    });
                }
            }

            let diferenca = window.finalTotal - somaProdutos;
            diferenca = parseFloat(diferenca.toFixed(2));

            let mensagemZap = `*PEDIDO: ${CURR_CESTA.nome}*\nüë§ ${n}\nüìÑ CPF: ${cpf}\nüì± ${phone}\nüìç ${a}\nüí∞ ${p}\n\n*ITENS:* \n`;
            
            for(let k in CART) {
                if(CART[k] > 0) {
                    const produto = DB_PROD.find(x => x.id === k);
                    mensagemZap += `${CART[k]}x ${produto.name}\n`;
                }
            }
            mensagemZap += `\n*TOTAL FINAL: ${fmt(window.finalTotal)}*`;

            trackEvent('Purchase', { value: window.finalTotal, currency: 'BRL', content_ids: itemsKeys, num_items: itemsKeys.reduce((acc,c)=>acc+CART[c],0) });

            localStorage.removeItem('da_cesta_id');
            localStorage.removeItem('da_cart');
            localStorage.removeItem('da_orig');

            try {
                fetch(MAKE_WEBHOOK, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        "cliente": { 
                            "nome": n, 
                            "cpf": cpf,
                            "celular": phone, 
                            "endereco": a 
                        },
                        "pedido": {
                            "itens": itensMake,
                            "total_site": window.finalTotal,
                            "soma_produtos": somaProdutos,
                            "diferenca_ajuste": diferenca,
                            "forma_pagamento": p,
                            "cesta_origem": CURR_CESTA.nome
                        }
                    })
                });
            } catch (erro) { console.error(erro); }

            setTimeout(() => { 
                window.location.href = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(mensagemZap)}`; 
            }, 500); 
        }

        function orderDirect() {
            const c = DB_CESTAS.find(x => x.id === window.viewId);
            window.location.href = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent("Gostaria de pedir a " + c.nome + " por " + fmt(c.preco))}`;
        }

        function trackEvent(name, data) { if(typeof fbq === 'function') fbq('track', name, data); }
        function fmt(v) { return v.toLocaleString('pt-BR', {style:'currency', currency:'BRL'}); }
        function showToast(m) { const t=document.getElementById('status-toast'); t.innerText=m; t.style.display='block'; setTimeout(()=>t.style.display='none',3000); }
        function svgPlace() { return "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBmaWxsPSIjRTI1QzZDIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIvPjwvc3ZnPg=="; }
        function zoom(src) { document.getElementById('zoom-img').src = src; document.getElementById('zoom-modal').showModal(); }

        // --- FUN√á√ïES DE M√ÅSCARA ---
        function mascaraTelefone(o) {
            let v = o.value.replace(/\D/g, "");
            v = v.replace(/^(\d{2})(\d)/g, "($1) $2");
            v = v.replace(/(\d)(\d{4})$/, "$1-$2");
            o.value = v.substring(0, 15);
        }

        function mascaraCPF(o) {
            let v = o.value.replace(/\D/g, "");
            v = v.replace(/(\d{3})(\d)/, "$1.$2");
            v = v.replace(/(\d{3})(\d)/, "$1.$2");
            v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
            o.value = v.substring(0, 14);
        }

        (function(){
            document.addEventListener('contextmenu', e => e.preventDefault());
            document.onkeydown = e => { if(e.keyCode==123 || (e.ctrlKey && e.keyCode==85)) return false; };
            console.log('%c Dona Antonia ', 'background: #E63946; color: #fff; font-size: 20px;');
        })();

        init();
    </script>
</body>
</html>
