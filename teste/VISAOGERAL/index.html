<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visão Geral - Sistema Logística v8.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #f1f1f1; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .nav-item.active { background-color: #334155; border-right: 4px solid #34d399; }
    </style>
    <script type="importmap">
    { "imports": { "react": "https://esm.sh/react@18.2.0", "react-dom/client": "https://esm.sh/react-dom@18.2.0/client", "lucide-react": "https://esm.sh/lucide-react@0.263.1", "zod": "https://esm.sh/zod@3.22.4" } }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans h-full">
    <div id="root" class="h-full"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { LayoutDashboard, ShoppingCart, Package, Truck, Database, LineChart, HeartHandshake, Menu, X, DollarSign, Clock, AlertTriangle, Users, Trash2, ClipboardList, Download, Upload, XCircle } from 'lucide-react';

        // --- UTILS & HOOKS (CORE) ---
        const useStickyState = (key, defaultValue) => {
          const [value, setValue] = useState(() => {
            const stickyValue = window.localStorage.getItem(key);
            return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
          });
          useEffect(() => { window.localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
          return [value, setValue];
        };
        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);

        // --- COMPONENTS ---
        const MetricCard = ({ title, value, icon, color, sub }) => (
            <div className={`bg-white p-5 rounded-xl shadow-sm border border-${color}-100 relative overflow-hidden group`}><div className={`absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity transform group-hover:scale-110`}>{icon}</div><div className="relative z-10"><p className="text-gray-500 text-sm font-medium uppercase tracking-wider mb-1">{title}</p><h3 className="text-2xl font-bold text-gray-800 mb-1">{value}</h3><p className={`text-xs text-${color}-600 font-bold`}>{sub}</p></div></div>
        );

        const NavItem = ({ icon, label, href, active }) => (
            <a href={href} className={`w-full flex items-center justify-start gap-3 p-3 lg:px-6 transition-all duration-200 nav-item ${active ? 'active text-white bg-slate-800' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`} title={label}>{icon}<span className="font-medium text-sm">{label}</span></a>
        );

        // --- DASHBOARD VIEW ---
        function DashboardView({ sales, products, clients, onClearDaily }) {
            const today = new Date().toISOString().slice(0, 10);
            const salesToday = sales.filter(s => s.date.startsWith(today) && s.status !== 'Cancelado');
            const totalToday = salesToday.reduce((acc, s) => acc + s.total, 0);
            const pendingOrders = sales.filter(s => s.status === 'Pendente').length;
            const lowStock = products.filter(p => !p.isCombo && p.stock <= 5).length;
            
            return (
                <div className="p-4 lg:p-6 pb-20 flex flex-col h-full">
                    <div className="flex-1">
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8">
                            <MetricCard title="Vendas Hoje" value={formatCurrency(totalToday)} icon={<DollarSign size={24} className="text-green-600"/>} color="green" sub={`${salesToday.length} pedidos`} />
                            <MetricCard title="Pedidos Pendentes" value={pendingOrders} icon={<Clock size={24} className="text-orange-600"/>} color="orange" sub="Aguardando montagem" />
                            <MetricCard title="Estoque Baixo" value={lowStock} icon={<AlertTriangle size={24} className="text-red-600"/>} color="red" sub="Produtos críticos" />
                            <MetricCard title="Total Clientes" value={clients.length} icon={<Users size={24} className="text-blue-600"/>} color="blue" sub="Base ativa" />
                        </div>
                    </div>
                    <div className="mt-8 border-t pt-4">
                        <button onClick={onClearDaily} className="bg-red-100 hover:bg-red-200 text-red-700 font-bold py-3 px-6 rounded-lg flex items-center gap-2 transition text-sm">
                            <Trash2 size={18}/> ZERAR VENDAS DO DIA (ADMIN)
                        </button>
                        <p className="text-xs text-gray-400 mt-1 ml-1">Requer senha administrativa.</p>
                    </div>
                </div>
            );
        }

        // --- APP SHELL (NAVIGATION & LAYOUT) ---
        function App() {
          // Shared State Connections
          const [clients] = useStickyState('db_clients_v3', []);
          const [products] = useStickyState('db_products_v3', []);
          const [sales, setSales] = useStickyState('db_sales_v3', []);
          const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

          const clearDailySales = () => {
              const pwd = prompt("SENHA DE ADMINISTRADOR:");
              if (pwd !== '12345') return alert("Senha incorreta.");
              if (!confirm("⚠️ ATENÇÃO ⚠️\n\nIsso apagará TODAS as vendas com a data de HOJE.\nEsta ação é irreversível.\n\nContinuar?")) return;
              const today = new Date().toISOString().slice(0, 10);
              const newSales = sales.filter(s => !s.date.startsWith(today));
              setSales(newSales);
              alert("Vendas de hoje removidas.");
          };

          return (
            <div className="flex flex-col lg:flex-row h-screen bg-gray-100 font-sans text-gray-800 overflow-hidden">
                {/* MOBILE HEADER */}
                <div className="lg:hidden bg-slate-900 text-white p-4 flex justify-between items-center shrink-0 z-50 shadow-md">
                    <div className="flex items-center gap-2"><div className="bg-yellow-500 text-slate-900 p-1 rounded font-bold text-xs">LOG</div><h1 className="font-bold tracking-wider">SISTEMA v8.0</h1></div>
                    <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="p-2 bg-slate-800 rounded">{mobileMenuOpen ? <X size={20}/> : <Menu size={20}/>}</button>
                </div>

                {/* SIDEBAR NAVIGATION */}
                <aside className={`fixed inset-y-0 left-0 bg-slate-900 text-white flex flex-col transition-transform duration-300 z-40 w-64 lg:static lg:translate-x-0 ${mobileMenuOpen ? 'translate-x-0 shadow-2xl' : '-translate-x-full'}`}>
                    <div className="h-16 hidden lg:flex items-center justify-center lg:justify-start lg:px-6 border-b border-slate-800">
                        <div className="bg-yellow-500 text-slate-900 p-1.5 rounded font-bold mr-2">LOG</div>
                        <h1 className="font-bold tracking-wider hidden lg:block text-lg">SISTEMA <span className="text-emerald-400 text-xs font-normal border border-emerald-500 rounded px-1 ml-1">V8.0</span></h1>
                    </div>
                    <nav className="flex-1 py-4 space-y-1 overflow-y-auto mt-16 lg:mt-0">
                        <NavItem icon={<LayoutDashboard size={20}/>} label="Visão Geral" href="index.html" active={true} />
                        <NavItem icon={<ShoppingCart size={20}/>} label="Caixa (PDV)" href="pos.html" />
                        <NavItem icon={<Package size={20}/>} label="Expedição" href="expedition.html" />
                        <NavItem icon={<Truck size={20}/>} label="Logística" href="logistics.html" />
                        <NavItem icon={<Database size={20}/>} label="Cadastros" href="registry.html" />
                        <NavItem icon={<LineChart size={20}/>} label="Inteligência (BI)" href="intelligence.html" />
                        <NavItem icon={<HeartHandshake size={20}/>} label="Pós-Venda" href="postsale.html" />
                    </nav>
                </aside>
                
                {/* MAIN CONTENT */}
                <main className="flex-1 flex flex-col min-w-0 bg-gray-50 h-full overflow-hidden relative">
                    <header className="h-16 bg-white border-b hidden lg:flex items-center justify-between px-6 shrink-0 shadow-sm z-20">
                        <div><h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">Visão Geral</h2></div>
                        <div className="w-8 h-8 bg-slate-200 rounded-full flex items-center justify-center text-slate-600 font-bold">OP</div>
                    </header>
                    <div className="flex-1 overflow-y-auto overflow-x-hidden relative bg-gray-50">
                        <DashboardView sales={sales} products={products} clients={clients} onClearDaily={clearDailySales} />
                    </div>
                </main>
                {mobileMenuOpen && <div className="fixed inset-0 bg-black/50 z-30 lg:hidden" onClick={() => setMobileMenuOpen(false)}></div>}
            </div>
          );
        }
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
