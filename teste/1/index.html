<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo Clientes (Micro-frontend)</title>
    
    <!-- 1. TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#151e2e' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <!-- 2. GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- 3. ESTILOS GLOBAIS -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        /* Scrollbar Moderna */
        .scrollbar-thin::-webkit-scrollbar { width: 5px; height: 5px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Inputs */
        .input-label {
            display: block;
            font-size: 0.70rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 0.25rem;
        }
        
        .input-field {
            width: 100%;
            padding: 0.5rem 0.75rem; 
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            color: #1e293b;
            outline: none;
            transition: all 0.2s;
        }
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        .input-field:disabled {
            background-color: #f8fafc;
            color: #94a3b8;
            cursor: not-allowed;
        }

        /* Botões */
        .btn-primary {
            background-color: #0f172a;
            color: white;
            padding: 0.6rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn-primary:hover { background-color: #334155; }
        
        .btn-secondary {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            color: #475569;
            padding: 0.6rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn-secondary:hover { background-color: #f8fafc; border-color: #cbd5e1; }
    </style>

    <!-- 4. IMPORTMAP -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "zod": "https://esm.sh/zod@3.22.4"
      }
    }
    </script>
    
    <!-- 5. BABEL -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50 h-screen overflow-hidden text-slate-800">
    
    <div id="root" class="h-full"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { z } from 'zod';
        import { 
          Users, Search, Plus, Save, Trash2, 
          Phone, MapPin, MessageCircle, FileText, 
          ChevronRight
        } from 'lucide-react';

        // --- 1. CORE & UTILS ---
        
        const generateId = () => Math.random().toString(36).substr(2, 9);
        
        const generateClientCode = (existingClients) => {
           let code;
           let attempts = 0;
           do {
             code = Math.floor(1000 + Math.random() * 9000).toString();
             attempts++;
             if(attempts > 1000) break; 
           } while (existingClients.some(c => c.code === code));
           return code;
        };

        const useStickyState = (key, defaultValue) => {
          const [value, setValue] = useState(() => {
            const stickyValue = window.localStorage.getItem(key);
            return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
          });
          useEffect(() => {
            window.localStorage.setItem(key, JSON.stringify(value));
          }, [key, value]);
          return [value, setValue];
        };

        // --- 2. MÓDULO DE CLIENTES (Core View) ---
        
        function ClientsModule({ clients, setClients }) {
            const [cForm, setCForm] = useState({ 
                name: '', code: '', phone: '', phone2: '', 
                address: '', city: 'CUIABÁ', district: '', region: 'CUIABÁ', 
                mapLink: '', obs: '' 
            });
            const [editingClientId, setEditingClientId] = useState(null);
            const [search, setSearch] = useState('');

            // Lógica de Persistência
            const saveClient = () => { 
                if (!cForm.name) return alert('O campo Nome é obrigatório.'); 
                
                if (editingClientId) { 
                    setClients(clients.map(c => c.id === editingClientId ? { ...cForm, id: editingClientId, code: c.code || cForm.code } : c)); 
                    alert('Registro atualizado.'); 
                } else { 
                    const newCode = generateClientCode(clients); 
                    setClients([...clients, { ...cForm, id: generateId(), code: newCode }]); 
                    setEditingClientId(null);
                    setCForm(prev => ({...prev, name: '', phone: '', code: ''})); 
                    alert(`Cliente cadastrado: ${newCode}`); 
                } 
                startNew();
            };

            const deleteItem = () => {
                if(!editingClientId) return;
                if(!confirm("Esta ação é irreversível. Deseja excluir?")) return;
                setClients(clients.filter(c => c.id !== editingClientId));
                startNew();
            };

            const startNew = () => {
                setCForm({ name: '', code: '', phone: '', phone2: '', address: '', city: 'CUIABÁ', district: '', region: 'CUIABÁ', mapLink: '', obs: '' }); 
                setEditingClientId(null);
            };

            const list = useMemo(() => {
                return clients.filter(c => 
                    c.name.toLowerCase().includes(search.toLowerCase()) || 
                    (c.code && c.code.includes(search)) || 
                    (c.phone && c.phone.includes(search))
                ).sort((a,b) => a.name.localeCompare(b.name));
            }, [clients, search]);

            return (
                <div className="flex h-full bg-slate-100 overflow-hidden">
                    
                    {/* COLUNA ESQUERDA: LISTAGEM (MASTER) */}
                    <aside className="w-full md:w-[350px] lg:w-[400px] flex flex-col bg-white border-r border-slate-200 shrink-0 z-10">
                        {/* Header da Lista */}
                        <div className="p-4 border-b border-slate-100 bg-white">
                            <div className="flex justify-between items-center mb-3">
                                <h2 className="text-sm font-bold text-slate-700 uppercase tracking-wide flex items-center gap-2">
                                    <Users size={16} className="text-emerald-600"/>
                                    Base de Clientes
                                </h2>
                                <span className="text-xs bg-slate-100 text-slate-500 px-2 py-0.5 rounded-full font-bold">{clients.length}</span>
                            </div>
                            <div className="relative">
                                <Search className="absolute left-3 top-2.5 text-slate-400" size={16}/>
                                <input 
                                    className="w-full pl-9 pr-4 py-2 bg-slate-50 border border-slate-200 rounded text-sm focus:bg-white focus:border-emerald-500 outline-none transition" 
                                    placeholder="Buscar (Nome, Tel, Cód)..." 
                                    value={search} 
                                    onChange={e => setSearch(e.target.value)} 
                                />
                            </div>
                        </div>

                        {/* Lista Scrollável */}
                        <div className="flex-1 overflow-y-auto scrollbar-thin">
                            {list.length === 0 ? (
                                <div className="p-8 text-center text-slate-400 text-sm">
                                    Nenhum registro encontrado.
                                </div>
                            ) : (
                                <div className="divide-y divide-slate-50">
                                    {list.map(c => {
                                        const isActive = editingClientId === c.id;
                                        return (
                                            <div 
                                                key={c.id} 
                                                onClick={() => { setCForm(c); setEditingClientId(c.id); }}
                                                className={`p-4 cursor-pointer transition-all hover:bg-slate-50 relative group ${isActive ? 'bg-emerald-50/50' : ''}`}
                                            >
                                                {isActive && <div className="absolute left-0 top-0 bottom-0 w-1 bg-emerald-500"></div>}
                                                <div className="flex justify-between items-start mb-1">
                                                    <span className={`font-semibold text-sm ${isActive ? 'text-emerald-900' : 'text-slate-700'}`}>{c.name}</span>
                                                    {c.code && <span className="text-[10px] font-mono bg-slate-100 text-slate-500 px-1.5 rounded">{c.code}</span>}
                                                </div>
                                                <div className="flex items-center gap-3 text-xs text-slate-500">
                                                    {c.phone && <span className="flex items-center gap-1"><Phone size={10}/> {c.phone}</span>}
                                                    {c.district && <span className="flex items-center gap-1"><MapPin size={10}/> {c.district}</span>}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                        
                        {/* Botão Flutuante Mobile */}
                        <div className="p-4 border-t border-slate-100 md:hidden">
                            <button onClick={startNew} className="btn-primary w-full justify-center">
                                <Plus size={16}/> Novo Cliente
                            </button>
                        </div>
                    </aside>

                    {/* COLUNA DIREITA: FORMULÁRIO (DETAIL) */}
                    <main className="flex-1 flex flex-col h-full bg-slate-50/50 overflow-hidden relative">
                        {/* Toolbar do Formulário */}
                        <div className="h-14 border-b border-slate-200 bg-white px-6 flex items-center justify-between shrink-0">
                            <div className="flex items-center gap-2">
                                <h1 className="text-lg font-bold text-slate-800">
                                    {editingClientId ? 'Editando Registro' : 'Novo Cadastro'}
                                </h1>
                                {editingClientId && <span className="text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded font-medium">EM EDIÇÃO</span>}
                            </div>
                            <div className="flex gap-2">
                                {editingClientId && (
                                    <button onClick={deleteItem} className="text-red-600 hover:bg-red-50 p-2 rounded transition" title="Excluir">
                                        <Trash2 size={18}/>
                                    </button>
                                )}
                                <button onClick={startNew} className="btn-secondary text-xs">
                                    <Plus size={14}/>
                                    <span className="hidden sm:inline">Limpar / Novo</span>
                                </button>
                                <button onClick={saveClient} className="btn-primary shadow-sm hover:shadow-md">
                                    <Save size={16}/>
                                    <span className="hidden sm:inline">Salvar Alterações</span>
                                    <span className="sm:hidden">Salvar</span>
                                </button>
                            </div>
                        </div>

                        {/* Área do Formulário Scrollável */}
                        <div className="flex-1 overflow-y-auto p-4 md:p-8 scrollbar-thin">
                            <div className="max-w-4xl mx-auto bg-white rounded-lg shadow-sm border border-slate-200 p-6 md:p-8">
                                
                                <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
                                    
                                    {/* Seção 1: Identificação */}
                                    <div className="md:col-span-12">
                                        <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 border-b pb-2">Dados Principais</h3>
                                    </div>

                                    <div className="md:col-span-8">
                                        <label className="input-label">Nome Completo</label>
                                        <input 
                                            className="input-field font-medium text-lg" 
                                            value={cForm.name} 
                                            onChange={e => setCForm({...cForm, name: e.target.value})} 
                                            placeholder="Nome do Cliente ou Empresa" 
                                            autoFocus
                                        />
                                    </div>
                                    <div className="md:col-span-4">
                                        <label className="input-label">Código (Auto)</label>
                                        <input className="input-field bg-slate-50 text-slate-500 font-mono text-center" value={cForm.code} placeholder="Gerado ao salvar" disabled />
                                    </div>

                                    <div className="md:col-span-6">
                                        <label className="input-label flex items-center gap-1"><MessageCircle size={12} className="text-green-500"/> Celular (WhatsApp)</label>
                                        <div className="flex gap-2">
                                            <input className="input-field" value={cForm.phone} onChange={e => setCForm({...cForm, phone: e.target.value})} placeholder="(00) 00000-0000" />
                                            {cForm.phone && (
                                                <button onClick={() => window.open(`https://wa.me/55${cForm.phone?.replace(/\D/g, '')}`, '_blank')} className="px-3 bg-green-50 border border-green-200 text-green-600 rounded hover:bg-green-100 transition">
                                                    <ChevronRight size={16}/>
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    <div className="md:col-span-6">
                                        <label className="input-label">Telefone Secundário</label>
                                        <input className="input-field" value={cForm.phone2} onChange={e => setCForm({...cForm, phone2: e.target.value})} placeholder="Fixo ou Recado" />
                                    </div>

                                    {/* Seção 2: Localização */}
                                    <div className="md:col-span-12 mt-4">
                                        <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 border-b pb-2">Endereço & Logística</h3>
                                    </div>

                                    <div className="md:col-span-3">
                                        <label className="input-label">Cidade</label>
                                        <input className="input-field" value={cForm.city} onChange={e => setCForm({...cForm, city: e.target.value})} />
                                    </div>
                                    <div className="md:col-span-4">
                                        <label className="input-label">Bairro</label>
                                        <input className="input-field" value={cForm.district} onChange={e => setCForm({...cForm, district: e.target.value})} />
                                    </div>
                                    <div className="md:col-span-5">
                                        <label className="input-label">Região / Rota</label>
                                        <select className="input-field cursor-pointer" value={cForm.region} onChange={e => setCForm({...cForm, region: e.target.value})}>
                                            <option value="CUIABÁ">CUIABÁ (CENTRO)</option>
                                            <option value="COXIPO">COXIPÓ</option>
                                            <option value="VARZEA GRANDE">VÁRZEA GRANDE</option>
                                            <option value="CPA">CPA / MORADA DO OURO</option>
                                            <option value="OUTRA">OUTRA</option>
                                        </select>
                                    </div>

                                    <div className="md:col-span-8">
                                        <label className="input-label">Endereço Completo</label>
                                        <input className="input-field" value={cForm.address} onChange={e => setCForm({...cForm, address: e.target.value})} placeholder="Rua, Número, Complemento" />
                                    </div>
                                    <div className="md:col-span-4">
                                        <label className="input-label flex items-center gap-1"><MapPin size={12} /> Link Maps</label>
                                        <input className="input-field" value={cForm.mapLink} onChange={e => setCForm({...cForm, mapLink: e.target.value})} placeholder="Cole o link aqui" />
                                    </div>

                                    {/* Seção 3: Obs */}
                                    <div className="md:col-span-12 mt-4">
                                        <label className="input-label">Observações Internas</label>
                                        <textarea 
                                            className="input-field h-32 resize-none leading-relaxed" 
                                            value={cForm.obs} 
                                            onChange={e => setCForm({...cForm, obs: e.target.value})} 
                                            placeholder="Detalhes sobre entrega, preferências do cliente ou histórico breve..." 
                                        />
                                    </div>

                                </div>
                            </div>
                            <div className="h-10"></div> {/* Spacer bottom */}
                        </div>
                    </main>
                </div>
            );
        }

        // --- 3. APP PRINCIPAL ---
        function App() {
          const [clients, setClients] = useStickyState('db_clients_v3', []);
          
          return (
            <div className="h-screen bg-slate-100 font-sans text-slate-800 overflow-hidden">
                <ClientsModule clients={clients} setClients={setClients} />
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
