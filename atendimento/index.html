<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cesta Econ√¥mica | Fale com o Osvaldo</title>
    <meta name="theme-color" content="#008069">

    <!-- PILLAR 1: SEO & PERFORMANCE -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- PILLAR 3: SECURITY HEADERS -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' https: data:;">
    <meta http-equiv="X-Frame-Options" content="DENY">

    <style>
        /* WhatsApp Specific Styles */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #E5DDD5; }
        
        .wa-header { background-color: #008069; }
        .wa-bg { 
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
            background-repeat: repeat;
            opacity: 0.9;
        }
        
        .msg-in { background-color: #FFFFFF; border-radius: 0 8px 8px 8px; box-shadow: 0 1px 0.5px rgba(0,0,0,0.13); }
        .msg-out { background-color: #E7FFDB; border-radius: 8px 0 8px 8px; box-shadow: 0 1px 0.5px rgba(0,0,0,0.13); }
        
        /* Bot√µes Estilo Menu WhatsApp */
        .msg-options { background-color: transparent; padding: 0; box-shadow: none; display: flex; flex-direction: column; gap: 8px; align-items: flex-start; width: 85%; }
        .wa-btn {
            background-color: white;
            color: #008069;
            font-weight: 600;
            padding: 12px 16px;
            border-radius: 8px;
            width: 100%;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
            transition: all 0.2s;
            border: 1px solid #f0f0f0;
            cursor: pointer;
            font-size: 15px;
        }
        .wa-btn:active { background-color: #f0f2f5; transform: scale(0.98); }

        /* Animation for typing */
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .protected-img, .protected-msg {
            user-select: none;
            -webkit-user-select: none;
        }

        /* === ESTILOS DOS CARDS (Importados do Site) === */
        :root {
            --cor-destaque-dourado: #ffb300;
            --cor-texto-destaque: #0F2546;
            --cor-texto: #333;
            --cor-borda: #e0e0e0;
            --cor-whatsapp: #25D366;
            --cor-destaque-vermelho: #ff5252;
        }

        .card-msg-container {
            width: 100%;
            max-width: 320px; /* Limita largura dentro do chat */
        }

        .card-cesta-new {
            background: #fff;
            border-radius: 12px;
            margin-bottom: 5px;
            border: 1px solid var(--cor-borda);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card-header-visual {
            display: flex;
            position: relative;
            background: #fff;
            min-height: 100px;
        }
        .card-img-side {
            width: 120px;
            min-width: 120px;
            height: 120px;
            object-fit: cover;
        }
        .card-title-side {
            flex-grow: 1;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .card-title-side h2 {
            font-size: 1.1rem;
            margin: 0;
            color: var(--cor-texto-destaque);
            font-weight: 800;
            text-transform: uppercase;
        }

        .selo-destaque {
            position: absolute;
            top: 5px; left: 5px;
            background: linear-gradient(135deg, var(--cor-destaque-dourado), #FFB300);
            color: #0F2546;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 800;
            font-size: 0.65rem;
            text-transform: uppercase;
            z-index: 10;
        }

        .card-control-row {
            display: flex;
            border-top: 1px solid var(--cor-borda);
        }
        .btn-card-toggle {
            flex: 1;
            background: #f9f9f9;
            border: none;
            border-right: 1px solid var(--cor-borda);
            color: #555;
            padding: 12px 5px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .btn-card-toggle:last-child { border-right: none; }
        .btn-card-toggle.active { background: #e3f2fd; color: #1976D2; }
        .btn-card-toggle.active-valor { background: #e8f5e9; color: #388E3C; }

        .card-expand-section {
            display: none;
            padding: 15px;
            background: #fafafa;
            border-top: 1px solid var(--cor-borda);
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .lista-itens-card { list-style: none; padding: 0; margin: 0; text-align: left; }
        .lista-itens-card li {
            padding: 6px 0;
            border-bottom: 1px dashed #ccc;
            font-size: 0.85rem;
            color: #555;
            display: flex; align-items: flex-start;
        }
        .lista-itens-card li i { color: #4CAF50; margin-right: 8px; margin-top: 3px; }
        .lista-itens-card li.grupo-titulo {
            color: var(--cor-destaque-dourado); /* Usando vari√°vel do site */
            color: #e65100; /* Fallback visivel */
            font-weight: 700;
            border-bottom: none;
            padding-top: 12px;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .radio-arroz-option {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px;
            border: 1px solid #ddd; border-radius: 6px;
            margin-bottom: 8px; cursor: pointer; background: white;
        }
        .radio-arroz-option.selected { border-color: var(--cor-whatsapp); background: #f0fff4; }
        .radio-arroz-info { display: flex; flex-direction: column; text-align: left;}
        .radio-arroz-name { font-weight: 600; font-size: 0.9rem; color: #333; }
        .radio-arroz-price { color: var(--cor-destaque-vermelho); font-weight: 800; font-size: 1rem; }
        
        .btn-encomendar-card {
            width: 100%; background-color: var(--cor-whatsapp); color: white;
            border: none; padding: 12px; border-radius: 6px;
            font-size: 1rem; font-weight: 800; text-transform: uppercase;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            margin-top: 10px;
        }
    </style>
</head>
<body class="h-[100dvh] flex flex-col overflow-hidden" oncontextmenu="return false;">

    <!-- HEADER -->
    <header class="wa-header text-white p-3 flex items-center shadow-md z-30 shrink-0">
        <div class="mr-2">
            <i class="ph ph-arrow-left text-xl cursor-pointer"></i>
        </div>
        <div class="w-10 h-10 rounded-full bg-gray-300 overflow-hidden mr-3 border border-white/30 relative shrink-0">
            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Osvaldo&backgroundColor=c0aede" alt="Osvaldo" class="w-full h-full object-cover protected-img">
            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-white"></div>
        </div>
        <div class="flex-1 min-w-0">
            <h1 class="font-bold text-lg leading-tight truncate">Osvaldo - Cestas</h1>
            <p id="status-text" class="text-xs text-green-100/80 truncate">Online</p>
        </div>
        <div class="flex gap-4 text-xl shrink-0">
            <i class="ph ph-video-camera cursor-pointer"></i>
            <i class="ph ph-phone cursor-pointer"></i>
            <i class="ph ph-dots-three-vertical cursor-pointer"></i>
        </div>
    </header>

    <!-- CHAT AREA -->
    <main id="chat-container" class="wa-bg flex-1 overflow-y-auto p-4 space-y-3 relative scrolling-touch">
        <div class="flex justify-center mb-6 protected-msg">
            <div class="bg-[#FFF5C4] text-gray-800 text-[10px] py-1 px-3 rounded-lg shadow-sm text-center max-w-[80%]">
                <i class="ph-fill ph-lock-key inline-block mr-1"></i> As mensagens s√£o protegidas com criptografia de ponta-a-ponta.
            </div>
        </div>
        <!-- Messages area -->
    </main>

    <!-- INPUT AREA -->
    <footer class="bg-[#F0F2F5] p-2 flex items-center gap-2 shrink-0 z-30 pb-safe">
        <div class="bg-white rounded-full p-2 text-gray-500 text-xl cursor-pointer">
            <i class="ph ph-smiley"></i>
        </div>
        
        <div class="flex-1 bg-white rounded-full px-4 py-2 shadow-sm flex items-center">
            <input type="text" id="user-input" placeholder="Digite seu nome..." class="w-full outline-none text-base bg-transparent text-gray-800" autocomplete="off">
        </div>

        <div id="send-btn" class="bg-[#008069] text-white rounded-full p-3 shadow-md cursor-pointer transition active:scale-95 flex items-center justify-center">
            <i class="ph-fill ph-paper-plane-right text-xl"></i>
        </div>
    </footer>

    <script>
        const CONFIG = {
            ownerName: "Osvaldo",
            whatsAppGroupLink: "https://chat.whatsapp.com/IOI3gSBLRVk4jGK2QMunp1",
            whatsAppNumber: "5565998150975"
        };

        if (window.self !== window.top) window.top.location.href = window.self.location.href;

        // --- DADOS DAS CESTAS (Para gerar os cards) ---
        const CESTAS = [
            {
                id: 'grande',
                nome: 'Cesta Grande',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-grande.avif',
                items: [
                    '4 Arroz de 5kg', '3 A√ß√∫car Cristal de 2kg', '4 √ìleo de Soja 900ml', 
                    '4 Feij√£o 1kg', '1 Caf√© 500g', '3 Espaguetes 500g', '12 Ovos',
                    '1 Mistura Bolo', '1 Trigo 1kg', '1 Sal 1kg', '2 Molho Tomate',
                    '1 Milho', '1 Tempero', '2 Bolacha Recheada', '2 Miojo', '4 Suco P√≥',
                    'Kit Limpeza Completo (Sab√£o, Creme Dental, Papel, Amaciante...)'
                ],
                opcoes: [
                    { arroz: 'Tio Alvino', preco: '380,00' },
                    { arroz: 'Koblenz', preco: '390,00' }
                ]
            },
            {
                id: 'media',
                nome: 'Cesta M√©dia',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-media.avif',
                items: [
                    '3 Arroz de 5kg', '2 A√ß√∫car Cristal', '3 √ìleo', '3 Feij√£o', 
                    '1 Caf√© 500g', '12 Ovos', '1 Mistura Bolo', '2 Espaguetes',
                    '1 Trigo', '1 Sal', '2 Molho Tomate', '1 Milho', '1 Tempero',
                    '2 Bolacha', '2 Miojo', '3 Suco', 'Kit Limpeza Completo'
                ],
                opcoes: [
                    { arroz: 'Tio Alvino', preco: '320,00' },
                    { arroz: 'Koblenz', preco: '325,00' }
                ]
            },
            {
                id: 'pequena',
                nome: 'Cesta Pequena',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-pequena.avif',
                items: [
                    '2 Arroz de 5kg', '1 A√ß√∫car 2kg', '2 √ìleo', '2 Feij√£o', 
                    '1 Caf√© 250g', '12 Ovos', '1 Mistura Bolo', '1 Espaguete',
                    '1 Trigo', '1 Sal', '1 Molho Tomate', '1 Milho', '1 Tempero',
                    '2 Bolacha', '2 Miojo', '2 Suco', 'Kit Limpeza Completo'
                ],
                opcoes: [
                    { arroz: 'Tio Alvino', preco: '215,00' },
                    { arroz: 'Koblenz', preco: '220,00' }
                ]
            },
            {
                id: 'mini',
                nome: 'Cesta Mini',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-mini.avif',
                items: [
                    '1 Arroz de 5kg', '1 A√ß√∫car 2kg', '2 √ìleo', '2 Feij√£o', 
                    '1 Caf√© 250g', '1 Espaguete', '1 Sal', '1 Molho Tomate', '1 Milho',
                    '1 Bolacha', '1 Miojo', '2 Suco', 'Kit Limpeza B√°sico'
                ],
                opcoes: [
                    { arroz: 'Tio Alvino', preco: '165,00' },
                    { arroz: 'Koblenz', preco: '170,00' }
                ]
            },
            {
                id: 'economica',
                nome: 'Cesta Econ√¥mica',
                destaque: 'Mais Vendida',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-economica.avif',
                items: [
                    '1 Arroz de 5kg', '1 A√ß√∫car 2kg', '1 √ìleo', '1 Feij√£o', 
                    '1 Caf√© 250g', '1 Espaguete', '1 Trigo', '1 Farinha Mandioca', 
                    '1 Sal', '1 Molho Tomate', '1 Milho', '1 Bolacha', '1 Miojo', '1 Suco'
                ],
                opcoes: [
                    { arroz: 'Valor √önico', preco: '85,00' }
                ]
            }
        ];

        // --- SISTEMA DE CHAT ---
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const statusText = document.getElementById('status-text');

        let state = { 
            step: 0, 
            userName: '', 
            currentCestaIndex: 0 // Come√ßa na 0 (Grande)
        };

        const getGreeting = () => {
            const h = new Date().getHours();
            return h < 12 ? "Bom dia" : h < 18 ? "Boa tarde" : "Boa noite";
        };

        const getCurrentTime = () => new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

        function scrollToBottom() {
            setTimeout(() => {
                chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
            }, 100);
        }

        // --- FUN√á√ÉO DE MENSAGEM COM DELAY HUMANO ---
        // Calcula tempo baseado no tamanho do texto (simula leitura/digita√ß√£o real)
        function calculateTypingTime(text) {
            const baseDelay = 1500; // M√≠nimo 1.5s
            const charDelay = 40;   // ms por caractere
            return Math.min(baseDelay + (text.length * charDelay), 4500); // Max 4.5s
        }

        function addMessage(text, sender = 'bot', forceDelay = null) {
            return new Promise(resolve => {
                const typingTime = forceDelay !== null ? forceDelay : calculateTypingTime(text);
                
                // Pequena pausa antes de come√ßar a digitar (pensando)
                const preTypingDelay = sender === 'bot' ? 800 : 0;

                setTimeout(() => {
                    if (sender === 'bot') {
                        statusText.innerText = 'Digitando...';
                        
                        // Scroll autom√°tico ao come√ßar a digitar
                        scrollToBottom();

                        const typingId = `typing-${Date.now()}`;
                        const typingHTML = `
                            <div id="${typingId}" class="flex justify-start w-full mb-2">
                                <div class="msg-in p-3 px-4 rounded-lg relative">
                                    <div class="flex gap-1 text-gray-400">
                                        <div class="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                                        <div class="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                                        <div class="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                                    </div>
                                </div>
                            </div>`;
                        chatContainer.insertAdjacentHTML('beforeend', typingHTML);
                        scrollToBottom();

                        setTimeout(() => {
                            const typingEl = document.getElementById(typingId);
                            if(typingEl) typingEl.remove();
                            
                            // Se for HTML (Card), remove classes de padding padr√£o
                            const isCard = text.includes('card-cesta-new');
                            const bubbleClass = isCard ? 'p-1 bg-transparent shadow-none' : 'p-2 px-3 bg-white shadow-sm';
                            
                            const html = `
                                <div class="flex justify-start w-full mb-2 fade-in">
                                    <div class="msg-in ${bubbleClass} rounded-lg relative max-w-[90%] text-gray-800 text-[15px] leading-snug protected-msg">
                                        ${text}
                                        ${!isCard ? `<span class="block text-[10px] text-gray-400 text-right mt-1 -mr-1">${getCurrentTime()}</span>` : ''}
                                    </div>
                                </div>`;
                            chatContainer.insertAdjacentHTML('beforeend', html);
                            statusText.innerText = 'Online';
                            scrollToBottom();
                            resolve();
                        }, typingTime);
                    } else {
                        const html = `
                            <div class="flex justify-end w-full mb-2">
                                <div class="msg-out p-2 px-3 rounded-lg relative max-w-[85%] text-gray-800 text-[15px] leading-snug shadow-sm protected-msg">
                                    ${text}
                                    <span class="block text-[10px] text-[#97a892] text-right mt-1 -mr-1">
                                        ${getCurrentTime()} <i class="ph-bold ph-checks text-blue-500 ml-1"></i>
                                    </span>
                                </div>
                            </div>`;
                        chatContainer.insertAdjacentHTML('beforeend', html);
                        scrollToBottom();
                        resolve();
                    }
                }, preTypingDelay);
            });
        }

        function showOptions(options) {
            setTimeout(() => {
                const optionsId = `opts-${Date.now()}`;
                let buttonsHTML = options.map(opt => `
                    <button onclick="handleOptionClick('${opt.text}', '${opt.value}', ${opt.nextStep}, '${optionsId}')" 
                            class="wa-btn text-left">
                        ${opt.text}
                    </button>
                `).join('');

                const html = `
                    <div id="${optionsId}" class="flex justify-start w-full mb-2">
                        <div class="msg-options">
                            ${buttonsHTML}
                        </div>
                    </div>`;
                chatContainer.insertAdjacentHTML('beforeend', html);
                scrollToBottom();
                userInput.disabled = true;
                userInput.placeholder = "Selecione uma op√ß√£o acima üëÜ";
            }, 1000); // Delay fixo antes de mostrar bot√µes
        }

        // --- FUN√á√ïES DE RENDERIZA√á√ÉO DE CARD ---
        
        // Expor fun√ß√µes globais para o HTML injetado funcionar
        window.toggleCardSection = function(id, section) {
            const prodSec = document.getElementById(`prod-${id}`);
            const valSec = document.getElementById(`val-${id}`);
            
            if(section === 'produtos') {
                const isHidden = prodSec.style.display === 'none' || prodSec.style.display === '';
                prodSec.style.display = isHidden ? 'block' : 'none';
                valSec.style.display = 'none';
            } else {
                const isHidden = valSec.style.display === 'none' || valSec.style.display === '';
                valSec.style.display = isHidden ? 'block' : 'none';
                prodSec.style.display = 'none';
            }
            scrollToBottom();
        };

        window.selectRice = function(id, nome, preco) {
            const btn = document.getElementById(`btn-pedir-${id}`);
            btn.innerHTML = `<i class="fa-brands fa-whatsapp"></i> Pedir (${nome})`;
            btn.onclick = () => {
                const msg = `Ol√°! Quero encomendar a *Cesta ${id.toUpperCase()}* com *Arroz ${nome}* por *R$ ${preco}*.`;
                window.open(`https://wa.me/${CONFIG.whatsAppNumber}?text=${encodeURIComponent(msg)}`, '_blank');
            }
        };

        function generateCardHTML(cesta) {
            const itemsHTML = cesta.items.map(item => `<li><i class="fa-solid fa-check"></i> ${item}</li>`).join('');
            
            const riceOptionsHTML = cesta.opcoes.map(opt => `
                <div class="radio-arroz-option" onclick="selectRice('${cesta.id}', '${opt.arroz}', '${opt.preco}')">
                    <div class="radio-arroz-info">
                        <span class="radio-arroz-name">${opt.arroz.includes('Valor') ? 'Valor √önico' : 'Com ' + opt.arroz}</span>
                        <span class="radio-arroz-price">R$ ${opt.preco}</span>
                    </div>
                    <div class="w-4 h-4 rounded-full border border-gray-400"></div>
                </div>
            `).join('');

            return `
            <div class="card-msg-container">
                <div class="card-cesta-new">
                    <div class="card-header-visual">
                        ${cesta.destaque ? `<div class="selo-destaque">${cesta.destaque}</div>` : ''}
                        <img src="${cesta.img}" class="card-img-side" alt="${cesta.nome}">
                        <div class="card-title-side">
                            <h2>${cesta.nome}</h2>
                        </div>
                    </div>
                    <div class="card-control-row">
                        <button class="btn-card-toggle" onclick="toggleCardSection('${cesta.id}', 'produtos')">
                            <i class="fa-solid fa-list-ul"></i> Produtos
                        </button>
                        <button class="btn-card-toggle" onclick="toggleCardSection('${cesta.id}', 'valor')">
                            <i class="fa-solid fa-dollar-sign"></i> Valor
                        </button>
                    </div>
                    <div id="prod-${cesta.id}" class="card-expand-section">
                        <ul class="lista-itens-card">
                            ${itemsHTML}
                        </ul>
                    </div>
                    <div id="val-${cesta.id}" class="card-expand-section">
                        <p style="margin-bottom: 10px; font-size: 0.8rem; color:#aaa;">Selecione uma op√ß√£o:</p>
                        ${riceOptionsHTML}
                        <button id="btn-pedir-${cesta.id}" class="btn-encomendar-card">
                            <i class="fa-brands fa-whatsapp"></i> Escolha o Arroz
                        </button>
                    </div>
                </div>
            </div>`;
        }

        // --- L√ìGICA DO ROTEIRO ---

        window.onload = async () => {
            setTimeout(async () => {
                await addMessage(`${getGreeting()}! Tudo bem? üëã`, 'bot', 1000);
                await addMessage(`Aqui √© o *${CONFIG.ownerName}*, da Cesta B√°sica Econ√¥mica.`, 'bot', 2000);
                await addMessage(`Pra gente come√ßar, qual √© o seu primeiro nome?`, 'bot', 1500);
                userInput.focus();
            }, 500);
        };

        async function handleInput() {
            const text = userInput.value.trim();
            if (!text) return;

            if (state.step === 0) {
                state.userName = text.split(' ')[0];
                state.step = 1;
                userInput.value = '';
                await addMessage(text, 'user');
                
                userInput.disabled = true;
                userInput.placeholder = "Aguarde...";
                
                nextStepFlow();
            }
        }

        async function handleOptionClick(text, value, nextStep, containerId) {
            const container = document.getElementById(containerId);
            if(container) container.remove();

            await addMessage(text, 'user');
            state.step = nextStep;
            
            // L√≥gica para navega√ß√£o nas cestas
            if (value === 'ver_proxima') {
                state.currentCestaIndex++;
                state.step = 5; // Volta para o loop de mostrar cesta
            } else if (value === 'entrar_grupo') {
                state.step = 6; // Vai para o final
            }

            nextStepFlow(value);
        }

        async function nextStepFlow(value) {
            const name = state.userName;

            switch (state.step) {
                case 1:
                    await addMessage(`Prazer, ${name}! üòÄ`);
                    await addMessage(`Me diz uma coisa... voc√™ j√° costuma comprar cesta b√°sica?`, 'bot', 2500);
                    showOptions([
                        { text: "Sim, j√° compro üëç", value: "sim", nextStep: 2 },
                        { text: "N√£o, compro no mercado üõí", value: "nao", nextStep: 3 }
                    ]);
                    break;

                case 2: // J√° compra
                    await addMessage(`Ah, que √≥timo! Ent√£o voc√™ sabe como ajuda na economia de casa.`);
                    await addMessage(`A nossa cesta √© diferenciada. Pre√ßo baixo de verdade e marcas de primeira (Arroz Tio Lino, A√ß√∫car Itamarati...). üçö`);
                    await addMessage(`E a gente entrega a√≠ na sua porta, sem cobrar taxa se for em Cuiab√° ou VG.`);
                    // Vai para apresenta√ß√£o de pagamento
                    setTimeout(() => { state.step = 4; nextStepFlow(); }, 1000);
                    break;

                case 3: // Mercado
                    await addMessage(`Entendi! Olha, vou te contar um segredo... ü§´`);
                    await addMessage(`Comprar item por item no supermercado sai *muito mais caro* no final do m√™s.`, 'bot', 3000);
                    await addMessage(`Com a gente voc√™ recebe tudo em casa e paga bem menos por marcas √≥timas.`);
                    // Vai para apresenta√ß√£o de pagamento
                    setTimeout(() => { state.step = 4; nextStepFlow(); }, 1000);
                    break;

                case 4: // Pagamento Completo + Pergunta Cestas
                    await addMessage(`Sobre o pagamento, facilitamos MUITO pra voc√™:`);
                    await addMessage(`‚úÖ *Cart√£o de Cr√©dito* em at√© 3x.`);
                    await addMessage(`‚úÖ *Cart√£o de D√©bito*.`);
                    await addMessage(`‚úÖ *PIX* ou *Dinheiro* na entrega.`);
                    await addMessage(`‚úÖ *Vale Alimenta√ß√£o/Refei√ß√£o:* Aceitamos Alelo, Sodexo, Pluxee, Caju, Flash, iFood Benef√≠cios...`);
                    await addMessage(`Voc√™ quer conhecer as nossas cestas agora?`, 'bot', 2000);
                    showOptions([
                        { text: "Sim, quero ver üòç", value: "sim_ver", nextStep: 5 },
                        { text: "N√£o, s√≥ quero o grupo üëã", value: "nao_ver", nextStep: 6 }
                    ]);
                    break;

                case 5: // Loop de Mostrar Cestas
                    const index = state.currentCestaIndex;
                    
                    if (index < CESTAS.length) {
                        const cestaAtual = CESTAS[index];
                        
                        // Mensagem de introdu√ß√£o da cesta
                        if(index === 0) {
                            await addMessage(`Vou te mostrar a nossa maior primeiro. Essa √© a **${cestaAtual.nome}**. üëá`);
                        } else {
                            await addMessage(`Aqui est√° a **${cestaAtual.nome}**. üëá`);
                        }
                        
                        // Renderiza o Card
                        await addMessage(generateCardHTML(cestaAtual));
                        
                        // Pergunta se quer ver a pr√≥xima (se houver pr√≥xima)
                        if (index < CESTAS.length - 1) {
                            const proximaCesta = CESTAS[index + 1];
                            await addMessage(`O que achou? Quer ver a pr√≥xima (${proximaCesta.nome}) ou prefere entrar no nosso grupo de descontos?`, 'bot', 2500);
                            showOptions([
                                { text: `Ver a ${proximaCesta.nome} ‚û°Ô∏è`, value: "ver_proxima", nextStep: 5 }, // nextStep 5 volta pra esse case com index incrementado
                                { text: "Entrar no Grupo VIP üéÅ", value: "entrar_grupo", nextStep: 6 }
                            ]);
                        } else {
                            // Acabaram as cestas
                            await addMessage(`Essa foi a nossa √∫ltima op√ß√£o (a mais barata).`);
                            await addMessage(`Gostou de alguma? Se quiser pedir, √© s√≥ clicar no bot√£o verde do pre√ßo no card acima.`);
                            await addMessage(`Ou vem pro nosso grupo pegar o cupom de desconto!`);
                            showOptions([
                                { text: "Quero entrar no Grupo! üöÄ", value: "entrar_grupo", nextStep: 6 }
                            ]);
                        }
                    } 
                    break;

                case 6: // Fechamento (Link Grupo)
                    await addMessage(`Perfeito, ${name}!`);
                    await addMessage(`Pra voc√™ garantir brindes e ver as ofertas rel√¢mpago, entra no nosso **Grupo VIP** agora.`);
                    await addMessage(`üéÅ Toda semana tem sorteio exclusivo pra quem t√° l√°.`);
                    
                    setTimeout(() => {
                        const finalHTML = `
                            <div class="flex justify-center w-full mt-4 mb-8">
                                <a href="${CONFIG.whatsAppGroupLink}" target="_blank" 
                                   class="bg-[#25D366] text-white font-bold py-3 px-6 rounded-full shadow-xl flex items-center gap-2 animate-bounce hover:scale-105 transition no-underline">
                                    <i class="ph-bold ph-whatsapp-logo text-2xl"></i>
                                    ENTRAR NO GRUPO VIP
                                </a>
                            </div>`;
                        chatContainer.insertAdjacentHTML('beforeend', finalHTML);
                        scrollToBottom();
                    }, 1000);
                    break;
            }
        }

        sendBtn.addEventListener('click', handleInput);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleInput();
        });
    </script>
</body>
</html>
