<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Integrado - Dona Antonia</title>

    <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #0052cc;
            --success: #22c55e;
            --bg: #0f172a;
            --card: #1e293b;
            --text-main: #f8fafc;
            --accent: #38bdf8;
            --nav-height: 70px;
        }

        html, body { 
            height: 100%; 
            margin: 0; 
            overflow: hidden; 
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
        }

        /* BARRA DE NAVEGA√á√ÉO FIXA */
        .global-nav {
            height: var(--nav-height);
            background: #000;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
            border-bottom: 2px solid var(--accent);
        }

        .nav-btn {
            padding: 10px 18px;
            border-radius: 6px;
            border: 1px solid #334155;
            background: #1e293b;
            color: white;
            font-weight: 700;
            cursor: pointer;
            text-decoration: none;
            font-size: 13px;
            transition: all 0.2s;
        }

        .nav-btn:hover { background: var(--accent); color: #000; }
        .nav-btn.active { background: var(--primary); border-color: var(--accent); }
        .nav-btn.special { background: #f59e0b; color: #000; } /* Cor para o Bling */

        /* CONTAINERS DE CONTE√öDO */
        .content-view {
            height: calc(100vh - var(--nav-height));
            width: 100%;
            display: none; /* Escondido por padr√£o */
        }

        .content-view.active { display: block; }

        /* Estilos da Tabela (Produ√ß√£o) */
        .app-container { padding: 15px; box-sizing: border-box; display: flex; flex-direction: column; height: 100%; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .search-container { flex-grow: 1; margin: 0 20px; }
        #search-field { width: 100%; padding: 15px; font-size: 20px; font-weight: 700; border-radius: 8px; border: 2px solid var(--accent); }
        
        #product-table { flex-grow: 1; border-radius: 12px; overflow: hidden; font-size: 18px; }
        
        /* Iframe para sites externos */
        iframe { width: 100%; height: 100%; border: none; background: white; }

        .btn-system { padding: 10px 15px; border-radius: 6px; border: none; font-weight: 700; cursor: pointer; }
    </style>
</head>
<body>

    <nav class="global-nav">
        <div style="color: var(--accent); font-weight: 900; margin-right: 20px;">DONA ANTONIA</div>
        
        <button class="nav-btn active" onclick="switchView('view-producao', this)">üõ† PRODU√á√ÉO</button>
        
        <button class="nav-btn special" onclick="switchView('view-bling', this)">üí∞ BLING CHECKOUT</button>
        
        <button class="nav-btn" onclick="window.open('URL_AQUI', '_blank')">LINK 3</button>
        <button class="nav-btn" onclick="window.open('URL_AQUI', '_blank')">LINK 4</button>
    </nav>

    <div id="view-producao" class="content-view active">
        <div class="app-container">
            <header>
                <div class="search-container">
                    <input type="text" id="search-field" placeholder="üîé ESCANEAR OU BUSCAR PRODUTO..." autofocus>
                </div>
                <input type="file" id="csv-file" accept=".csv" style="display:none">
                <button class="btn-system" onclick="document.getElementById('csv-file').click()" style="background:#475569; color:white;">SUBIR CSV</button>
                <button class="btn-system" id="btn-export" style="background:var(--success); color:white; margin-left:10px;">EXPORTAR</button>
            </header>
            <div id="product-table"></div>
        </div>
    </div>

    <div id="view-bling" class="content-view">
        <iframe src="https://www.bling.com.br/vendas.checkout.php"></iframe>
    </div>

    <script>
        var table;
        const STORAGE_KEY = 'sucedoan_kiosk_data';

        // Fun√ß√£o para trocar de tela
        function switchView(viewId, btn) {
            // Remove active de todos
            document.querySelectorAll('.content-view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

            // Ativa o selecionado
            document.getElementById(viewId).classList.add('active');
            btn.classList.add('active');

            // Se voltar para produ√ß√£o, foca no busca
            if(viewId === 'view-producao') {
                setTimeout(() => document.getElementById("search-field").focus(), 100);
            }
        }

        // L√≥gica da Tabela (Mantida do anterior)
        function initTable(data) {
            table = new Tabulator("#product-table", {
                data: data,
                layout: "fitColumns",
                height: "100%",
                columns: [
                    {title: "C√ìDIGO", field: "C√≥digo", width: 140, editor: "input"},
                    {title: "DESCRI√á√ÉO", field: "Descri√ß√£o", widthGrow: 4, editor: "input"},
                    {title: "EAN", field: "GTIN/EAN", width: 200, editor: "input"},
                    {title: "LOCAL", field: "Localiza√ß√£o", width: 150, editor: "input"},
                    {title: "ESTOQUE", field: "Estoque", width: 120, hozAlign: "center", editor: "input", color: "#38bdf8"},
                ],
                cellEdited: function(cell) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(table.getData()));
                }
            });

            document.getElementById("search-field").addEventListener("input", function(e){
                table.setFilter([[{field:"C√≥digo", type:"like", value:e.target.value}, {field:"Descri√ß√£o", type:"like", value:e.target.value}, {field:"GTIN/EAN", type:"like", value:e.target.value}]]);
            });
        }

        // Inicializa√ß√£o
        window.onload = function() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) initTable(JSON.parse(savedData));
            document.getElementById("search-field").focus();
        };

        // Upload e Export
        document.getElementById('csv-file').addEventListener('change', function(e) {
            Papa.parse(e.target.files[0], {
                header: true, skipEmptyLines: true, encoding: "UTF-8",
                complete: function(r) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(r.data));
                    initTable(r.data);
                }
            });
        });

        document.getElementById('btn-export').addEventListener('click', function() {
            if (!table) return;
            const csv = Papa.unparse(table.getData(), { quotes: true, delimiter: ";", newline: "\r\n" });
            const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "estoque_atualizado.csv";
            link.click();
        });
    </script>
</body>
</html>
