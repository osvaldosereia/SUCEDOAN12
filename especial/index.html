<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    
    <!-- SEO: Canonical Tag -->
    <link rel="canonical" href="https://donaantonia.com.br/" />

    <!-- OTIMIZAÇÃO: Preconnect e DNS-Prefetch -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://maps.google.com">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Dona Antônia">
    <link rel="apple-touch-icon" href="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif">
    <link rel="shortcut icon" href="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif">

    <title>Monte sua Cesta | Dona Antônia</title>
    
    <meta name="description" content="Monte sua cesta básica personalizada em Cuiabá. Escolha os itens e receba em casa.">
    <meta name="keywords" content="cesta básica personalizada, mercado online cuiabá, compras online">
    
    <meta property="og:locale" content="pt_BR" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Monte sua Cesta - Dona Antônia" />
    <meta property="og:description" content="Escolha seus produtos e monte a cesta ideal para sua família." />
    <meta property="og:url" content="https://donaantonia.com.br/" />
    <meta property="og:image" content="https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" />
    <meta property="og:site_name" content="Dona Antônia Alimentos" />

    <meta name="geo.region" content="BR-MT" />
    <meta name="geo.placename" content="Cuiabá" />
    <meta name="geo.position" content="-15.6025;-56.0968" />
    <meta name="ICBM" content="-15.6025, -56.0968" />

    <meta name="robots" content="index, follow">
    <meta name="author" content="Super Cestas Básicas Dona Antônia">
    <meta name="theme-color" content="#0F2546"> 
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
    
    <style>
        /* === ESTILOS GLOBAIS E TIPOGRAFIA === */
        * { box-sizing: border-box; }

        :root {
            --cor-primaria: #0F2546; 
            --cor-destaque-vermelho: #D32F2F; 
            --cor-destaque-dourado: #FFC107; 
            --cor-whatsapp: #128C7E; 
            --cor-info: #1565C0; 
            --cor-texto: #333; 
            --cor-fundo: #fafafa;
            --cor-pagamento: #0277BD; 
            --cor-sorteio: #2E7D32; 
            --cor-entrega: #EF6C00; 
            --cor-header-fundo: #f5f5f5;
            --altura-header: 80px; 
            --largura-logo: 100px; 
        }

        html { 
            background-color: #e0e0e0; 
            scroll-behavior: smooth;
            scroll-padding-top: calc(var(--altura-header) + 40px); 
            font-size: 15px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background-color: #e0e0e0; 
            color: var(--cor-texto);
            margin: 0; 
            padding: 0;
            padding-top: calc(var(--altura-header) + 10px); 
            padding-bottom: 90px; 
            min-height: 10vh;
            position: relative; 
            width: 100%;
            line-height: 1.5; 
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--cor-primaria);
            margin-top: 0;
            line-height: 1.2;
        }

        .main-content-wrapper {
            max-width: 480px; 
            margin: 0 auto; 
            background-color: var(--cor-fundo); 
            box-shadow: 0 0 20px rgba(0,0,0,0.05); 
            transition: max-width 0.3s ease; 
        }
        
        .desktop-only { display: none !important; }

        /* === TITULO H1 SEO === */
        .seo-main-title {
            text-align: center;
            padding: 20px 15px 10px 15px;
            background: #fff;
        }
        .seo-main-title h1 {
            font-size: 1.25rem; 
            font-weight: 700; 
            margin: 0;
            letter-spacing: -0.5px;
        }
        .seo-main-title p {
            font-size: 0.95rem;
            color: #666;
            margin: 6px 0 0 0;
            font-weight: 400;
        }

        /* --- CABEÇALHO --- */
        header {
            background-color: white;
            height: var(--altura-header);
            padding: 0;
            display: flex;
            flex-direction: row; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
            position: fixed;
            top: 0;
            left: 50%; 
            transform: translateX(-50%); 
            width: 100%;
            max-width: 480px; 
            z-index: 1000;
            transition: max-width 0.3s ease;
            contain: layout size; 
        }

        .header-background-bar {
            position: absolute;
            top: 0;
            left: 50%; 
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px; 
            height: var(--altura-header);
            background-color: var(--cor-header-fundo);
            z-index: 999;
            transition: max-width 0.3s ease;
        }
        
        .header-top {
            display: flex;
            justify-content: flex-end; 
            align-items: center;
            width: 100%;
            height: 100%;
            padding: 5px 15px;
            position: relative;
            z-index: 1002;
        }

        .logo-pequ { 
            height: var(--largura-logo);
            width: var(--largura-logo); 
            object-fit: cover; 
            border-radius: 50%; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            position: fixed;
            top: 5px; 
            left: 15px; 
            z-index: 2000; 
            background-color: white;
            padding: 0; 
        }

        .btn-contato-principal {
            display: flex;
            align-items: center;    
            justify-content: center;
            background-color: var(--cor-primaria);
            color: var(--cor-destaque-dourado); 
            border: 1px solid var(--cor-destaque-dourado); 
            border-radius: 50px; 
            padding: 8px 20px; 
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 4px 10px rgba(15, 37, 70, 0.2);
            margin-left: auto;
            text-align: center;
            max-width: calc(100% - var(--largura-logo) - 10px);
        }

        .linha-destaque-top {
            font-weight: 700;
            font-size: 0.85rem; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (max-width: 380px) {
            :root { --largura-logo: 85px; --altura-header: 75px; }
            .logo-pequ { left: 10px; }
            .linha-destaque-top { font-size: 0.75rem; }
        }

        /* === ESTILOS DA GRADE DE PRODUTOS AJUSTADA === */
        .secao-conteudo { padding: 15px; }
        
        .monte-sua-cesta-container {
            padding: 10px;
        }

        .instrucoes-cesta {
            background-color: #E3F2FD;
            color: #1565C0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            text-align: left;
            border: 1px solid #BBDEFB;
        }
        .instrucoes-cesta ul { margin: 10px 0 0 20px; padding: 0; }
        .instrucoes-cesta li { margin-bottom: 5px; }

        .categoria-titulo {
            grid-column: 1 / -1;
            font-size: 1.1rem;
            color: var(--cor-primaria);
            background-color: #e0e0e0;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: 700;
            text-transform: uppercase;
            border-left: 5px solid var(--cor-destaque-dourado);
        }

        .produtos-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Mobile: 2 colunas */
            gap: 15px;
        }

        .produto-item {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 1px solid #eee;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.2s ease;
        }
        
        .produto-item.selecionado {
            background-color: #E8F5E9;
            border-color: #4CAF50;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        /* CONTAINER DA IMAGEM: QUADRADO E GRANDE */
        .prod-img-wrapper {
            width: 100%;
            aspect-ratio: 1 / 1; /* Garante que o container seja quadrado */
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 0; /* Sem padding para maximizar espaço */
            border-bottom: 1px solid #f5f5f5;
        }
        
        .prod-img-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* 'contain' para não cortar o produto, 'cover' se quiser preencher tudo */
            padding: 10px; /* Pequeno respiro para a marca não colar na borda */
            transition: transform 0.3s ease;
        }
        
        .produto-item:hover .prod-img-wrapper img {
            transform: scale(1.05);
        }

        .prod-info {
            padding: 10px; 
            text-align: center;
            background: transparent;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex-grow: 1;
        }

        .prod-nome {
            font-size: 0.85rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            min-height: 38px; 
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
            overflow: hidden;
        }

        .controle-qtd {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background-color: #f0f2f5; 
            border-radius: 25px;
            padding: 4px; 
        }
        .produto-item.selecionado .controle-qtd {
            background-color: #C8E6C9;
        }

        .btn-qtd {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background-color: white;
            color: var(--cor-primaria);
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .qtd-display {
            font-weight: 700;
            color: var(--cor-primaria);
            min-width: 20px;
            text-align: center;
            font-size: 1rem;
        }

        /* BARRA DE AÇÕES */
        .barra-acoes {
            background-color: white;
            border-top: 1px solid #ddd;
            padding: 12px 15px;
            position: sticky;
            bottom: 0;
            z-index: 900;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .gamificacao-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 5px;
        }
        .meta-texto {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            margin-bottom: 4px;
            color: #666;
            font-weight: 700;
            text-transform: uppercase;
        }
        .progress-bg {
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: var(--cor-destaque-dourado);
            width: 0%;
            transition: width 0.4s ease;
        }
        .progress-fill.concluido { background-color: #2E7D32; }
        .meta-check { color: #ccc; }
        .meta-check.ativo { color: #2E7D32; }

        .resumo-linha-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #totalValor {
            font-size: 1.2rem;
            color: #666;
            font-weight: 800;
        }

        .btn-historico-mini {
            background: #E3F2FD;
            color: #1565C0;
            border: 1px solid #BBDEFB;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
        }

        .grid-botoes-acao {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn-acao {
            padding: 14px;
            border-radius: 10px;
            border: none;
            background: #eee;
            color: #555;
            font-size: 0.9rem;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            height: 52px;
        }
        
        .btn-destaque {
            background-color: var(--cor-whatsapp);
            color: white;
            opacity: 0.5;
            pointer-events: none;
        }
        .btn-destaque.ativo {
            opacity: 1;
            pointer-events: auto;
            box-shadow: 0 4px 12px rgba(18, 140, 126, 0.3);
        }
        
        .btn-calc {
            background-color: var(--cor-primaria);
            color: white;
        }

        /* MODAIS */
        .modal-variacao {
            display: none; position: fixed; z-index: 4000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; backdrop-filter: blur(4px);
            padding: 20px;
        }
        .modal-info-content {
            background-color: white; width: 100%; max-width: 400px; border-radius: 20px; 
            overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        /* RESPONSIVIDADE DESKTOP */
        @media (min-width: 481px) {
            .main-content-wrapper, header, .header-background-bar { max-width: 1100px; } 
            .produtos-grid { grid-template-columns: repeat(3, 1fr); gap: 20px; }
        }
        
        @media (min-width: 1024px) {
            .main-content-wrapper, header, .header-background-bar { max-width: 1200px; } 
            .produtos-grid { grid-template-columns: repeat(4, 1fr); }
            .logo-pequ { display: none !important; }
            .desktop-only { display: flex !important; }
            .desktop-logo-wrapper { position: relative; width: 60px; }
            .big-logo-desktop { width: 120px; height: 120px; border-radius: 50%; border: 4px solid white; position: absolute; top: -25px; left: 0; z-index: 3000; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
            .desktop-nav { display: flex; gap: 35px; align-items: center; margin-left: 130px; }
            .desktop-nav a { text-decoration: none; color: var(--cor-primaria); font-weight: 700; font-size: 0.9rem; text-transform: uppercase; }
        }
    </style>
</head>
<body>
    
    <div id="toast-container"></div> 
    <div class="header-background-bar"></div>

    <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" width="100" height="100" id="logo-principal" onerror="this.src='https://placehold.co/120x120?text=DA'" alt="Logo Dona Antônia" class="logo-pequ">

    <header>
        <div class="header-top">
            <div class="desktop-only desktop-logo-wrapper">
                <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" class="big-logo-desktop" width="120" height="120" alt="Logo Dona Antônia" onerror="this.src='https://placehold.co/120x120?text=DA'">
            </div>

            <nav class="desktop-nav desktop-only">
                <a href="#pag-cestas">Início</a>
                <a href="#pag-pagamento">Pagamento</a>
                <a href="#pag-entrega">Entrega</a>
            </nav>

            <button class="btn-contato-principal" onclick="abrirModalContatos()" aria-label="Abrir opções de contato">
                <div class="linha-destaque-top">
                    <i class="fab fa-whatsapp"></i> <span class="desktop-only">&nbsp;FALE CONOSCO</span><span class="mobile-text">SALVAR CONTATO</span>
                </div>
            </button>
        </div>
    </header>

    <main class="main-content-wrapper">
        <div id="pag-cestas">
            <div class="seo-main-title">
                <h1>Monte sua Cesta Personalizada</h1>
                <p>Escolha os produtos e receba em casa com frete grátis.</p>
            </div>

            <div class="secao-conteudo">
                <div class="monte-sua-cesta-container">
                    <div class="instrucoes-cesta">
                        <strong><i class="fas fa-shopping-basket"></i> Regras da Cesta:</strong>
                        <ul>
                            <li>Mínimo de <strong>10 produtos diferentes</strong>.</li>
                            <li>Mínimo de <strong>20 itens no total</strong>.</li>
                        </ul>
                    </div>

                    <div id="gridProdutos" class="produtos-grid">
                        <!-- Itens via JS -->
                    </div>
                </div>

                <!-- BARRA DE AÇÕES -->
                <div class="barra-acoes">
                    <div class="gamificacao-container">
                        <div class="meta-item">
                            <div class="meta-texto">
                                <span>Produtos Dif. <i id="icon-dif" class="fas fa-check-circle meta-check"></i></span>
                                <span id="label-dif">0/10</span>
                            </div>
                            <div class="progress-bg">
                                <div id="bar-dif" class="progress-fill"></div>
                            </div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-texto">
                                <span>Total Itens <i id="icon-total" class="fas fa-check-circle meta-check"></i></span>
                                <span id="label-total">0/20</span>
                            </div>
                            <div class="progress-bg">
                                <div id="bar-total" class="progress-fill"></div>
                            </div>
                        </div>
                    </div>

                    <div class="resumo-linha-top">
                        <span id="totalValor">R$ 0,00</span>
                        <button class="btn-historico-mini" onclick="abrirHistorico()">
                            <i class="fas fa-list-ul"></i> Meus Pedidos
                        </button>
                    </div>
                    
                    <div class="grid-botoes-acao">
                        <button class="btn-acao btn-calc" onclick="calcularTotal()">
                            <i class="fas fa-calculator"></i> Validar
                        </button>
                        <button id="btnEncomendar" class="btn-acao btn-destaque" onclick="encomendarCesta()">
                            <i class="fab fa-whatsapp"></i> Encomendar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="secoes-extras-grid">
            <div id="pag-pagamento" class="secao-conteudo">
                <div class="card" style="background:white; border-radius:15px; padding:20px; text-align:center; border:1px solid #eee;">
                    <h2 style="font-size:1.1rem; margin-bottom:15px;">Pagamento</h2>
                    <p style="font-size:0.9rem; color:#666;">Aceitamos Dinheiro, Pix, Cartões e Vale Alimentação (Alelo, Sodexo, Pluxee).</p>
                </div>
            </div>

            <div id="pag-entrega" class="secao-conteudo">
                <div class="card" style="background:white; border-radius:15px; padding:20px; text-align:center; border:1px solid #eee;">
                    <h2 style="font-size:1.1rem; margin-bottom:15px; color:var(--cor-entrega);">Entrega Grátis</h2>
                    <p style="font-size:0.9rem; color:#666;">Cuiabá e Várzea Grande - MT</p>
                </div>
            </div>
        </div>

        <footer style="text-align: center; padding: 30px 20px; color: #999; font-size: 0.8rem;">
            <p>© Dona Antônia Alimentos - 2025</p>
        </footer>
    </main>

    <!-- MODAL HISTÓRICO -->
    <div id="modalHistorico" class="modal-variacao" onclick="if(event.target === this) fecharModalHistorico()">
        <div class="modal-info-content">
            <div style="padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0;">Pedidos Recentes</h3>
                <button style="border:none; background:#f0f0f0; border-radius:15px; padding:5px 12px; cursor:pointer;" onclick="fecharModalHistorico()">X</button>
            </div>
            <div style="max-height:60vh; overflow-y:auto; padding:15px;" id="listaHistorico">
                <!-- Lista via JS -->
            </div>
        </div>
    </div>

    <!-- MODAL CONTATOS -->
    <div id="modalContatos" class="modal-variacao" onclick="if(event.target === this) fecharModalContatos()">
        <div class="modal-info-content" style="padding:30px; text-align:center;">
            <h3>Fale Conosco</h3>
            <p>Clique no botão abaixo para abrir o WhatsApp.</p>
            <a href="https://wa.me/5565996813588" class="btn-acao btn-destaque" target="_blank" style="opacity:1; pointer-events:auto; margin-top:20px; text-decoration:none;">
                <i class="fab fa-whatsapp"></i> WhatsApp Principal
            </a>
            <button onclick="fecharModalContatos()" style="margin-top:20px; background:none; border:none; color:#999; cursor:pointer;">Fechar</button>
        </div>
    </div>

    <script>
        const produtos = [
            { id: 1, categoria: "alimentos", nome: "Arroz 5kg", preco: 25.00, img: "img/arroz.png" },
            { id: 2, categoria: "alimentos", nome: "Açúcar Cristal 2kg", preco: 9.50, img: "img/acucar.png" },
            { id: 3, categoria: "alimentos", nome: "Óleo de Soja 900ml", preco: 6.00, img: "img/oleo.png" },
            { id: 4, categoria: "alimentos", nome: "Feijão 1kg", preco: 8.50, img: "img/feijao.png" },
            { id: 5, categoria: "alimentos", nome: "Café 500g", preco: 18.00, img: "img/cafe.png" },
            { id: 6, categoria: "alimentos", nome: "Macarrão 500g", preco: 4.50, img: "img/macarrao.png" },
            { id: 7, categoria: "alimentos", nome: "Ovos (Dúzia)", preco: 12.00, img: "img/ovos.png" },
            { id: 8, categoria: "alimentos", nome: "Trigo 1kg", preco: 5.50, img: "img/trigo.png" },
            { id: 9, categoria: "alimentos", nome: "Sal 1kg", preco: 2.00, img: "img/sal.png" },
            { id: 10, categoria: "alimentos", nome: "Molho Tomate", preco: 3.00, img: "img/molho.png" },
            { id: 17, categoria: "limpeza", nome: "Sabão Barra Ype", preco: 11.00, img: "img/sabao_barra.png" },
            { id: 18, categoria: "limpeza", nome: "Creme Dental", preco: 4.50, img: "img/creme.png" },
            { id: 19, categoria: "limpeza", nome: "Papel Higiênico", preco: 6.00, img: "img/papel.png" },
            { id: 22, categoria: "limpeza", nome: "Sabão Pó OMO", preco: 13.00, img: "img/sabao_po.png" },
            { id: 23, categoria: "limpeza", nome: "Detergente Ype", preco: 2.50, img: "img/detergente.png" }
        ];

        let cesta = {}; 
        let historicoPedidos = [];

        document.addEventListener('DOMContentLoaded', () => {
            renderizarProdutos();
            carregarCestaSalva();
            carregarHistoricoStorage();
        });

        function renderizarProdutos() {
            const grid = document.getElementById('gridProdutos');
            grid.innerHTML = '';

            adicionarCabecalho(grid, 'Alimentos');
            produtos.filter(p => p.categoria === 'alimentos').forEach(prod => criarCard(prod, grid));

            adicionarCabecalho(grid, 'Limpeza e Higiene');
            produtos.filter(p => p.categoria === 'limpeza').forEach(prod => criarCard(prod, grid));
        }

        function adicionarCabecalho(container, texto) {
            const div = document.createElement('div');
            div.className = 'categoria-titulo';
            div.innerText = texto;
            container.appendChild(div);
        }

        function criarCard(prod, container) {
            const qtd = cesta[prod.id] || 0;
            const card = document.createElement('div');
            card.className = 'produto-item' + (qtd > 0 ? ' selecionado' : '');
            card.id = `card-prod-${prod.id}`;
            
            card.innerHTML = `
                <div class="prod-img-wrapper">
                    <img src="${prod.img}" alt="${prod.nome}" onerror="this.src='https://placehold.co/200x200/eee/999?text=${prod.nome}'">
                </div>
                <div class="prod-info">
                    <div class="prod-nome">${prod.nome}</div>
                    <div class="controle-qtd">
                        <button class="btn-qtd" onclick="alterarQtd(${prod.id}, -1)">-</button>
                        <span class="qtd-display" id="qtd-${prod.id}">${qtd}</span>
                        <button class="btn-qtd" onclick="alterarQtd(${prod.id}, 1)">+</button>
                    </div>
                </div>
            `;
            container.appendChild(card);
        }

        function alterarQtd(id, delta) {
            if (!cesta[id]) cesta[id] = 0;
            cesta[id] += delta;
            if (cesta[id] < 0) cesta[id] = 0;
            
            document.getElementById(`qtd-${id}`).innerText = cesta[id];
            const card = document.getElementById(`card-prod-${id}`);
            if (cesta[id] > 0) card.classList.add('selecionado');
            else card.classList.remove('selecionado');

            document.getElementById('totalValor').innerText = "Validar Pedido...";
            document.getElementById('btnEncomendar').classList.remove('ativo');
            
            atualizarBarrasProgresso();
            localStorage.setItem('minhaCestaPersonalizada', JSON.stringify(cesta));
        }

        function atualizarBarrasProgresso() {
            let totalItens = 0;
            let difItens = 0;
            
            produtos.forEach(p => {
                const q = cesta[p.id] || 0;
                if (q > 0) {
                    totalItens += q;
                    difItens++;
                }
            });

            const pctDif = Math.min((difItens / 10) * 100, 100);
            const pctTotal = Math.min((totalItens / 20) * 100, 100);

            document.getElementById('label-dif').innerText = `${difItens}/10`;
            document.getElementById('label-total').innerText = `${totalItens}/20`;
            
            const bDif = document.getElementById('bar-dif');
            const bTotal = document.getElementById('bar-total');
            
            bDif.style.width = `${pctDif}%`;
            bTotal.style.width = `${pctTotal}%`;

            if (difItens >= 10) { bDif.classList.add('concluido'); document.getElementById('icon-dif').classList.add('ativo'); }
            else { bDif.classList.remove('concluido'); document.getElementById('icon-dif').classList.remove('ativo'); }

            if (totalItens >= 20) { bTotal.classList.add('concluido'); document.getElementById('icon-total').classList.add('ativo'); }
            else { bTotal.classList.remove('concluido'); document.getElementById('icon-total').classList.remove('ativo'); }
        }

        function calcularTotal() {
            let total = 0;
            let totalItens = 0;
            let difItens = 0;
            
            produtos.forEach(p => {
                const q = cesta[p.id] || 0;
                if (q > 0) {
                    total += q * p.preco;
                    totalItens += q;
                    difItens++;
                }
            });

            if (difItens < 10 || totalItens < 20) {
                mostrarToast(`Faltam itens! Você tem ${difItens} produtos e ${totalItens} no total.`);
                return;
            }

            document.getElementById('totalValor').innerText = `R$ ${total.toFixed(2).replace('.', ',')}`;
            document.getElementById('btnEncomendar').classList.add('ativo');
            return { total, totalItens };
        }

        function encomendarCesta() {
            const res = calcularTotal();
            if (!res) return;

            salvarNoHistorico(res.total, res.totalItens);

            let msg = "*Pedido de Cesta Personalizada*\n\n";
            produtos.forEach(p => {
                const q = cesta[p.id] || 0;
                if (q > 0) msg += `▪ ${q}x ${p.nome}\n`;
            });
            msg += `\n*Total Estimado: R$ ${res.total.toFixed(2).replace('.', ',')}*`;

            window.open(`https://wa.me/5565996813588?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function salvarNoHistorico(t, i) {
            const ped = { data: new Date().toLocaleString(), total: t, itens: i, cesta: {...cesta} };
            historicoPedidos.unshift(ped);
            if (historicoPedidos.length > 5) historicoPedidos.pop();
            localStorage.setItem('donaAntoniaHistorico', JSON.stringify(historicoPedidos));
        }

        function carregarHistoricoStorage() {
            const h = localStorage.getItem('donaAntoniaHistorico');
            if (h) historicoPedidos = JSON.parse(h);
        }

        function abrirHistorico() {
            const l = document.getElementById('listaHistorico');
            l.innerHTML = '';
            if (historicoPedidos.length === 0) l.innerHTML = '<p>Nenhum pedido encontrado.</p>';
            historicoPedidos.forEach((p, idx) => {
                const d = document.createElement('div');
                d.style.cssText = "padding:10px; border:1px solid #eee; margin-bottom:10px; border-radius:10px; cursor:pointer;";
                d.innerHTML = `<strong>${p.data}</strong><br>${p.itens} itens - R$ ${p.total.toFixed(2)}`;
                d.onclick = () => {
                    cesta = {...p.cesta};
                    renderizarProdutos();
                    atualizarBarrasProgresso();
                    fecharModalHistorico();
                    mostrarToast("Cesta recarregada!");
                };
                l.appendChild(d);
            });
            document.getElementById('modalHistorico').style.display = 'flex';
        }

        function fecharModalHistorico() { document.getElementById('modalHistorico').style.display = 'none'; }
        function abrirModalContatos() { document.getElementById('modalContatos').style.display = 'flex'; }
        function fecharModalContatos() { document.getElementById('modalContatos').style.display = 'none'; }

        function carregarCestaSalva() {
            const s = localStorage.getItem('minhaCestaPersonalizada');
            if (s) {
                cesta = JSON.parse(s);
                atualizarBarrasProgresso();
            }
        }

        function mostrarToast(m) {
            const t = document.createElement('div');
            t.style.cssText = "position:fixed; bottom:100px; left:50%; transform:translateX(-50%); background:#333; color:white; padding:10px 20px; border-radius:20px; z-index:9999;";
            t.innerText = m;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }
    </script>
</body>
</html>
